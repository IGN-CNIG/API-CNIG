!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e){e.exports=JSON.parse('{"tooltip":"Calculate visibility area","calculating":"Performing geoprocessing analysis","warning":"Warning","outbox":"he coordinates are not within the calculation range","error_query":"Unable to perform query","active_viewshed":"Click a point on the map","clear":"Clean result"}')},function(e){e.exports=JSON.parse('{"tooltip":"Calcular área de visibilidad","calculating":"Realizando geoproceso de análisis","warning":"Advertencia","outbox":"Las coordenadas no están dentro del ámbito de cálculo","error_query":"No se ha podido realizar la consulta","active_viewshed":"Hacer click en punto del mapa","clear":"Limpiar resultado"}')},function(e,t){e.exports='<div class="m-control m-container m-viewshed-container">\n    <button id=\'m-viewshed-calculate-btn\' class="m-viewshed-btn icon-pin" title="{{translations.active_viewshed}}"></button>\n    <button id=\'m-viewshed-clear-btn\' class="m-viewshed-btn icon-clear" title="{{translations.clear}}"></button>\n</div>\n'},function(e){e.exports=JSON.parse('{"url":{"name":"viewshed","separator":"*"},"constructor":"M.plugin.ViewShed","parameters":[{"type":"object","properties":[{"type":"simple","name":"position","position":0,"possibleValues":["TL","TR","BL","BR"]},{"type":"boolean","name":"collapsed","position":1},{"type":"boolean","name":"collapsible","position":2},{"type":"simple","name":"url","position":3}]}],"files":{"ol":{"scripts":["viewshed.ol.min.js"],"styles":["viewshed.ol.min.css"]}},"metadata":{"name":"ViewShed","description":"Muestra el área visible calculada a partir de un punto con un análisis de visibilidad.","text":"Muestra área visible mediante análisis de visibilidad a partir de un click","version":"1.0.0","date":"12/07/2020","author":"Guadaltel","org":"CNIG","tags":"mapea,plugin","icon":"./facade/assets/icons/icon.svg"}}')},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(4),n(5);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=r.key,a=void 0,a=function(e,t){if("object"!==o(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===o(a)?a:String(a)),r)}var i,a}function a(){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var o=c(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=f(e);if(t){var r=f(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return s(this,n)}}function s(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(s,M.impl.Control);var t,n,o,c=u(s);function s(){return r(this,s),c.apply(this,arguments)}return t=s,(n=[{key:"addTo",value:function(e,t){this.facadeMap_=e,a(f(s.prototype),"addTo",this).call(this,e,t)}},{key:"transformCoordinates",value:function(e,t){return ol.proj.transform(e,this.facadeMap_.getProjection().code,t)}},{key:"loadGeoJSONLayer",value:function(e,t){var n=(new ol.format.GeoJSON).readFeatures(e,{featureProjection:this.facadeMap_.getProjection().code});n=this.featuresToFacade(n);var o=new M.Feature("clickedPoint",{type:"Feature",id:"clickedPoint",geometry:{type:"Point",coordinates:t}}),r=new M.layer.Vector({name:"viewresult",legend:"viewresult",extract:!1});return r.addFeatures(n),r.addFeatures([o]),this.facadeMap_.addLayers(r),o.setStyle(new M.style.Point({radius:7,fill:{color:"red"},stroke:{color:"white",width:2}})),n.forEach((function(e){e.setStyle(new M.style.Polygon({fill:{color:"#71a7d3",opacity:.5},stroke:{color:"#71a7d3",width:2}}))})),n}},{key:"featuresToFacade",value:function(e){return e.map((function(e){return M.impl.Feature.olFeature2Facade(e)}))}},{key:"centerFeatures",value:function(e){if(!M.utils.isNullOrEmpty(e))if(1===e.length&&"Point"===e[0].getGeometry().type){var t=new ol.View({center:e[0].getGeometry().coordinates,zoom:15});this.facadeMap_.getMapImpl().setView(t)}else{var n=M.impl.utils.getFeaturesExtent(e);this.facadeMap_.getMapImpl().getView().fit(n,{duration:500,minResolution:1})}}}])&&i(t.prototype,n),o&&i(t,o),Object.defineProperty(t,"prototype",{writable:!1}),s}(),d=n(2),y=n.n(d),v=n(0),m=n(1),b={en:v,es:m},h=function(){var e="es";return"function"==typeof M.language.getLang&&(e=M.language.getLang()),e},w=function(e){return"es"===e||"en"===e?b[e]:M.language.getTranslation(e).viewshed},g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h(),n=w(t),o="";return M.utils.isNullOrEmpty(n)?console.warn("The translation '".concat(t,"' has not been defined.")):o=e.split(".").reduce((function(e,t){return e[t]}),n),o};function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(r=o.key,i=void 0,i=function(e,t){if("object"!==_(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==_(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(r,"string"),"symbol"===_(i)?i:String(i)),o)}var r,i}function S(e,t){return(S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function P(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=k(e);if(t){var r=k(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return j(this,n)}}function j(e,t){if(t&&("object"===_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t)}(i,M.Control);var t,n,o,r=P(i);function i(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var n=new p;return(t=r.call(this,n,"ViewShed")).facadeMap_=null,t.element_=null,t.url_=e.url,t}return t=i,(n=[{key:"createView",value:function(e){var t=this;return this.facadeMap_=e,new Promise((function(e,n){var o=M.template.compileSync(y.a,{vars:{translations:{tooltip:g("tooltip"),active_viewshed:g("active_viewshed"),clear:g("clear")}}});t.element_=o,o.querySelector("#m-viewshed-clear-btn").addEventListener("click",t.clear.bind(t)),o.querySelector("#m-viewshed-calculate-btn").addEventListener("click",t.activate.bind(t)),e(o)}))}},{key:"activate",value:function(){this.activated?this.deactivate():(this.facadeMap_.on(M.evt.CLICK,this.analizeVisibility,this),this.activated=!0,this.element_.querySelector("#m-viewshed-calculate-btn").classList.add("activated"),document.addEventListener("keydown",this.checkEscKey.bind(this)))}},{key:"checkEscKey",value:function(e){"Escape"===e.key&&(this.deactivate(),document.removeEventListener("keydown",this.checkEscKey))}},{key:"deactivate",value:function(){this.facadeMap_.removePopup(),this.facadeMap_.un(M.evt.CLICK,this.analizeVisibility,this),this.activated=!1,this.element_.querySelector("#m-viewshed-calculate-btn").classList.remove("activated")}},{key:"analizeVisibility",value:function(e){var t=this,n=this.facadeMap_.getLayers().filter((function(e){return"Vector"===e.type&&"viewresult"===e.name}));this.facadeMap_.removeLayers(n);var o=this.getImpl().transformCoordinates(e.coord,"EPSG:4326"),r='<div class="m-viewshed-message">'.concat(g("calculating"),'...<br/><br/><p class="m-viewshed-loading"><span class="icon-spinner" /></p></div>');M.dialog.info(r),setTimeout((function(){document.querySelector("div.m-mapea-container div.m-dialog div.m-title").style.backgroundColor="#71a7d3",document.querySelector("div.m-dialog.info div.m-button > button").remove()}),10),M.remote.get("".concat(this.url_,"/api/operations/checkCoordinates?x=").concat(o[0],"&y=").concat(o[1])).then((function(n){if(!0===JSON.parse(n.text).valid){var r="".concat(t.url_,"/api/operations/viewshed?x=").concat(o[0],"&y=").concat(o[1],"&distance=0.1");M.remote.get(r).then((function(n){document.querySelector("div.m-mapea-container div.m-dialog").remove();var o=t.getImpl().loadGeoJSONLayer(n.text,e.coord);t.getImpl().centerFeatures(o)})).catch((function(e){document.querySelector("div.m-mapea-container div.m-dialog").remove(),M.dialog.error(g("error_query"))}))}else document.querySelector("div.m-mapea-container div.m-dialog").remove(),M.dialog.error(g("outbox"),g("warning"))})).catch((function(e){document.querySelector("div.m-mapea-container div.m-dialog").remove(),M.dialog.error(g("error_query"))}))}},{key:"clear",value:function(){var e=this.facadeMap_.getLayers().filter((function(e){return"Vector"===e.type&&"viewresult"===e.name}));this.facadeMap_.removeLayers(e),this.deactivate()}},{key:"equals",value:function(e){return e instanceof i}}])&&O(t.prototype,n),o&&O(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}(),T=n(3);function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(r=o.key,i=void 0,i=function(e,t){if("object"!==R(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==R(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(r,"string"),"symbol"===R(i)?i:String(i)),o)}var r,i}function L(e,t){return(L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function V(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=N(e);if(t){var r=N(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return q(this,n)}}function q(e,t){if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&L(e,t)}(i,M.Plugin);var t,n,o,r=V(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return x(this,i),(e=r.call(this)).map_=null,e.controls_=[],e.position_=t.position||"TL",e.collapsed_=t.collapsed,void 0===e.collapsed_&&(e.collapsed_=!0),e.collapsible_=t.collapsible,void 0===e.collapsible_&&(e.collapsible_=!0),e.url_=t.url||"http://sigc.desarrollo.guadaltel.es/geoprocess-services",e.metadata_=T.metadata,e.name_="viewshed",e}return t=i,o=[{key:"getJSONTranslations",value:function(e){return"en"===e||"es"===e?"en"===e?v:m:M.language.getTranslation(e).viewshed}}],(n=[{key:"addTo",value:function(e){this.controls_.push(new E({url:this.url_})),this.map_=e,this.panel_=new M.ui.Panel("panelViewShed",{className:"m-viewshed-container",collapsed:this.collapsed_,collapsible:this.collapsible_,position:M.ui.position[this.position_],tooltip:g("tooltip"),collapsedButtonClass:"icon-viewshed"}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_);var t=this;this.controls_[0].on(M.evt.ADDED_TO_MAP,(function(){t.fire(M.evt.ADDED_TO_MAP)}))}},{key:"name",get:function(){return"viewshed"}},{key:"position",get:function(){return this.position_}},{key:"getAPIRest",value:function(){return"".concat(this.name_,"=").concat(this.position_)}},{key:"equals",value:function(e){return e instanceof i}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_);var e=[null,null,null];this.map_=e[0],this.controls_=e[1],this.panel_=e[2]}}])&&C(t.prototype,n),o&&C(t,o),Object.defineProperty(t,"prototype",{writable:!1}),i}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.ViewShed=F,window.M.control.ViewShedControl=E,window.M.impl.control.ViewShedControl=p}]);
//# sourceMappingURL=viewshed.ol.min.js.map