!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e){e.exports=JSON.parse('{"exception":{"impl":"The implementation used cannot create LocatorscnControl.","impl_infocatastro":"The implementation used cannot create InfoCatastroControl.","impl_xylocatorscn":"The implementation used cannot create XYLocatorscnControl.","impl_ignsearchlocatorscn":"The implementation used cannot create IGNSearchLocatorscnControl.","no_controls":"The Locatorscn plugin needs to activate at least one control.","wrong_coords":"The coordinates entered are not correct.","transforming":"Error performing the transformation.","wrong_values":"Some value entered are not correct. Remember that minutes and seconds must be between 0 and 59 and degrees between 0 and 180.","mapeaerror":"It is not possible to establish a connection with the Cadastre server.","no_province":"You must select a province.","no_mun":"You must select a municipality.","no_polygon":"You must select an polygon.","no_parcel":"You must select a parcel.","json_invalid":"The response is not a valid JSON:","no_refcatastro":"You must enter a cadastral reference.","noInfo":"NO REFERENCES AVAILABLE FOR THESE COORDINATES","noresults":"No results found","no_direction":"No address","error_findjsonp":"Error in the findJSONp service request.","error_candidates":"Error in the candidatesJSONp service request."},"tooltip":"Locatorscn","xylocatorscn":"Search by coordinates","geographic":"Geographic","zone":"zone","dms":"DMS","dd":"DD","srs":"Coordinate system","longitude":"Longitude","latitude":"Latitude","locate":"Locate","clean":"Delete","north":"North","south":"South","east":"East","west":"West","infocatastro":"Search parcel/cadastre","plot":"Parcel","searchplot":"Search parcel","searchcadastre":"Search cadastre","province":"Province","selectprov":"Select a province","municipality":"Municipality","selectmuni":"Select a municipality","estate":"Polygon","search":"Search","refCastatro":"Cadastral reference","insertCadastre":"Insert cadastre","notaRef":"Parcel code (first 14 digits). Ex.9977715VK3797F (IGN building)","consultReference":"Consult Reference","exact":"Exact address","aprox":"Approximate address","cadastral_information":"Cadastre information","reference":"Cadastral reference","description":"Description","noReference":"No reference","ignsearch":"Search places","search_direction":"Place name or address","get_direction":"Get direction at a point on the map","toponimo":"Place name"}')},function(e){e.exports=JSON.parse('{"exception":{"impl":"La implementación usada no puede crear controles LocatorscnControl.","impl_infocatastro":"La implementación usada no puede crear controles InfoCatastroControl.","impl_xylocatorscn":"La implementación usada no puede crear controles XYLocatorscnControl.","impl_ignsearchlocatorscn":"La implementación usada no puede crear controles IGNSearchLocatorscnControl.","no_controls":"El plugin Locatorscn necesita activar al menos un control.","wrong_coords":"Las coordenadas introducidas no son correctas.","transforming":"Error realizando la transformación.","wrong_values":"Algún valor introducido no es correcto. Recuerda que los minutos y los segundos tienen que tener un valor entre 0 y 59 y los grados entre 0 y 180.","mapeaerror":"No es posible establecer la conexión con el servidor de Catastro.","no_province":"Debe seleccionar una provincia.","no_mun":"Debe seleccionar un municipio.","no_polygon":"Debe seleccionar un polígono.","no_parcel":"Debe seleccionar una parcela.","json_invalid":"La respuesta no es un JSON válido:","no_refcatastro":"Debe introducir una referencia catastral.","noInfo":"PARA ESAS COORDENADAS NO HAY REFERENCIA DISPONIBLE","noresults":"No se han encontrado resultados","no_direction":"No existe dirección","error_findjsonp":"Error en la petición del servicio findJSONp.","error_candidates":"Error en la petición del servicio candidatesJSONp."},"tooltip":"Localizador","xylocatorscn":"Buscar por coordenadas","geographic":"Geográficas","zone":"huso","dms":"GMS","dd":"GD","srs":"Sistema de coordenadas","longitude":"Longitud","latitude":"Latitud","locate":"Localizar","clean":"Eliminar","north":"Norte","south":"Sur","east":"Este","west":"Oeste","infocatastro":"Buscar parcela/catastro","plot":"Parcela","searchplot":"Buscar parcela","searchcadastre":"Buscar catastro","province":"Provincia","selectprov":"Seleccione provincia","municipality":"Municipio","selectmuni":"Seleccione municipio","estate":"Polígono","search":"Buscar","refCastatro":"Referencia catastral","insertCadastre":"Insertar catastro","notaRef":"Código de parcela (14 primeros dígitos). Ej.9977715VK3797F (edificio del IGN)","consultReference":"Consultar Referencia","exact":"Dirección exacta","aprox":"Dirección aproximada","cadastral_information":"Información catastral","reference":"Referencia catastral","description":"Descripción","noReference":"No hay referencia","ignsearch":"Buscar por lugares","search_direction":"Topónimo o dirección","get_direction":"Obtener dirección en un punto del mapa","toponimo":"Toponimo"}')},function(e,t){e.exports='{{#if noresults}}\r\n<p class="m-ignsearchlocatorscn-noresults">{{translations.noresults}}</p>\r\n{{else}}\r\n<ul id="m-ignsearchlocatorscn-results-list">\r\n    {{#each places}}\r\n        {{#if this.address}}\r\n            {{#printType this.type this.address this.id this.municipality this.cps}}\r\n            {{/printType}}\r\n        {{else}}\r\n            {{#printType this.type this.title this.id this.municipality this.cps}}\r\n            {{/printType}}\r\n        {{/if}}\r\n    {{/each}}\r\n</ul>\r\n{{/if}}'},function(e,t){e.exports='<div id="m-ignsearch-panel">\r\n    <input type="text" tabindex="0" id="m-ignsearchlocatorscn-search-input" class="m-input-search" autocomplete="off" title="{{placeholder}}" placeholder="{{placeholder}}" />\r\n    {{#if reverse}}\r\n    <button type="button" tabindex="0" id="m-ignsearchlocatorscn-locate-button" title="{{translations.get_direction}}">\r\n        <i class="locatorscn-icon-locate"></i>\r\n    </button>\r\n    {{/if}}\r\n    <button type="button" tabindex="0" id="m-ignsearchlocatorscn-clean-button" title="{{translations.clean}}">\r\n        <i class="locatorscn-icon-remove"></i> {{translations.clean}}\r\n    </button>\r\n    <div id="m-ignsearchlocatorscn-results">\r\n        \x3c!-- Here goes the list of search results --\x3e\r\n    </div>\r\n</div>'},function(e,t){e.exports='<div class="m-ignsearchlocatorscn-popup">\r\n    <div class="m-ignsearchlocatorscn-small">\r\n        {{#if addressData.id}}\r\n        <div>Id: {{addressData.id}}</div>\r\n        {{/if}}\r\n        {{#if addressData.native.properties.layer}}\r\n        <div>Capa: {{addressData.native.properties.layer}}</div>\r\n        {{/if}}\r\n        {{#if addressData.geom}}\r\n        <div>{{addressData.geom}}</div>\r\n        {{/if}}\r\n    </div>\r\n    <b class="m-ignsearchlocatorscn-bold"></span> {{addressData.address}}</b>\r\n    <hr>\r\n    <div class="m-ignsearchlocatorscn-standard">\r\n        {{#if addressData.native.properties.name}}\r\n        <div><span>NOMVIA: </span> {{addressData.native.properties.street}}</div>\r\n        {{/if}}\r\n        {{#if addressData.portalNumber}}\r\n        <div><span>NUMERO: </span> {{addressData.portalNumber}}</div>\r\n        {{/if}}\r\n        {{#if addressData.postalCode}}\r\n        <div><span>CODPOSTAL: </span> {{addressData.postalCode}}</div>\r\n        {{/if}}\r\n        {{#if addressData.comunidadAutonoma}}\r\n        <div><span>CA: </span> {{addressData.comunidadAutonoma}}</div>\r\n        {{/if}}\r\n        {{#if addressData.province}}\r\n        <div><span>PROVINCIA: </span> {{addressData.province}}</div>\r\n        {{/if}}\r\n        {{#if addressData.muni}}\r\n        <div><span>MUNICIPIO: </span> {{addressData.muni}}</div>\r\n        {{/if}}\r\n        {{#if addressData.native.properties.locality}}\r\n        <div><span>NIVEL1: </span> {{addressData.native.properties.locality}}</div>\r\n        {{/if}}\r\n        {{#if addressData.native.properties.neighbourhood}}\r\n        <div><span>NIVEL2: </span> {{addressData.native.properties.neighbourhood}}</div>\r\n        {{/if}}\r\n        {{#if addressData.native.properties.source}}\r\n        <div><span>PROVEEDOR: </span> {{addressData.native.properties.source}}</div>\r\n        {{/if}}\r\n        {{#if addressData.lng}}\r\n        <div><span>LONGITUD: </span> {{addressData.lng}}</div>\r\n        {{/if}}\r\n        {{#if addressData.lat}}\r\n        <div><span>LATITUD: </span> {{addressData.lat}}</div>\r\n        {{/if}}\r\n    </div>\r\n    <hr>\r\n    <div id="m-ignsearchlocatorscn-addendum" class="m-ignsearchlocatorscn-standard">\r\n    </div>\r\n</div>'},function(e,t){e.exports='<div aria-label="Plugin Locatorscn" role="menuitem" id="div-contenedor-locatorscn" class="m-control m-container m-locatorscn">\n    {{#if showTitle}}\n        <div role="heading" tabindex="0" id="m-locatorscn-title">{{translations.headertitle}}</div>\n    {{/if}}\n    <div id="m-locatorscn-previews" class="m-hidden">\n        {{#if byPlaceAddressPostal}}\n            <div tabindex="0" id="m-locatorscn-ignsearch" title="{{translations.ignsearch}}" class="locatorscn-icon-ignsearch m-hidden"></div>\n        {{/if}}\n    </div>\n</div>'},function(e,t,r){},function(e,t,r){"use strict";r.r(t);var n=r(3),o=r.n(n),i=r(2),a=r.n(i),s=r(4),c=r.n(s);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,p(n.key),n)}}function p(e){var t=function(e,t){if("object"!=l(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==l(t)?t:String(t)}function d(e,t,r){return t=h(t),function(e,t){if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],h(e).constructor):t.apply(e,r))}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var y,m=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=d(this,t)).facadeMap_=e,r}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(t,M.impl.Control),r=t,(n=[{key:"readFromWKT",value:function(e){var t=(new ol.format.WKT).readFeature(e.geom,{dataProjection:"EPSG:4326",featureProjection:this.facadeMap_.getProjection().code}),r=e;return t.setId("f".concat((new Date).getTime())),t.setProperties(r),this.wrapComplexFeature(t),t}},{key:"wrapComplexFeature",value:function(e){var t=e.getGeometry();if(t.getType()===M.geom.wkt.type.POLYGON||t.getType()===M.geom.wkt.type.MULTI_POLYGON){var r;r=t.getType()===M.geom.wkt.type.POLYGON?t.getInteriorPoint():t.getInteriorPoints();var n=new ol.geom.GeometryCollection([r,t]);e.setGeometry(n)}}},{key:"reprojectReverse",value:function(e,t,r){return ol.proj.getTransform(t,r)(e)}},{key:"reproject",value:function(e,t){var r=ol.proj.get(e),n=ol.proj.get(this.facadeMap_.getProjection().code),o=ol.proj.transform(t,r,n);return o=[this.normalizeNumber(t[0],o[0]),this.normalizeNumber(t[1],o[1])]}},{key:"normalizeNumber",value:function(e,t){var r=e;return 0!==e&&(r=parseFloat(t.toFixed(9))),r}}])&&u(r.prototype,n),o&&u(r,o),Object.defineProperty(r,"prototype",{writable:!1}),t}(),v=r(0),g=r(1),b={en:v,es:g},S=function(){var e="es";return"function"==typeof M.language.getLang&&(e=M.language.getLang()),e},w=function(e){return"es"===e||"en"===e?b[e]:M.language.getTranslation(e).locatorscn},P=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S(),r=w(t),n="";return M.utils.isNullOrEmpty(r)?console.warn("The translation '".concat(t,"' has not been defined.")):n=e.split(".").reduce((function(e,t){return e[t]}),r),n};function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){x(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function x(e,t,r){return(t=j(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function C(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,j(n.key),n)}}function j(e){var t=function(e,t){if("object"!=_(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=_(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==_(t)?t:String(t)}function L(e,t,r){return t=T(t),function(e,t){if(t&&("object"===_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],T(e).constructor):t.apply(e,r))}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){return(k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var R=function(e){function t(e,r,n,o,i,a,s){var c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(m)&&M.exception(P("exception.impl_ignsearchlocatorscn")),(c=L(this,t,[new m(e),"IGNSearchLocatorscnImpl"])).zoom=r,c.reverse=!!M.utils.isUndefined(o.reverse)||o.reverse,c.resultVisibility=!!M.utils.isUndefined(o.resultVisibility)||o.resultVisibility,c.autocompleteLayers=o.layers||"address,street,venue",c.autocompleteSize=o.size||10,c.addendumField=o.addendum||"iderioja",c.urlAutocomplete=o.urlAutocomplete||"https://geocoder.larioja.org/v1/autocomplete",c.urlReverse=o.urlReverse||"https://geocoder.larioja.org/v1/reverse",c.reverseRadius=o.radius||100,c.reverseSources=o.sources||"",c.pointStyle=n;var l=o.peliasCoords;return M.utils.isString(l)&&(l=l.split(","),l=[Number.parseFloat(l[0]),Number.parseFloat(l[1])]),c.peliasCoords=l||[],c.reverseActivated=!1,c.useProxy=i,c.statusProxy=a,c.positionPlugin=s,c.map=e,c}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&k(e,t)}(t,M.Control),r=t,(n=[{key:"initializateAddress",value:function(e){var t=this;if((this.locationID&&this.locationID.length>0||this.requestStreet&&this.requestStreet.length>0||this.geocoderCoords&&2===this.geocoderCoords.length)&&this.active(e),this.locationID&&this.locationID.length>0&&(this.createGeometryStyles(),this.drawNomenclatorResult(this.locationID,!1)),this.requestStreet&&this.requestStreet.length>0&&(M.proxy(this.useProxy),M.remote.get(this.requestStreet).then((function(e){var r=e.text.substring(9,e.text.length-1);t.createGeometryStyles(),t.drawGeocoderResult(r)})).catch(),M.proxy(this.statusProxy)),this.geocoderCoords&&2===this.geocoderCoords.length){var r=this.getImpl().reproject("EPSG:4326",this.geocoderCoords);this.showReversePopUp({coord:r,fake:!0},!0)}}},{key:"active",value:function(e){this.html_=e;var t=this.html_.querySelector("#m-locatorscn-ignsearch").classList.contains("activated");if(this.deactive(),!t){"TC"===this.positionPlugin&&(document.querySelector(".m-plugin-locatorscn").classList.remove("m-plugin-locatorscn-tc"),document.querySelector(".m-plugin-locatorscn").classList.add("m-plugin-locatorscn-tc-withpanel")),this.html_.querySelector("#m-locatorscn-ignsearch").classList.add("activated");var r=M.template.compileSync(o.a,{vars:{reverse:this.reverse,placeholder:P("search_direction"),translations:{search_direction:P("search_direction"),get_direction:P("get_direction"),clean:P("clean")}}});document.querySelector("#div-contenedor-locatorscn").appendChild(r),this.resultsBox=this.html_.querySelector("#m-ignsearch-panel>#m-ignsearchlocatorscn-results"),this.searchInput=this.html_.querySelector("#m-ignsearch-panel>#m-ignsearchlocatorscn-search-input"),this.addEvents()}}},{key:"deactive",value:function(){this.html_.querySelector("#m-locatorscn-ignsearch").classList.remove("activated");var e=this.html_.querySelector("#m-ignsearch-panel");e&&(this.clearResults(),document.querySelector("#div-contenedor-locatorscn").removeChild(e))}},{key:"addEvents",value:function(){var e=this;this.html_.querySelector("#m-ignsearch-panel>#m-ignsearchlocatorscn-search-input").addEventListener("keyup",(function(t){return e.createTimeout(t)})),this.html_.querySelector("#m-ignsearch-panel>#m-ignsearchlocatorscn-search-input").addEventListener("click",(function(){return e.openRecentsResults()})),this.reverse&&(this.html_.querySelector("#m-ignsearch-panel>#m-ignsearchlocatorscn-search-input").style.width="160px",this.html_.querySelector("#m-ignsearch-panel>#m-ignsearchlocatorscn-locate-button").addEventListener("click",this.activateDeactivateReverse.bind(this)),this.clickReverseEvent=this.map.on(M.evt.CLICK,(function(t){return e.showReversePopUp(t)}))),this.html_.querySelector("#m-ignsearch-panel>#m-ignsearchlocatorscn-clean-button").addEventListener("click",(function(){return e.clearResults()}))}},{key:"activateDeactivateReverse",value:function(){this.reverseActivated?(this.reverseActivated=!1,this.html_.querySelector("#m-ignsearchlocatorscn-locate-button").style.color="#7A7A73",document.removeEventListener("keyup",this.checkEscKey),document.getElementsByTagName("body")[0].style.cursor="auto"):(this.invokeEscKey(),this.reverseActivated=!0,this.html_.querySelector("#m-ignsearchlocatorscn-locate-button").style.color="#71a7d3",document.addEventListener("keyup",this.checkEscKey.bind(this)),document.getElementsByTagName("body")[0].style.cursor="url(".concat(M.utils.concatUrlPaths([M.config.THEME_URL,"/img/pushpin.svg"]),") 0 20, auto"))}},{key:"invokeEscKey",value:function(){try{document.dispatchEvent(new window.KeyboardEvent("keyup",{key:"Escape",keyCode:27,code:"",which:69,shiftKey:!1,ctrlKey:!1,metaKey:!1}))}catch(e){console.error(e)}}},{key:"checkEscKey",value:function(e){"Escape"===e.key&&(this.reverseActivated=!1,this.html_.querySelector("#m-ignsearchlocatorscn-locate-button").style.color="#7A7A73",document.removeEventListener("keyup",this.checkEscKey),document.getElementsByTagName("body")[0].style.cursor="auto")}},{key:"showReversePopUp",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.reverseActivated||r){var n=this.map.getProjection().code,o="EPSG:4258",i=this.getImpl().reprojectReverse([e.coord[0],e.coord[1]],n,o),a="point.lon=".concat(i[0],"&point.lat=").concat(i[1],"&size=1&boundary.circle.radius=").concat(this.reverseRadius).concat(this.reverseSources?"&sources=".concat(this.reverseSources.replace(",","%2C")):""),s="".concat(this.urlReverse,"?").concat(a),c=e.coord;this.peliasCoords=i;var l=[i[1],i[0]],u={};M.proxy(this.useProxy),M.remote.get(s).then((function(r){if(r.text){var n=JSON.parse(r.text).features;u=t.parsePeliasToGeocoder(n[0])}else u={};t.showPopUp(u,c,l,null,e,!1)})),M.proxy(this.statusProxy)}}},{key:"createFullAddress",value:function(e){var t=null===e.tip_via||void 0===e.tip_via?"":e.tip_via,r=null===e.address||void 0===e.address?"":e.address,n=null===e.extension||void 0===e.extension?"":e.extension.trim(),o="".concat(t," ").concat(r);return M.utils.isNullOrEmpty(n)||(o+=" ".concat(n)),"".concat(o)}},{key:"createTimeout",value:function(e){var t=this;clearTimeout(y),y=setTimeout((function(){return t.searchInputValue(e)}),500)}},{key:"openRecentsResults",value:function(){var e=this;if(!this.html_.querySelector("#m-ignsearch-panel>#m-ignsearchlocatorscn-search-input").value&&!this.html_.querySelector("#m-ignsearchlocatorscn-results-list")){var t=window.localStorage.getItem("recents");if(t&&t.length>0){var r=M.template.compileSync(a.a,{vars:{noresults:!1,places:JSON.parse(t),translations:{noresults:P("exception.noresults")}}});r.querySelectorAll("li").forEach((function(t){t.addEventListener("click",(function(){e.goToLocation(t,!0)}))})),this.resultsBox.appendChild(r)}}}},{key:"searchInputValue",value:function(e){var t=this,r=e.target.value.replace(","," ");this.searchValue=r,this.resultsBox.innerHTML="",r.length>2&&(this.resultsBox.classList.add("locatorscn-icon-spinner"),this.peliasCandidates=[],this.candidatesFinished=!1,this.showCandidatesResults(),this.getCandidatesData(r,this.peliasCandidates).then((function(){t.candidatesFinished=!0,t.showCandidatesResults()})))}},{key:"generateBoundaryParams",value:function(){var e=this.map.getBbox(),t=this.getImpl().reprojectReverse([e.x.min,e.y.min],"EPSG:3857","EPSG:4326"),r=this.getImpl().reprojectReverse([e.x.max,e.y.max],"EPSG:3857","EPSG:4326"),n={min_lon:t[0],max_lon:r[0],min_lat:t[1],max_lat:r[1]};return"boundary.rect.min_lon=".concat(n.min_lon,"&boundary.rect.max_lon=").concat(n.max_lon,"&boundary.rect.min_lat=").concat(n.min_lat,"&boundary.rect.max_lat=").concat(n.max_lat)}},{key:"getCandidatesData",value:function(e,t){var r=this,n=window.encodeURIComponent(e);return new Promise((function(e){var o=r.generateBoundaryParams(),i="text=".concat(n,"&size=").concat(r.autocompleteSize,"&layers=").concat(r.autocompleteLayers.replace(",","%2C"),"&").concat(o),a="".concat(r.urlAutocomplete,"?").concat(i);M.proxy(r.useProxy),M.remote.get(a).then((function(r){if(404===r.code||500===r.code)M.dialog.error(P("exception.error_candidates"));else for(var n=JSON.parse(r.text).features,o=0;o<n.length;o+=1)t.push(n[o]);e()})),M.proxy(r.statusProxy)}))}},{key:"parsePeliasToGeocoder",value:function(e){var t=e.properties,r=e.geometry.coordinates,n=e.geometry.type;return{native:e,address:t.label,comunidadAutonoma:t.macroregion,countryCode:t.country_code,extension:t.extension,geom:"".concat(n.toUpperCase(),"(").concat(r[0]," ").concat(r[1],")"),id:t.id,lng:r[0],lat:r[1],muni:t.localadmin,municode:t.localadmin_gid,noNumber:null,poblacion:t.localadmin,portalNumber:t.housenumber,postalCode:t.postalcode,province:t.region,provinceCode:t.region_gid,refCatastral:null,state:0,stateMsg:"",tip_via:null,type:""}}},{key:"showCandidatesResults",value:function(){var e=this;this.allCandidates=[];for(var t=0;t<this.peliasCandidates.length;t+=1){var r=this.peliasCandidates[t];this.allCandidates.push(this.parsePeliasToGeocoder(r))}this.resultsBox.innerHTML="",this.resultsBox.classList.remove("locatorscn-icon-spinner");var n=M.template.compileSync(a.a,{vars:{noresults:0===this.allCandidates.length&&this.candidatesFinished,places:this.allCandidates,translations:{noresults:P("exception.noresults")}}});this.allCandidates.length>0&&n.querySelectorAll("li").forEach((function(t){t.addEventListener("click",(function(){e.goToLocation(t)}))})),this.resultsBox.appendChild(n)}},{key:"goToLocation",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.currentElement=e;var n=e.querySelector("#info").innerHTML;this.html_.querySelector("#m-ignsearchlocatorscn-search-input").value=n;var o=r?JSON.parse(window.localStorage.getItem("recents")):this.allCandidates,i=o.filter((function(e){return e.id===t.currentElement.getAttribute("id")}))[0];this.setRecents(i),this.createGeometryStyles(),Object.prototype.hasOwnProperty.call(i,"address")&&i&&this.drawPeliasResult(i),this.resultsBox.innerHTML=""}},{key:"setRecents",value:function(e){var t=JSON.parse(window.localStorage.getItem("recents"));t&&0!==t.length?this.checkDuplicateRecent(e)||(5===t.length?(t.pop(),t.unshift(e)):t.unshift(e)):t=[e],window.localStorage.setItem("recents",JSON.stringify(t))}},{key:"checkDuplicateRecent",value:function(e){var t=JSON.parse(window.localStorage.getItem("recents")),r=!1;return t.forEach((function(t){t.id===e.id&&(r=!0)})),r}},{key:"createGeometryStyles",value:function(){"pinAzul"===this.pointStyle?this.point=new M.style.Point({radius:5,icon:{src:M.utils.concatUrlPaths([M.config.THEME_URL,"/img/marker.svg"]),scale:1.4,fill:{color:"#71a7d3"},stroke:{width:30,color:"white"},anchor:[.5,1]}}):"pinRojo"===this.pointStyle?this.point=new M.style.Point({radius:5,icon:{src:M.utils.concatUrlPaths([M.config.THEME_URL,"/img/pinign.svg"]),anchor:[.5,1]}}):"pinMorado"===this.pointStyle&&(this.point=new M.style.Point({radius:5,icon:{src:M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24.svg"]),anchor:[.5,1]}})),this.simple=new M.style.Polygon({fill:{color:"black",opacity:0}})}},{key:"zoomInLocation",value:function(e,t,r,n){var o=this;if(this.html_&&(this.resultsList=this.html_.querySelector("#m-ignsearchlocatorscn-results-list")),this.clickedElementLayer instanceof M.layer.Vector){if("n"===e&&"Point"===t)this.clickedElementLayer.calculateMaxExtent().then((function(e){o.map.setBbox(e),o.map.setZoom(r),o.fire("ignsearchlocatorscn:entityFound",[e])}));else{var i=this.clickedElementLayer.getImpl().getOL3Layer().getSource().getExtent();this.map.setBbox(i),this.fire("ignsearchlocatorscn:entityFound",[i])}setTimeout((function(){M.config.MOVE_MAP_EXTRACT=!0;var e=[n.lng,n.lat],t=n.state;o.showSearchPopUp(n,e,t)}),300)}}},{key:"drawPeliasResult",value:function(e){var t=this;this.map.removeLayers(this.clickedElementLayer);var r=this.getImpl().readFromWKT(e),n=M.impl.Feature.olFeature2Facade(r),o=e;this.coordinates="".concat(o.lat,", ").concat(o.lng),this.clickedElementLayer=new M.layer.GeoJSON({name:"searchresult",source:{type:"FeatureCollection",features:[]}},{displayInLayerSwitcher:!1}),this.clickedElementLayer.displayInLayerSwitcher=!1;var i=n.getGeometry().type;this.clickedElementLayer.on(M.evt.LOAD,(function(){t.clickedElementLayer.addFeatures(n),t.zoomInLocation("g",i,t.zoom,o)})),this.map.addLayers(this.clickedElementLayer),"Point"===i&&this.clickedElementLayer.setStyle(this.point),(i.indexOf("Polygon")>-1||i.indexOf("Collection")>-1)&&this.clickedElementLayer.setStyle(new M.style.Polygon({fill:{color:"#3399CC",opacity:0},stroke:{color:"#3399CC",width:2}})),this.clickedElementLayer.setZIndex(1e17),this.resultVisibility||this.clickedElementLayer.setStyle(this.simple)}},{key:"showSearchPopUp",value:function(e,t,r){var n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=this.map.getProjection().code,a="EPSG:4326",s=this.getImpl().reprojectReverse([t[0],t[1]],a,i);n=P(1!==r?"aprox":"exact"),this.showPopUp(e,s,t,n,o)}},{key:"showPopUp",value:function(e,t,r){var n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o={content:"",title:""},i=e.native.properties.addendum[this.addendumField],a=Object.keys(i);a.sort();var s=a.filter((function(e){return i[e]})).map((function(e){return"<span>".concat(e.toUpperCase(),": </span> ").concat(i[e])})),l=M.template.compileSync(c.a,{vars:{addressData:E(E({},e),{},{geom:e.geom.replace("POINT","")}),addendum:i,addendumHTML:s},parseToHtml:!0}),u=l.querySelector("#m-ignsearchlocatorscn-addendum");s.forEach((function(e){var t=document.createElement("div");t.innerHTML=e,u.appendChild(t)})),o.content=l.innerHTML;var p=new M.Popup({});p.addTab(o),this.map.addPopup(p,[t[0],t[1]]),this.popup=p,n&&"pinAzul"===this.pointStyle?this.popup.getImpl().setOffset([0,-30]):n&&"pinRojo"===this.pointStyle?this.popup.getImpl().setOffset([2,-30]):n&&"pinMorado"===this.pointStyle&&this.popup.getImpl().setOffset([1,-20]),this.lat=t[1],this.lng=t[0]}},{key:"equals",value:function(e){return e instanceof t}},{key:"clearResults",value:function(){this.searchInput.value="",this.resultsBox.innerHTML="",this.searchValue="",this.reverse&&(this.reverseActivated=!1,this.html_.querySelector("#m-ignsearchlocatorscn-locate-button").style.color="#7A7A73",document.removeEventListener("keyup",this.checkEscKey),document.getElementsByTagName("body")[0].style.cursor="auto"),this.map.removeLayers(this.clickedElementLayer),this.map.removePopup(this.map.getPopup())}},{key:"destroy",value:function(){document.getElementsByTagName("body")[0].style.cursor="auto",document.removeEventListener("keyup",this.checkEscKey),this.map.removeLayers(this.clickedElementLayer),this.map.removePopup(this.map.getPopup())}}])&&C(r.prototype,n),i&&C(r,i),Object.defineProperty(r,"prototype",{writable:!1}),t}(),D=(r(6),r(5)),N=r.n(D);function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,B(n.key),n)}}function B(e){var t=function(e,t){if("object"!=I(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=I(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==I(t)?t:String(t)}function G(e,t,r){return t=F(t),function(e,t){if(t&&("object"===I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],F(e).constructor):t.apply(e,r))}function U(){return(U="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=z(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}}).apply(this,arguments)}function z(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=F(e)););return e}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function V(e,t){return(V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var K=function(e){function t(){return A(this,t),G(this,t,arguments)}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&V(e,t)}(t,M.impl.Control),r=t,(n=[{key:"addTo",value:function(e,r){U(F(t.prototype),"addTo",this).call(this,e,r),this.facadeMap_=e}}])&&q(r.prototype,n),o&&q(r,o),Object.defineProperty(r,"prototype",{writable:!1}),t}();function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Y(n.key),n)}}function Y(e){var t=function(e,t){if("object"!=J(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=J(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==J(t)?t:String(t)}function W(e,t,r){return t=X(t),function(e,t){if(t&&("object"===J(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],X(e).constructor):t.apply(e,r))}function X(e){return(X=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Z(e,t){return(Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var Q=function(e){function t(e,r,n,o,i,a,s,c){var l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(K)&&M.exception(P("exception.impl")),(l=W(this,t,[new K,"Locatorscn"])).searchOptions_=o,l.isDraggable_=e,l.zoom_=r,l.pointStyle_=n,l.order=i,l.useProxy=a,l.statusProxy=s,l.position=c||"TR",l.control=null,l}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z(e,t)}(t,M.Control),r=t,(n=[{key:"createView",value:function(e){var t=this;return this.map_=e,new Promise((function(e,r){var n=M.template.compileSync(N.a,{vars:{showTitle:"TC"!==t.position,byParcelCadastre:t.byParcelCadastre_,byPlaceAddressPostal:t.searchOptions_,translations:{headertitle:P("tooltip"),ignsearch:P("ignsearch")}}});t.html=n,t.searchOptions_&&(t.ignsearchControl=new R(t.map_,t.zoom_,t.pointStyle_,t.searchOptions_,t.useProxy,t.statusProxy,t.position),t.on(M.evt.ADDED_TO_MAP,(function(){t.ignsearchControl.initializateAddress(n),t.control=t.ignsearchControl,t.deactive(n,"ignsearch"),t.ignsearchControl.active(n),t.control=t.ignsearchControl})),t.ignsearchControl.on("ignsearchlocatorscn:entityFound",(function(e){t.fire("ignsearchlocatorscn:entityFound",[e])}))),t.isDraggable_&&M.utils.draggabillyPlugin(t.getPanel(),"#m-locatorscn-title"),t.accessibilityTab(n),e(n)}))}},{key:"equals",value:function(e){return e instanceof t}},{key:"deactive",value:function(e,t){var r=e.querySelectorAll("#m-locatorscn-previews .activated")[0];if("TC"===this.position&&(document.querySelector(".m-plugin-locatorscn").classList.remove("m-plugin-locatorscn-tc-withpanel"),document.querySelector(".m-plugin-locatorscn").classList.add("m-plugin-locatorscn-tc")),r&&!r.id.includes(t)){this.control.clearResults(),r.classList.remove("activated");var n=document.querySelector("#div-contenedor-locatorscn");"TC"===this.position&&n&&n.children.length>1?n.removeChild(n.children[1]):n&&n.children.length>2&&n.removeChild(n.children[2])}}},{key:"accessibilityTab",value:function(e){var t=this;e.querySelectorAll('[tabindex="0"]').forEach((function(e){return e.setAttribute("tabindex",t.order)}))}},{key:"destroy",value:function(){M.utils.isNullOrEmpty(this.ignsearchControl)||this.ignsearchControl.destroy()}}])&&H(r.prototype,n),o&&H(r,o),Object.defineProperty(r,"prototype",{writable:!1}),t}();function $(e){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,re(n.key),n)}}function re(e){var t=function(e,t){if("object"!=$(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=$(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==$(t)?t:String(t)}function ne(e,t,r){return t=oe(t),function(e,t){if(t&&("object"===$(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,function(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return function(){return!!e}()}()?Reflect.construct(t,r||[],oe(e).constructor):t.apply(e,r))}function oe(e){return(oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ie(e,t){return(ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}var ae=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ee(this,t),(e=ne(this,t)).map_=null,e.controls_=[],e.name="locatorscn",e.options=r,e.position_=r.position||"TR",e.collapsed=!!M.utils.isUndefined(r.collapsed)||r.collapsed,e.collapsible=!!M.utils.isUndefined(r.collapsible)||r.collapsible,e.tooltip_=r.tooltip||P("tooltip"),e.searchOptions=r.searchOptions||{},e.isDraggable=!M.utils.isUndefined(r.isDraggable)&&r.isDraggable,e.zoom=r.zoom||16,e.pointStyle=r.pointStyle||"pinAzul",e.order=r.order>=-1?r.order:null,e.useProxy=!!M.utils.isUndefined(r.useProxy)||r.useProxy,e.statusProxy=M.useproxy,e}var r,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ie(e,t)}(t,M.Plugin),r=t,o=[{key:"getJSONTranslations",value:function(e){return"en"===e||"es"===e?"en"===e?v:g:M.language.getTranslation(e).locatorscn}}],(n=[{key:"addTo",value:function(e){this.controls_.push(new Q(this.isDraggable,this.zoom,this.pointStyle,this.searchOptions,this.order,this.useProxy,this.statusProxy,this.position_)),this.map_=e,"TC"===this.position_&&(this.collapsible=!1),this.panel_=new M.ui.Panel("panelLocatorscn",{collapsible:this.collapsible,collapsed:this.collapsed,position:M.ui.position[this.position_],className:"m-plugin-locatorscn",tooltip:this.tooltip_,collapsedButtonClass:"locatorscn-icon-localizacion2",order:this.order}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_)}},{key:"getIGNSearchLocatorscn",value:function(){return{servicesToSearch:"",maxResults:10,noProcess:"",countryCode:"",reverse:!0,resultVisibility:!0,urlCandidates:"",urlFind:"",urlReverse:"",urlPrefix:"",urlAssistant:"",urlDispatcher:"",searchPosition:""}}},{key:"getAPIRest",value:function(){return"".concat(this.name,"=").concat(this.position_,"*").concat(this.collapsed,"*").concat(this.collapsible,"*").concat(this.tooltip_,"*").concat(this.zoom,"*").concat(this.pointStyle,"\n    *").concat(this.isDraggableE,"*").concat(this.byParcelCadastre,"*").concat(this.byCoordinates,"*").concat(this.byPlaceAddressPostal,"*").concat(this.useProxy)}},{key:"getAPIRestBase64",value:function(){return"".concat(this.name,"=base64=").concat(M.utils.encodeBase64(this.options))}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_),this.map_=null,this.controls_=null,this.panel_=null,this.name=null}},{key:"equals",value:function(e){return e instanceof t}}])&&te(r.prototype,n),o&&te(r,o),Object.defineProperty(r,"prototype",{writable:!1}),t}();window.M.control||(window.M.control={}),window.M.plugin||(window.M.plugin={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.control.IGNSearchLocatorscnControl=R,window.M.plugin.Locatorscn=ae,window.M.control.LocatorscnControl=Q,window.M.impl.control.IGNSearchLocatorscnControl=m,window.M.impl.control.LocatorscnControl=K}]);
//# sourceMappingURL=locatorscn-1.0.0.ol.min.js.map