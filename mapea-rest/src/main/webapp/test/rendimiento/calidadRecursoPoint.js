M.proxy(true);

var mapajs = M.map({
  'container': 'mapjs',
  "controls": ["layerswitcher", "mouse", "scale", "overviewmap", "panzoombar", "scaleline"],
  "getfeatureinfo": "plain"
});


var centros = new M.layer.WFS({
  name: "Centros ASSDA",
  url: "https://clientes.guadaltel.es/desarrollo/geossigc/wfs?",
  namespace: "mapea",
  name: "centrosassda",
  legend: "centrosassda",
  geometry: 'POINT',
});

mapajs.addLayers(centros);

centros.on(M.evt.LOAD, () => alert('centros cargados'));

//
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
//
//cloroplethPOINT



let stylesPoint = [
  new M.style.Point({
    fill: {
      color: '#FF0099'
    },
    radius: 6
  }),


  new M.style.Point({
    fill: {
      color: '#00AAAA'
    },
    radius: 7
  })
];

let choroplethp = new M.style.Choropleth("nregin", stylesPoint, M.style.quantification.JENKS()); //M.style.quantification.JENKS() --> f(d, l = 6) --> f(d, 2)

function choropleth() {
  let tiempo_ini = calculafecha();
  centros.setStyle(choroplethp);
  let tiempo_fin = calculafecha();
  calculadif(tiempo_ini, tiempo_fin);

}
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// //////////////////////          Category      /////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
//
// //categoryStyle Point
//
let verdepnt = new M.style.Point({
  fill: {
    color: 'green'
  },
  stroke: {
    color: 'green',
    width: 1
  },
  radius: 6
});
let amarillopnt = new M.style.Point({
  fill: {
    color: 'yellow'
  },
  stroke: {
    color: 'yellow',
    width: 1
  },
  radius: 3
});
let rojopnt = new M.style.Point({
  fill: {
    color: 'red'
  },
  stroke: {
    color: 'red',
    width: 1
  },
  radius: 6
});
let azulpnt = new M.style.Point({
  fill: {
    color: 'blue'
  },
  stroke: {
    color: 'blue',
    width: 1
  },
  radius: 21
});
//
let azulsimplepnt = new M.style.Point({
  fill: {
    color: 'blue'
  },
  stroke: {
    color: 'blue',
    width: 1
  },
  radius: 21
});
//
let categoryStylepnt = new M.style.Category("tipologia", {
  "CENTRO DE DÍA": verdepnt,
  "CENTRO DE NOCHE": rojopnt,
  "CENTRO DE PARTICIPACIÓN ACTIVA DE PERSONAS MAYORES": rojopnt,
  "CENTRO DE SERVICIOS SOCIALES COMUNITARIOS": rojopnt,
  "CENTRO RESIDENCIAL": amarillopnt,
  "CENTRO SOCIAL": azulpnt,
  "CENTRO SOCIOCULTURAL GITANO": azulpnt,
  "COMEDOR": azulpnt,
  "CONSULTAR A LA COORDINACIÓN": azulpnt
});


function categoryStyle() {

  let tiempo_ini = calculafecha();
  centros.setStyle(categoryStylepnt);
  let tiempo_fin = calculafecha();
  calculadif(tiempo_ini, tiempo_fin);

}



// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// //////////////////////          CLUSTER      //////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////


var options = {
  ranges: [
    {
      min: 2,
      max: 3,
      style: new M.style.Point({
        stroke: {
          color: '#5789aa'
        },
        fill: {
          color: '#a3c5d8',
          opacity: 0.2
        },
        radius: 20
      })
          },
    {
      min: 3,
      max: 5,
      style: new M.style.Point({
        stroke: {
          color: '#5789aa'
        },
        fill: {
          color: '#6aa8da',
          opacity: 0.4
        },
        radius: 20
      })
          },
    {
      min: 5,
      max: 10,
      style: new M.style.Point({
        stroke: {
          color: '#5789aa'
        },
        fill: {
          color: '#468cc4',
          opacity: 0.5
        },
        radius: 20
      })
          },
    {
      min: 10,
      max: 15,
      style: new M.style.Point({
        stroke: {
          color: '#5789aa'
        },
        fill: {
          color: '#2160a6',
          opacity: 0.7
        },
        radius: 20
      })
          },
    {
      min: 15,
      max: 20,
      style: new M.style.Point({
        stroke: {
          color: '#5789aa'
        },
        fill: {
          color: '#1c5fa1',
          opacity: 0.7
        },
        radius: 20
      })
          },
    {
      min: 20,
      max: 50000,
      style: new M.style.Point({
        stroke: {
          color: '#5789aa',
          width: 10
        },
        fill: {
          color: '#1c5fa1',
          opacity: 0.9
        },
        radius: 40
      })
          }
        ],
  animated: true,
  hoverInteraction: true,
  displayAmount: true,
  selectedInteraction: true,
  distance: 80
};

var vendorParameters = {
  displayInLayerSwitcherHoverLayer: false,
  distanceSelectFeatures: 15
}

let clusterpnt = new M.style.Cluster(options, vendorParameters);

function cluster() {
  let tiempo_ini = calculafecha();
  centros.setStyle(clusterpnt);
  let tiempo_fin = calculafecha();
  calculadif(tiempo_ini, tiempo_fin);
}


// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// //////////////////////          Proportional      //////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////

let proportionalpnt = new M.style.Proportional('nregin', 4, 20, new M.style.Point({
  fill: {
    color: 'green',
    opacity: 0.5
  },
  stroke: {
    color: 'green'
  }
}));


function Proportional() {
  let tiempo_ini = calculafecha();
  centros.setStyle(proportionalpnt);
  let tiempo_fin = calculafecha();
  calculadif(tiempo_ini, tiempo_fin);
}


// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// //////////////////////          Estadistica      //////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////
// ///////////////////////////////////////////////////////////////////////////////////////

const defaultChartOptions = {
  type: 'PIE',
  donutRatio: 0.5,
  radius: 25,
  offsetX: 0,
  offsetY: 0,
  variables: {
    attribute: 'nregin',
    label: {
      text: function(value, values, feature) {
        return new String(value).toString();
      },
      radiusIncrement: 10,
      stroke: {
        color: '#000',
        width: 2
      },
      fill: '#FFF',
      font: 'Comic Sans MS',
      scale: 1.25
    },
    legend: 'Datos recogidos en 2016'
  },
  fill3DColor: '#CC33DD',
  scheme: M.style.chart.schemes.Pale,
  rotateWithView: true,
  animation: true,
  stroke: {
    color: "#000",
    width: 1
  }
};

let chartStyle = new M.style.Chart(defaultChartOptions);



function estadistica() {
  let tiempo_ini = calculafecha();
  centros.setStyle(chartStyle);
  let tiempo_fin = calculafecha();
  calculadif(tiempo_ini, tiempo_fin);
}

function desX() {
  let tiempo_ini = calculafecha();
  centros.setStyle(azulsimplepnt);
  let tiempo_fin = calculafecha();
  calculadif(tiempo_ini, tiempo_fin);
}



function calculadif(tiempo_ini, tiempo_fin) {
  let milisegundos_total = 0;
  let minutos_total = 0;
  let segundos_total = 0;

  let minutos_ini = tiempo_ini.getMinutes();
  let segundos_ini = tiempo_ini.getSeconds();
  let milisegundos_ini = tiempo_ini.getMilliseconds();


  let minutos_fin = tiempo_fin.getMinutes();
  let segundos_fin = tiempo_fin.getSeconds();
  let milisegundos_fin = tiempo_fin.getMilliseconds();

  minutos_total = minutos_fin - minutos_ini;
  segundos_total = segundos_fin - segundos_ini;
  if (milisegundos_fin < milisegundos_ini) {
    milisegundos_total = milisegundos_fin;
  }
  else {
    milisegundos_total = milisegundos_fin - milisegundos_ini;
  }
  console.log("ha tardado: " + minutos_total + " minutos  " + segundos_total + " segundos  " + milisegundos_total + " milisegundos  ")
}


function calculafecha() {
  return new Date();
}
