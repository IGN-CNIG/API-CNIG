{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/templates/attributions.html","webpack:///./src/impl/ol/js/attributions.js","webpack:///./src/impl/ol/js/attributionscontrol.js","webpack:///./src/facade/js/attributionscontrol.js","webpack:///./src/facade/js/attributions.js","webpack:///./src/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Attributions","map","_this","_classCallCheck","this","_possibleConstructorReturn","_getPrototypeOf","map_","M","type","callback","getMapImpl","on","AttributionsControl","impl","Control","html","getInteractions","forEach","interaction","ol","DoubleClickZoom","dblClickInteraction_","_get","attributionscontrol_getPrototypeOf","position","closePanel","js_attributionscontrol_classCallCheck","utils","isUndefined","AttributionsImplControl","exception","js_attributionscontrol_possibleConstructorReturn","js_attributionscontrol_getPrototypeOf","_this2","Promise","success","fail","template","compileSync","vars","icon","querySelector","addEventListener","html_","control","MODES","mapAttributions","layerAttributions","mixed","options","arguments","length","undefined","attributions_classCallCheck","attributions_possibleConstructorReturn","attributions_getPrototypeOf","isNullOrEmpty","values","includes","Error","url","layerName","controls_","mode_","url_","type_","layerName_","layer_","layer","scale_","scale","attributionParam_","attributionParam","urlParam_","urlParam","minWidth_","minWidth","maxWidth_","maxWidth","position_","defaultAttribution_","defaultAttribution","defaultURL_","defaultURL","tooltip_","tooltip","window","e","setCollapsiblePanel","Plugin","impl_","AttributionsImpl","control_","push","panel_","ui","Panel","collapsible","innerWidth","className","collapsedButtonClass","addControls","addPanels","initMode","onMoveEnd","changeAttributions","Vector","optionsLayer","GeoJSON","KML","getLayers","addLayers","displayInLayerSwitcher","setVisible","clearContent","getScale","getMapAttributions","addContent","attribution","attributions","getElement","links","attrOpt","index","arr","link","document","createElement","target","href","innerText","div","append","querySelectorAll","child","removeChild","visibility","style","display","_this3","updateBBoxFeature","featuresAttributions","getFeatures","filter","spatial","INTERSECT","bboxFeature_","execute","feature","getAttribute","element","array","indexOf","getPanel","collapse","content","changeContent","_this$map_$getBbox","getBbox","x","y","Feature","properties","geometry","coordinates","min","max","getTemplatePanel","classList","remove","add","registerEvent","plugin","M$plugin$Attributions","M$control$AttributionsControl","M$impl$control$AttributionsControl"],"mappings":"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","file":"attributions.ol.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","module.exports = \"<div id=\\\"m-attributions-container\\\" class=\\\"m-control m-container m-attributions\\\">\\n    <button id='close-button' class=\\\"{{icon}}\\\"></button>\\n</div>\";","/**\n * @classdesc\n */\nclass Attributions extends M.Object {\n  /**\n   * @constructor\n   */\n  constructor(map) {\n    super();\n\n    /**\n     * Map of the plugin\n     * @private\n     * @type {M.Map}\n     */\n    this.map_ = map;\n  }\n\n  /**\n   * Register events in ol.Map of M.Map\n   * @public\n   * @function\n   */\n  registerEvent(type, callback) {\n    const olMap = this.map_.getMapImpl();\n\n    olMap.on(type, callback);\n  }\n}\n\nexport default Attributions;\n","/**\n * @module M/impl/control/AttributionsControl\n */\nexport default class AttributionsControl extends M.impl.Control {\n  /**\n   * This function adds the control to the specified map\n   *\n   * @public\n   * @function\n   * @param {M.Map} map to add the plugin\n   * @param {HTMLElement} html of the plugin\n   * @api stable\n   */\n  addTo(map, html) {\n    const olMap = map.getMapImpl();\n    olMap.getInteractions().forEach((interaction) => {\n      if (interaction instanceof ol.interaction.DoubleClickZoom) {\n        this.dblClickInteraction_ = interaction;\n      }\n    });\n    // super addTo - don't delete\n    super.addTo(map, html);\n  }\n}\n","/**\n * @module M/control/AttributionsControl\n */\nimport AttributionsImplControl from 'impl/attributionscontrol';\nimport template from 'templates/attributions';\n\n/**\n * @classdesc\n * Main constructor of the class. Creates a PluginControl\n * control\n */\nexport default class AttributionsControl extends M.Control {\n  /**\n   * @constructor\n   * @extends {M.Control}\n   * @api\n   */\n  constructor(position, closePanel) {\n    if (M.utils.isUndefined(AttributionsImplControl)) {\n      M.exception('La implementaciÃ³n usada no puede crear controles AttributionsControl');\n    }\n    const impl = new AttributionsImplControl();\n    super(impl, 'Attributions');\n    this.position = position;\n    this.closePanel = closePanel;\n  }\n\n  /**\n   * This function creates the view\n   *\n   * @public\n   * @function\n   * @param {M.Map} map to add the control\n   * @api\n   */\n  createView(map) {\n    this.map = map;\n    return new Promise((success, fail) => {\n      const html = M.template.compileSync(template, {\n        vars: {\n          icon: this.position === 'BR' || this.position === 'TR' ?\n            'g-cartografia-flecha-derecha' : 'g-cartografia-flecha-izquierda',\n        },\n      });\n      html.querySelector('#close-button').addEventListener('click', () => this.closePanel());\n      this.html_ = html;\n\n      success(html);\n    });\n  }\n\n  /**\n   * This function compares controls\n   *\n   * @public\n   * @function\n   * @param {M.Control} control to compare\n   * @api\n   */\n  equals(control) {\n    return control instanceof AttributionsControl;\n  }\n}\n","/**\n * @module M/plugin/Attributions\n */\nimport 'assets/css/attributions';\nimport AttributionsImpl from 'impl/attributions';\nimport AttributionsControl from './attributionscontrol';\n\nconst MODES = {\n  mapAttributions: 1, // Map attributions from vector layer\n  layerAttributions: 2, // Attributions layer from its capabilities wms service\n  mixed: 3, // Mixed mode ( 1 + 2)\n};\n\n/**\n * @typedef {AttributionsOptions}\n *\n * The mode according to which the plugin will consult the attributions.\n * @param {mode}\n * @type {number}\n *\n *\n * @param {url}\n * @type {URLLike}\n */\n\n/**\n * Class of attributions plugin\n * @param {object}\n * @classdesc\n */\nexport default class Attributions extends M.Plugin {\n  /**\n   * @constructor\n   * @extends {M.Plugin}\n   * @param {AttributionsOptions} options\n   * @api\n   */\n  constructor(options = {}) {\n    super();\n\n    if (M.utils.isNullOrEmpty(options.mode) || !Object.values(MODES).includes(options.mode)) {\n      throw new Error('Options mode is bad setted. Tip: {mode: 1 | 2 | 3}, ...');\n    }\n\n    if (options.mode === MODES.mapAttributions && !M.utils.isNullOrEmpty(options.url)) {\n      if (M.utils.isNullOrEmpty(options.type)) {\n        throw new Error('Missing \"type\" options. When \"url\" option is setted the plugin needs \"type\" option. Values = geojson | kml | topojson');\n      }\n    }\n\n    if (options.mode === MODES.mapAttributions && !M.utils.isNullOrEmpty(options.layerName)) {\n      if (M.utils.isNullOrEmpty(options.type)) {\n        throw new Error('Missing \"layerName\" options. When \"url\" option is setted the plugin needs \"layerName\" option.');\n      }\n    }\n\n    /**\n     * Facade of the map\n     *\n     * @private\n     * @type {M.Map}\n     */\n    this.map_ = null;\n\n    /**\n     * Array of controls\n     *\n     * @private\n     * @type {Array<M.Control>}\n     */\n    this.controls_ = [];\n\n    /**\n     * Mode of the plugin\n     *\n     * @private\n     * @type {number}\n     */\n    this.mode_ = options.mode;\n\n    /**\n     * Vectorial service attributions\n     *\n     * @private\n     * @type {URLLike}\n     */\n    this.url_ = options.url || 'https://componentes.ign.es/NucleoVisualizador/vectorial_examples/atribucionPNOA.kml';\n\n    /**\n     * Type of the data url\n     *\n     * @private\n     * @type {string}\n     */\n    this.type_ = options.type || 'kml';\n\n    /**\n     * The name of the vector layer hat contains the attribution information.\n     *\n     * @private\n     * @type {string}\n     */\n    this.layerName_ = options.layerName || 'attributions';\n\n    /**\n     * Layer of Mapea with attributions\n     *\n     * @private\n     * @type {M.layer.GeoJSON | M.layer.KML}\n     */\n    this.layer_ = options.layer;\n\n    /**\n     * Zoom from which attributions are displayed\n     *\n     * @private\n     * @type {number}\n     */\n    this.scale_ = options.scale || 10000;\n\n    /**\n     * Parameter of the features of the layer that contains the information of the attributions.\n     *\n     * @private\n     * @type {string}\n     */\n    this.attributionParam_ = options.attributionParam || 'atribucion';\n\n    /**\n     * Parameter of the features of the layer that contains the information of the URL.\n     * @private\n     * @type {URLLike}\n     */\n    this.urlParam_ = options.urlParam || 'url';\n\n    /**\n     * Minimum width of the view control\n     * @private\n     * @type {string}\n     */\n    this.minWidth_ = options.minWidth || '100px';\n\n    /**\n     * Minimum width of the view control\n     * @private\n     * @type {string}\n     */\n    this.maxWidth_ = options.maxWidth || '200px';\n\n    /**\n     * Position of the view control\n     * @private\n     * @type {string}\n     */\n    this.position_ = options.position || 'BL';\n\n    /**\n     * Default text attribution\n     *\n     * @private\n     * @type {string}\n     */\n    this.defaultAttribution_ = options.defaultAttribution;\n\n    /**\n     * Default url attribution\n     *\n     * @private\n     * @type {string}\n     */\n    this.defaultURL_ = options.defaultURL;\n\n    /**\n     * Tooltip of the UI Plugin\n     *\n     * @private\n     * @type {string}\n     */\n    this.tooltip_ = options.tooltip || 'Reconocimientos';\n\n    window.addEventListener('resize', e => this.setCollapsiblePanel(e));\n  }\n\n  /**\n   * This function adds this plugin into the map\n   *\n   * @public\n   * @function\n   * @param {M.Map} map the map to add the plugin\n   * @api stable\n   */\n  addTo(map) {\n    this.map_ = map;\n    this.impl_ = new AttributionsImpl(map);\n    this.control_ = new AttributionsControl(this.position_, this.closePanel);\n    this.controls_.push(this.control_);\n\n    this.panel_ = new M.ui.Panel('Attributions', {\n      collapsible: window.innerWidth < 769,\n      position: M.ui.position[this.position_],\n      className: 'm-panel-attributions',\n      collapsedButtonClass: 'g-cartografia-info',\n      tooltip: this.tooltip_,\n    });\n\n    this.panel_.addControls(this.control_);\n\n    this.map_.addPanels(this.panel_);\n    this.initMode();\n\n    this.onMoveEnd(() => {\n      this.changeAttributions();\n    });\n  }\n\n  /**\n   * @public\n   * @function\n   */\n  initMode() {\n    if (this.mode_ === MODES.mapAttributions) {\n      if (!(this.layer_ instanceof M.layer.Vector)) {\n        const optionsLayer = {\n          name: this.layerName_,\n          url: this.url_,\n        };\n\n        if (this.type_ === 'geojson') {\n          this.layer_ = new M.layer.GeoJSON(optionsLayer);\n        } else if (this.type_ === 'kml') {\n          this.layer_ = new M.layer.KML(optionsLayer);\n        } else if (this.type === 'topojson') {\n          // TODO: Implement in Mapea M.layer.TopoJSON\n        }\n      }\n\n      if (this.map_.getLayers({ name: this.layer_ }).length < 1) {\n        this.map_.addLayers(this.layer_);\n        this.layer_.displayInLayerSwitcher = false;\n        this.layer_.setVisible(false);\n      }\n    }\n  }\n\n\n  /**\n   * This method shows the layer attributions\n   *\n   * @function\n   * @public\n   */\n  changeAttributions() {\n    this.clearContent();\n    if (this.map_.getScale() <= this.scale_) {\n      this.setVisible(true);\n      let mapAttributions = [];\n      if (this.mode_ === MODES.mapAttributions) {\n        mapAttributions = this.getMapAttributions();\n      } else if (this.mode_ === MODES.layerAttributions) {\n        // TODO:\n      } else if (this.mode === MODES.mixed) {\n        // TODO:\n      }\n\n      this.addContent(mapAttributions);\n    } else if (typeof this.defaultAttribution_ !== 'string') {\n      this.setVisible(false);\n    } else {\n      this.addContent([{\n        attribution: this.defaultAttribution_,\n        url: this.defaultURL_,\n      }]);\n    }\n  }\n\n  /**\n   * This method adds the text content to the view attribution\n   *\n   * @function\n   * @public\n   */\n  addContent(attributions) {\n    const html = this.control_.getElement();\n    const links = attributions.map((attrOpt, index, arr) => {\n      const link = document.createElement('a');\n      link.target = '_blank';\n      link.href = attrOpt.url;\n      link.innerText = attrOpt.attribution;\n      link.innerText += arr.length - 1 === index ? '' : ',';\n      return link;\n    });\n    const div = document.createElement('div');\n    links.forEach((link) => {\n      div.append(link);\n    });\n    html.append(div);\n  }\n\n  /**\n   * This method adds the text content to the view attribution\n   *\n   * @function\n   * @public\n   */\n  clearContent() {\n    const html = this.control_.getElement();\n    html.querySelectorAll('div').forEach(child => html.removeChild(child));\n  }\n\n  /**\n   * This method toggle de visibility of the view attribution\n   */\n  setVisible(visibility) {\n    const html = this.control_.getElement();\n    html.style.display = visibility === false ? 'none' : '';\n  }\n\n  /**\n   * @function\n   * @public\n   */\n  getMapAttributions() {\n    this.updateBBoxFeature();\n    const featuresAttributions = this.layer_.getFeatures();\n    const intersect = new M.filter.spatial.INTERSECT(this.bboxFeature_);\n    const filteredFeatures = intersect.execute(featuresAttributions);\n    return filteredFeatures.map((feature) => {\n      return {\n        attribution: feature.getAttribute(this.attributionParam_),\n        url: feature.getAttribute(this.urlParam_) || this.defaultURL_,\n      };\n    }).filter((element, index, array) => // remove repeat elements\n      array.map(e => e.attribution).indexOf(element.attribution) === index);\n  }\n\n  /**\n   * @function\n   * @public\n   */\n  getLayerAttributions() {\n    // TODO:\n  }\n\n  /**\n   * @function\n   * @public\n   */\n  closePanel() {\n    this.getPanel().collapse();\n  }\n\n  /**\n   * @function\n   * @public\n   */\n  changeContentAttribution(content) {\n    this.control_.changeContent(content);\n  }\n\n  /**\n   * @function\n   * @public\n   */\n  updateBBoxFeature() {\n    const { x, y } = this.map_.getBbox();\n    this.bboxFeature_ = new M.Feature('bbox_feature', {\n      type: 'Feature',\n      properties: {},\n      geometry: {\n        type: 'Polygon',\n        coordinates: [\n          [\n            [x.min, y.min],\n            [x.min, y.max],\n            [x.max, y.max],\n            [x.max, y.min],\n            [x.min, y.min],\n          ],\n        ],\n      },\n    });\n  }\n\n  /**\n   * @function\n   * @public\n   */\n  setCollapsiblePanel(e) {\n    if (this.getPanel() && this.getPanel().getTemplatePanel()) {\n      if (e.target.innerWidth < 769) {\n        this.getPanel().getTemplatePanel().classList.remove('no-collapsible');\n        this.closePanel();\n      } else {\n        this.getPanel().getTemplatePanel().classList.add('no-collapsible');\n        this.getPanel().getTemplatePanel().classList.remove('collapsed');\n      }\n    }\n  }\n  /**\n   * @function\n   * @public\n   */\n  onMoveEnd(callback) {\n    this.impl_.registerEvent('moveend', e => callback(e));\n  }\n\n  /**\n   * @function\n   * @public\n   */\n  getPanel() {\n    return this.panel_;\n  }\n\n  /**\n   * Name of the plugin\n   *\n   * @getter\n   * @function\n   */\n  get name() {\n    return 'Attributions';\n  }\n}\n","import M$plugin$Attributions from './/facade/js/attributions';\nimport M$control$AttributionsControl from './/facade/js/attributionscontrol';\nimport M$impl$control$AttributionsControl from './/impl/ol/js/attributionscontrol';\n\nif (!window.M.plugin) window.M.plugin = {};\nif (!window.M.control) window.M.control = {};\nif (!window.M.impl) window.M.impl = {};\nif (!window.M.impl.control) window.M.impl.control = {};\nwindow.M.plugin.Attributions = M$plugin$Attributions;\nwindow.M.control.AttributionsControl = M$control$AttributionsControl;\nwindow.M.impl.control.AttributionsControl = M$impl$control$AttributionsControl;\n"],"sourceRoot":""}