!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t){e.exports='{{#*inline "fulltocLayer"}}\n  {{#each layers}}\n    <li class="m-layer {{#if outOfRange}}disabled{{/if}}{{#if visible}} visible{{/if}}">\n      <div class="m-title-container">\n        <div class="m-visible-control">\n          <span data-layer-name="{{id}}" data-layer-url="{{url}}" class="m-check {{#if visible}}icon-ver{{^}}icon-ocultar{{/if}}"></span>\n        </div>\n        <div class="m-title">\n          <table>\n            <tbody>\n              <tr>\n                <td><span class="m-layer-type">{{type}}</span></td>\n                <td><span class="m-layer-name">{{title}}</span></td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n      {{#if visible}}\n        <div class="m-tools">\n          <div class="m-opacity-container">\n            <input type="range" data-layer-name="{{id}}" data-layer-url="{{url}}" class="m-fulltoc-transparency" min="0" max="1" step="0.1" value="{{opacity}}" {{#unless visible}} disabled {{/unless}}\n              {{#if outOfRange}} disabled {{/if}} />\n          </div>\n          <div class="m-action-tools">\n            <span title="{{../translations.show_hide}}" data-layer-name="{{id}}" data-layer-url="{{url}}" class="icon-leyenda m-fulltoc-legend"></span>\n            <span title="{{../translations.zoom}}" data-layer-name="{{id}}" data-layer-url="{{url}}" class="icon-localizacion3 m-fulltoc-zoom"></span>\n            {{#if metadata}}\n              <span title="{{../translations.info_metadata}}" data-layer-name="{{id}}" data-layer-url="{{url}}" class="icon-info m-fulltoc-info"></span>\n            {{/if}}\n            {{#if hasStyles}}\n              <span title="{{../translations.change_style}}" data-layer-name="{{id}}" data-layer-url="{{url}}" class="icon-pincel m-fulltoc-config"></span>\n            {{/if}}\n            <span title="{{../translations.remove_layer}}" data-layer-name="{{id}}" data-layer-url="{{url}}" class="icon-papelera m-fulltoc-remove"></span>\n          </div>\n        </div>\n        <div class="m-legend">\n          <img data-layer-name="{{id}}" data-layer-url="{{url}}" src="{{legend}}"></img>\n        </div>\n      {{/if}}\n    </li>\n  {{/each}}\n  {{/inline}}\n    <div class="m-control m-fulltoc-container">\n      <div class="m-layersiwtcher-panel" id="m-fulltoc-panel">\n        <ul>\n          <li class="m-group">\n            <div class="m-title">\n              <span class="span-title">{{translations.layers}}</span>\n              <span title="{{translations.add_service}}" class="icon-add m-fulltoc-addservice"></span>\n            </div>\n            {{#gt overlayLayers.length 0}}\n              <ul class="m-layers" title="{{translations.drag_drop}}">\n                {{> fulltocLayer layers=overlayLayers}}\n              </ul>\n            {{/gt}}\n          </li>\n        </ul>\n      </div>\n    </div>\n'},function(e,t){e.exports='<div id="m-fulltoc-change-config">\n    <div class="select-container">\n      <select id="m-fulltoc-style-select">\n          <option disabled="disabled" value="" selected="selected">{{translations.select_style}}</option>\n          {{#each styles}}\n              <option value="{{Name}}">{{Title}}</option>\n          {{/each}}\n      </select>\n    </div>\n    <div class="btn-container">\n      <button class="m-fulltoc-common-btn">{{translations.change}}</button>\n    </div>\n</div>\n'},function(e,t){e.exports='<div id="m-fulltoc-information">\n  <div class="m-fulltoc-info-capabilities">\n    <p><span>{{translations.title}}:</span>&nbsp; {{title}}</p>\n    <p><span>{{translations.name}}:</span>&nbsp; {{name}}</p>\n    <p style="margin-bottom: 0.2rem;"><span>{{translations.abstract}}:</span></p>\n    <div>\n      {{abstract}}\n    </div>\n    {{#if provider}}\n      <p style="margin-bottom: 0.2rem;"><span>{{translations.provider}}:</span></p>\n    {{/if}}\n    {{#if provider}}\n      <div>\n        {{{provider}}}\n      </div>\n    {{/if}}\n    {{#if extended}}\n      <div>\n        <p class="show-more-metadata"><span class="icon-desplegar"></span>&nbsp;{{translations.see_more}}</p>\n        <div class="more-metadata">\n          {{#if metadataService}}\n            <p style="margin-bottom: 0.2rem;"><span>{{translations.title}}:</span></p>\n          {{/if}}\n          {{#if metadataService}}\n            <div>\n              {{metadataService}}\n            </div>\n          {{/if}}\n\n          {{#if metadataAbstract}}\n            <p style="margin-bottom: 0.2rem;"><span>{{translations.metadata_abstract}}:</span></p>\n          {{/if}}\n          {{#if metadataAbstract}}\n            <div>\n              {{metadataAbstract}}\n            </div>\n          {{/if}}\n\n          {{#if responsible}}\n            <p style="margin-bottom: 0.2rem;"><span>{{translations.responsible}}:</span></p>\n          {{/if}}\n          {{#if responsible}}\n            <div>\n              {{{responsible}}}\n            </div>\n          {{/if}}\n\n          {{#if accessConstraint}}\n            <p style="margin-bottom: 0.2rem;"><span>{{translations.access_constraints}}:</span></p>\n          {{/if}}\n          {{#if accessConstraint}}\n            <div>\n              {{accessConstraint}}\n            </div>\n          {{/if}}\n\n          {{#if useConstraint}}\n            <p style="margin-bottom: 0.2rem;"><span>{{translations.use_constraints}}:</span></p>\n          {{/if}}\n          {{#if useConstraint}}\n            <div>\n              {{useConstraint}}\n            </div>\n          {{/if}}\n\n          {{#if onlineResources}}\n            <p><span>{{translations.online_resources}}:</span></p>\n            <ul>\n            {{#each onlineResources}}\n              <li><a href="{{url}}" target="_blank">{{name}}</a></li>\n            {{/each}}\n            </ul>\n          {{/if}}\n        </div>\n      </div>\n    {{/if}}\n  </div>\n  <div class="btn-container">\n    {{#if metadata}}\n      <a class="m-fulltoc-common-btn" href="{{metadata}}" target="_blank">{{translations.query_metadata}}</a>\n    {{/if}}\n    {{#if downloadCenter}}\n      <a class="m-fulltoc-common-btn" href="{{downloadCenter}}" target="_blank">{{translations.download_center}}</a>\n    {{/if}}\n  </div>\n</div>\n'},function(e,t){e.exports='<div class="m-fulltoc-addservices">\n    <div class="m-fulltoc-service-type-container">\n      <div>\n        <input type="radio" id="m-fulltoc-addservices-wms" name="service-type" value="wms" checked="checked"><label for="m-fulltoc-addservices-wms">WMS</label>\n      </div>\n      <div>\n        <input type="radio" id="m-fulltoc-addservices-wmts" name="service-type" value="wmts"><label for="m-fulltoc-addservices-wmts">WMTS</label>\n      </div>\n    </div>\n    <div class="search-panel">\n        <input type="text" id="m-fulltoc-addservices-search-input" placeholder="{{translations.url_service}}" class="m-input-search" />\n        <span id="m-fulltoc-addservices-search-btn" class="icon-zoom m-search-btn" title="{{translations.query}}"></span>\n        {{#if hasPrecharged}}\n          <span id="m-fulltoc-addservices-list-btn" class="icon-lista m-search-btn" title="{{translations.loaded_services}}"></span>\n        {{/if}}\n        {{#if codsiActive}}\n          <span id="m-fulltoc-addservices-codsi-btn" class="icon-codsi m-search-btn" title="{{translations.codsi_services}}"></span>\n        {{/if}}\n        \x3c!-- <span id="m-fulltoc-addservices-clear-btn" class="icon-cancelar m-clear-btn" title="{{translations.clean}}"></span> --\x3e\n    </div>\n    <div id="m-fulltoc-addservices-suggestions" style="display: block;">\n      <table style="width: 100%;">\n        <thead>\n          <tr><th>{{translations.availables}}</th></tr>\n        </thead>\n        <tbody>\n          {{#each precharged.groups}}\n            <tr><td>\n              <span class="m-fulltoc-suggestion-caret">{{name}}</span>\n              <ul class="m-fulltoc-suggestion-group">\n                {{#each services}}\n                  <li><span class="m-fulltoc-suggestion" data-service-type="{{type}}" data-link="{{url}}">{{name}}</span></li>\n                {{/each}}\n              </ul>\n            </td></tr>\n          {{/each}}\n          {{#each precharged.services}}\n            <tr><td><span class="m-fulltoc-suggestion" data-service-type="{{type}}" data-link="{{url}}">{{name}}</span></td></tr>\n          {{/each}}\n        </tbody>\n      </table>\n    </div>\n    {{#if codsiActive}}\n      <div id="m-fulltoc-addservices-codsi" style="display: none;">\n        <p><a href="http://www.idee.es/csw-codsi-idee/srv/spa/catalog.search#/home" target="_blank">{{translations.codsi_services}}</a></p>\n        <div class="m-fulltoc-addservices-codsi-search-panel">\n            <input type="text" id="m-fulltoc-addservices-codsi-search-input" placeholder="{{translations.filter_text}}" class="m-input-search" />\n            <span id="m-fulltoc-addservices-codsi-filter-btn" class="icon-zoom m-filter-btn" title="{{translations.filter_results}}"></span>\n            <span id="m-fulltoc-addservices-codsi-clean-btn" class="icon-papelera m-clean-btn" title="{{translations.clean_filter}}"></span>\n        </div>\n        <div id="m-fulltoc-addservices-codsi-results">\n        </div>\n        <div id="m-fulltoc-addservices-codsi-pagination">\n        </div>\n      </div>\n    {{/if}}\n    <div id="m-fulltoc-addservices-results"></div>\n</div>\n'},function(e,t){e.exports='<div>\n    <div class="m-fulltoc-service-capabilities">\n      <p class="m-fulltoc-show-capabilities"><span class="icon-desplegar"></span>&nbsp;{{translations.show_service_info}}</p>\n      <div class="m-fulltoc-capabilities-container">\n        {{#if serviceCapabilities.title}}\n          <p style="margin-bottom: 0.2rem;"><span>{{translations.title}}:</span></p>\n        {{/if}}\n        {{#if serviceCapabilities.title}}\n          <div>\n            {{serviceCapabilities.title}}\n          </div>\n        {{/if}}\n\n        {{#if serviceCapabilities.abstract}}\n          <p style="margin-bottom: 0.2rem;"><span>{{translations.abstract}}:</span></p>\n        {{/if}}\n        {{#if serviceCapabilities.abstract}}\n          <div>\n            {{serviceCapabilities.abstract}}\n          </div>\n        {{/if}}\n\n        {{#if serviceCapabilities.contact}}\n          <p style="margin-bottom: 0.2rem;"><span>{{translations.responsible}}:</span></p>\n        {{/if}}\n        {{#if serviceCapabilities.contact}}\n          <div>\n            {{{serviceCapabilities.contact}}}\n          </div>\n        {{/if}}\n\n        {{#if serviceCapabilities.accessConstraints}}\n          <p style="margin-bottom: 0.2rem;"><span>{{translations.access_constraints}}:</span></p>\n        {{/if}}\n        {{#if serviceCapabilities.accessConstraints}}\n          <div>\n            {{serviceCapabilities.accessConstraints}}\n          </div>\n        {{/if}}\n      </div>\n    </div>\n    <div class="table-results">\n      <div class="table-container">\n        <table style="width: 100%;">\n            <thead>\n              <tr>\n                  <th><span id="m-fulltoc-addservices-selectall" class="icon-check"></span></th>\n                  <th>{{translations.layers}}</th>\n              </tr>\n            </thead>\n            <tbody>\n                {{#each result}}\n                    <tr>\n                      <td style="text-align: center;"><span id="{{name}}" name="{{name}}" class="m-check-fulltoc-addservices icon-check"></span></td>\n                      <td class="table-layer-name" name="{{name}}" title="{{abstract}}">{{legend}}</td>\n                    </tr>\n                {{/each}}\n            </tbody>\n        </table>\n      </div>\n      <div class="button">\n        <button class="m-fulltoc-addservices-add m-fulltoc-common-btn">{{translations.add}}</button>\n      </div>\n    </div>\n</div>\n'},function(e){e.exports=JSON.parse('{"exception":{"impl":"The implementation used cannot create FullTOCControl.","extent":"Cannot get the extent of the layer","capabilities":"An error has occurred in obtaining the GetCapabilities document","only_http":"Only http services are allowed","only_https":"Only https services are allowed","no_http_https":"No http or https services allowed","valid_url":"You must provide a valid URL","empty":"The fields are empty","select_layer":"You must select at least one layer","no_results":"No layers found in this service","codsi":"An error occurred while consulting the CODSI catalog","codsi_no_results":"There are no results for your search"},"tooltip":"Layers","info":"Information","configure_layer":"Configure layer","close":"Close","load_ext_services":"Load geographic information layers","layers":"Layers","add_service":"Add service","show_hide":"Show/Hide legend","zoom":"Zoom to the layer","info_metadata":"View information","change_style":"Change style","remove_layer":"Remove layer from map","select_style":"Select a style","change":"Change","url_service":"Service URL","query":"Consult","loaded_services":"Preloaded geographic information layers","codsi_services":"INSPIRE Services Catalog (CODSI)","clean":"Clean search","availables":"Preloaded geographic information layers available","title":"Title","name":"Name","abstract":"Abstract","provider":"Provider","query_metadata":"Consult metadata","download_center":"Download center","add":"Add","drag_drop":"Drag and drop to change display order","see_more":"Show dataset metadata","see_less":"Hide dataset metadata","service":"Service","metadata_abstract":"Abstract (metadata)","responsible":"Responsible","access_constraints":"Access constraints","use_constraints":"Use constraints","online_resources":"Online resources","show_service_info":"Show service information","hide_service_info":"Hide service information","filter_results":"Filter results","clean_filter":"Clean filter","filter_text":"Text to search"}')},function(e){e.exports=JSON.parse('{"exception":{"impl":"La implementación usada no puede crear controles FullTOCControl.","extent":"No se puede obtener la extensión de la capa","capabilities":"Ha ocurrido un error al obtener el documento GetCapabilities","only_http":"Sólo se permiten servicios http","only_https":"Sólo se permiten servicios https","no_http_https":"No se permiten servicios http ni https","valid_url":"Debes indicar una URL válida","empty":"Los campos están vacíos","select_layer":"Debes seleccionar al menos una capa","no_results":"No se han encontrado capas en este servicio","codsi":"Ha ocurrido un error al consultar el catálogo CODSI","codsi_no_results":"No hay resultados para su búsqueda"},"tooltip":"Capas","info":"Información","configure_layer":"Configurar capa","close":"Cerrar","load_ext_services":"Cargar capas de información geográfica","layers":"Capas","add_service":"Añadir servicio","show_hide":"Mostrar/Ocultar leyenda","zoom":"Zoom a la capa","info_metadata":"Ver información","change_style":"Cambiar estilo","remove_layer":"Eliminar capa del mapa","select_style":"Selecciona un estilo","change":"Cambiar","url_service":"URL del servicio","query":"Consultar","loaded_services":"Capas de información geográfica","codsi_services":"Catálogo de Servicios INSPIRE (CODSI)","clean":"Limpiar búsqueda","availables":"Capas de información geográfica disponibles","title":"Título","name":"Nombre","abstract":"Resumen","provider":"Proveedor","query_metadata":"Consultar metadato","download_center":"Centro de descargas","add":"Añadir","drag_drop":"Arrastre y suelte para cambiar el orden de visualización","see_more":"Mostrar metadato del conjunto de datos","see_less":"Ocultar metadato del conjunto de datos","service":"Servicio","metadata_abstract":"Resumen (metadato)","responsible":"Responsable","access_constraints":"Restricciones de acceso","use_constraints":"Restricciones de uso","online_resources":"Recursos online","show_service_info":"Mostrar información del servicio","hide_service_info":"Ocultar información del servicio","filter_results":"Filtrar resultados","clean_filter":"Limpiar filtro","filter_text":"Texto a buscar"}')},function(e){e.exports=JSON.parse('{"url":{"name":"fulltoc","separator":"*"},"constructor":"M.plugin.FullTOC","parameters":[{"type":"object","properties":[{"type":"simple","name":"position","position":0,"possibleValues":["TL","TR","BL","BR"]},{"type":"boolean","name":"collapsed","position":1},{"type":"boolean","name":"http","position":2},{"type":"boolean","name":"https","position":3},{"type":"boolean","name":"codsi","position":4}]}],"files":{"ol":{"scripts":["fulltoc.ol.min.js"],"styles":["fulltoc.ol.min.css"]}},"metadata":{"name":"FullTOC","description":"","text":"","version":"1.0.0","date":"2020-06-01","author":"Guadaltel","org":"CNIG","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg"}}')},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(8),n(9);
/**!
 * Sortable 1.10.2
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */
function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),i.forEach(function(t){a(e,t,n[t])})}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function l(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var c=l(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),d=l(/Edge/i),u=l(/firefox/i),p=l(/safari/i)&&!l(/chrome/i)&&!l(/android/i),f=l(/iP(ad|od|hone)/i),m=l(/chrome/i)&&l(/android/i),h={capture:!1,passive:!1};function v(e,t,n){e.addEventListener(t,n,!c&&h)}function g(e,t,n){e.removeEventListener(t,n,!c&&h)}function y(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(e){return!1}return!1}}function b(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function _(e,t,n,i){if(e){n=n||document;do{if(null!=t&&(">"===t[0]?e.parentNode===n&&y(e,t):y(e,t))||i&&e===n)return e;if(e===n)break}while(e=b(e))}return null}var w,S=/\s+/g;function E(e,t,n){if(e&&t)if(e.classList)e.classList[n?"add":"remove"](t);else{var i=(" "+e.className+" ").replace(S," ").replace(" "+t+" "," ");e.className=(i+(n?" "+t:"")).replace(S," ")}}function C(e,t,n){var i=e&&e.style;if(i){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),void 0===t?n:n[t];t in i||-1!==t.indexOf("webkit")||(t="-webkit-"+t),i[t]=n+("string"==typeof n?"":"px")}}function O(e,t){var n="";if("string"==typeof e)n=e;else do{var i=C(e,"transform");i&&"none"!==i&&(n=i+" "+n)}while(!t&&(e=e.parentNode));var a=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return a&&new a(n)}function T(e,t,n){if(e){var i=e.getElementsByTagName(t),a=0,r=i.length;if(n)for(;a<r;a++)n(i[a],a);return i}return[]}function L(){var e=document.scrollingElement;return e||document.documentElement}function k(e,t,n,i,a){if(e.getBoundingClientRect||e===window){var r,o,s,l,d,u,p;if(e!==window&&e!==L()?(o=(r=e.getBoundingClientRect()).top,s=r.left,l=r.bottom,d=r.right,u=r.height,p=r.width):(o=0,s=0,l=window.innerHeight,d=window.innerWidth,u=window.innerHeight,p=window.innerWidth),(t||n)&&e!==window&&(a=a||e.parentNode,!c))do{if(a&&a.getBoundingClientRect&&("none"!==C(a,"transform")||n&&"static"!==C(a,"position"))){var f=a.getBoundingClientRect();o-=f.top+parseInt(C(a,"border-top-width")),s-=f.left+parseInt(C(a,"border-left-width")),l=o+r.height,d=s+r.width;break}}while(a=a.parentNode);if(i&&e!==window){var m=O(a||e),h=m&&m.a,v=m&&m.d;m&&(l=(o/=v)+(u/=v),d=(s/=h)+(p/=h))}return{top:o,left:s,bottom:l,right:d,width:p,height:u}}}function x(e,t,n){for(var i=R(e,!0),a=k(e)[t];i;){var r=k(i)[n];if(!("top"===n||"left"===n?a>=r:a<=r))return i;if(i===L())break;i=R(i,!1)}return!1}function D(e,t,n){for(var i=0,a=0,r=e.children;a<r.length;){if("none"!==r[a].style.display&&r[a]!==We.ghost&&r[a]!==We.dragged&&_(r[a],n.draggable,e,!1)){if(i===t)return r[a];i++}a++}return null}function N(e,t){for(var n=e.lastElementChild;n&&(n===We.ghost||"none"===C(n,"display")||t&&!y(n,t));)n=n.previousElementSibling;return n||null}function A(e,t){var n=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===We.clone||t&&!y(e,t)||n++;return n}function P(e){var t=0,n=0,i=L();if(e)do{var a=O(e),r=a.a,o=a.d;t+=e.scrollLeft*r,n+=e.scrollTop*o}while(e!==i&&(e=e.parentNode));return[t,n]}function R(e,t){if(!e||!e.getBoundingClientRect)return L();var n=e,i=!1;do{if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var a=C(n);if(n.clientWidth<n.scrollWidth&&("auto"==a.overflowX||"scroll"==a.overflowX)||n.clientHeight<n.scrollHeight&&("auto"==a.overflowY||"scroll"==a.overflowY)){if(!n.getBoundingClientRect||n===document.body)return L();if(i||t)return n;i=!0}}}while(n=n.parentNode);return L()}function I(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function q(e,t){return function(){if(!w){var n=arguments,i=this;1===n.length?e.call(i,n[0]):e.apply(i,n),w=setTimeout(function(){w=void 0},t)}}}function W(e,t,n){e.scrollLeft+=t,e.scrollTop+=n}function j(e){var t=window.Polymer,n=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):n?n(e).clone(!0)[0]:e.cloneNode(!0)}var H="Sortable"+(new Date).getTime();function F(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach(function(e){if("none"!==C(e,"display")&&e!==We.ghost){t.push({target:e,rect:k(e)});var n=o({},t[t.length-1].rect);if(e.thisAnimationDuration){var i=O(e,!0);i&&(n.top-=i.f,n.left-=i.e)}e.fromRect=n}})},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var n in e)if(e.hasOwnProperty(n))for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e[n][i])return Number(n);return-1}(t,{target:e}),1)},animateAll:function(n){var i=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof n&&n());var a=!1,r=0;t.forEach(function(e){var t=0,n=e.target,o=n.fromRect,s=k(n),l=n.prevFromRect,c=n.prevToRect,d=e.rect,u=O(n,!0);u&&(s.top-=u.f,s.left-=u.e),n.toRect=s,n.thisAnimationDuration&&I(l,s)&&!I(o,s)&&(d.top-s.top)/(d.left-s.left)==(o.top-s.top)/(o.left-s.left)&&(t=function(e,t,n,i){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-n.top,2)+Math.pow(t.left-n.left,2))*i.animation}(d,l,c,i.options)),I(s,o)||(n.prevFromRect=o,n.prevToRect=s,t||(t=i.options.animation),i.animate(n,d,s,t)),t&&(a=!0,r=Math.max(r,t),clearTimeout(n.animationResetTimer),n.animationResetTimer=setTimeout(function(){n.animationTime=0,n.prevFromRect=null,n.fromRect=null,n.prevToRect=null,n.thisAnimationDuration=null},t),n.thisAnimationDuration=t)}),clearTimeout(e),a?e=setTimeout(function(){"function"==typeof n&&n()},r):"function"==typeof n&&n(),t=[]},animate:function(e,t,n,i){if(i){C(e,"transition",""),C(e,"transform","");var a=O(this.el),r=a&&a.a,o=a&&a.d,s=(t.left-n.left)/(r||1),l=(t.top-n.top)/(o||1);e.animatingX=!!s,e.animatingY=!!l,C(e,"transform","translate3d("+s+"px,"+l+"px,0)"),function(e){e.offsetWidth}(e),C(e,"transition","transform "+i+"ms"+(this.options.easing?" "+this.options.easing:"")),C(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout(function(){C(e,"transition",""),C(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1},i)}}}}var B=[],U={initializeByDefault:!0},Y={mount:function(e){for(var t in U)!U.hasOwnProperty(t)||t in e||(e[t]=U[t]);B.push(e)},pluginEvent:function(e,t,n){var i=this;this.eventCanceled=!1,n.cancel=function(){i.eventCanceled=!0};var a=e+"Global";B.forEach(function(i){t[i.pluginName]&&(t[i.pluginName][a]&&t[i.pluginName][a](o({sortable:t},n)),t.options[i.pluginName]&&t[i.pluginName][e]&&t[i.pluginName][e](o({sortable:t},n)))})},initializePlugins:function(e,t,n,i){for(var a in B.forEach(function(i){var a=i.pluginName;if(e.options[a]||i.initializeByDefault){var o=new i(e,t,e.options);o.sortable=e,o.options=e.options,e[a]=o,r(n,o.defaults)}}),e.options)if(e.options.hasOwnProperty(a)){var o=this.modifyOption(e,a,e.options[a]);void 0!==o&&(e.options[a]=o)}},getEventProperties:function(e,t){var n={};return B.forEach(function(i){"function"==typeof i.eventProperties&&r(n,i.eventProperties.call(t[i.pluginName],e))}),n},modifyOption:function(e,t,n){var i;return B.forEach(function(a){e[a.pluginName]&&a.optionListeners&&"function"==typeof a.optionListeners[t]&&(i=a.optionListeners[t].call(e[a.pluginName],n))}),i}};function X(e){var t=e.sortable,n=e.rootEl,i=e.name,a=e.targetEl,r=e.cloneEl,s=e.toEl,l=e.fromEl,u=e.oldIndex,p=e.newIndex,f=e.oldDraggableIndex,m=e.newDraggableIndex,h=e.originalEvent,v=e.putSortable,g=e.extraEventProperties;if(t=t||n&&n[H]){var y,b=t.options,_="on"+i.charAt(0).toUpperCase()+i.substr(1);!window.CustomEvent||c||d?(y=document.createEvent("Event")).initEvent(i,!0,!0):y=new CustomEvent(i,{bubbles:!0,cancelable:!0}),y.to=s||n,y.from=l||n,y.item=a||n,y.clone=r,y.oldIndex=u,y.newIndex=p,y.oldDraggableIndex=f,y.newDraggableIndex=m,y.originalEvent=h,y.pullMode=v?v.lastPutMode:void 0;var w=o({},g,Y.getEventProperties(i,t));for(var S in w)y[S]=w[S];n&&n.dispatchEvent(y),b[_]&&b[_].call(t,y)}}var G=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.evt,a=s(n,["evt"]);Y.pluginEvent.bind(We)(e,t,o({dragEl:z,parentEl:Z,ghostEl:J,rootEl:K,nextEl:Q,lastDownEl:$,cloneEl:ee,cloneHidden:te,dragStarted:me,putSortable:se,activeSortable:We.active,originalEvent:i,oldIndex:ne,oldDraggableIndex:ae,newIndex:ie,newDraggableIndex:re,hideGhostForTarget:Pe,unhideGhostForTarget:Re,cloneNowHidden:function(){te=!0},cloneNowShown:function(){te=!1},dispatchSortableEvent:function(e){V({sortable:t,name:e,originalEvent:i})}},a))};function V(e){X(o({putSortable:se,cloneEl:ee,targetEl:z,rootEl:K,oldIndex:ne,oldDraggableIndex:ae,newIndex:ie,newDraggableIndex:re},e))}var z,Z,J,K,Q,$,ee,te,ne,ie,ae,re,oe,se,le,ce,de,ue,pe,fe,me,he,ve,ge,ye,be=!1,_e=!1,we=[],Se=!1,Me=!1,Ee=[],Ce=!1,Oe=[],Te="undefined"!=typeof document,Le=f,ke=d||c?"cssFloat":"float",xe=Te&&!m&&!f&&"draggable"in document.createElement("div"),De=function(){if(Te){if(c)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),Ne=function(e,t){var n=C(e),i=parseInt(n.width)-parseInt(n.paddingLeft)-parseInt(n.paddingRight)-parseInt(n.borderLeftWidth)-parseInt(n.borderRightWidth),a=D(e,0,t),r=D(e,1,t),o=a&&C(a),s=r&&C(r),l=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+k(a).width,c=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+k(r).width;if("flex"===n.display)return"column"===n.flexDirection||"column-reverse"===n.flexDirection?"vertical":"horizontal";if("grid"===n.display)return n.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(a&&o.float&&"none"!==o.float){var d="left"===o.float?"left":"right";return!r||"both"!==s.clear&&s.clear!==d?"horizontal":"vertical"}return a&&("block"===o.display||"flex"===o.display||"table"===o.display||"grid"===o.display||l>=i&&"none"===n[ke]||r&&"none"===n[ke]&&l+c>i)?"vertical":"horizontal"},Ae=function(e){function t(e,n){return function(i,a,r,o){var s=i.options.group.name&&a.options.group.name&&i.options.group.name===a.options.group.name;if(null==e&&(n||s))return!0;if(null==e||!1===e)return!1;if(n&&"clone"===e)return e;if("function"==typeof e)return t(e(i,a,r,o),n)(i,a,r,o);var l=(n?i:a).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var n={},a=e.group;a&&"object"==i(a)||(a={name:a}),n.name=a.name,n.checkPull=t(a.pull,!0),n.checkPut=t(a.put),n.revertClone=a.revertClone,e.group=n},Pe=function(){!De&&J&&C(J,"display","none")},Re=function(){!De&&J&&C(J,"display","")};Te&&document.addEventListener("click",function(e){if(_e)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),_e=!1,!1},!0);var Ie=function(e){if(z){e=e.touches?e.touches[0]:e;var t=(a=e.clientX,r=e.clientY,we.some(function(e){if(!N(e)){var t=k(e),n=e[H].options.emptyInsertThreshold,i=a>=t.left-n&&a<=t.right+n,s=r>=t.top-n&&r<=t.bottom+n;return n&&i&&s?o=e:void 0}}),o);if(t){var n={};for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);n.target=n.rootEl=t,n.preventDefault=void 0,n.stopPropagation=void 0,t[H]._onDragOver(n)}}var a,r,o},qe=function(e){z&&z.parentNode[H]._isOutsideThisEl(e.target)};function We(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=r({},t),e[H]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Ne(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==We.supportPointer&&"PointerEvent"in window,emptyInsertThreshold:5};for(var i in Y.initializePlugins(this,e,n),n)!(i in t)&&(t[i]=n[i]);for(var a in Ae(t),this)"_"===a.charAt(0)&&"function"==typeof this[a]&&(this[a]=this[a].bind(this));this.nativeDraggable=!t.forceFallback&&xe,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?v(e,"pointerdown",this._onTapStart):(v(e,"mousedown",this._onTapStart),v(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(v(e,"dragover",this),v(e,"dragenter",this)),we.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),r(this,F())}function je(e,t,n,i,a,r,o,s){var l,u,p=e[H],f=p.options.onMove;return!window.CustomEvent||c||d?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=n,l.draggedRect=i,l.related=a||t,l.relatedRect=r||k(t),l.willInsertAfter=s,l.originalEvent=o,e.dispatchEvent(l),f&&(u=f.call(p,l,o)),u}function He(e){e.draggable=!1}function Fe(){Ce=!1}function Be(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,i=0;n--;)i+=t.charCodeAt(n);return i.toString(36)}function Ue(e){return setTimeout(e,0)}function Ye(e){return clearTimeout(e)}We.prototype={constructor:We,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(he=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,z):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,n=this.el,i=this.options,a=i.preventOnFilter,r=e.type,o=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,s=(o||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||s,c=i.filter;if(function(e){Oe.length=0;var t=e.getElementsByTagName("input"),n=t.length;for(;n--;){var i=t[n];i.checked&&Oe.push(i)}}(n),!z&&!(/mousedown|pointerdown/.test(r)&&0!==e.button||i.disabled||l.isContentEditable||(s=_(s,i.draggable,n,!1))&&s.animated||$===s)){if(ne=A(s),ae=A(s,i.draggable),"function"==typeof c){if(c.call(this,e,s,this))return V({sortable:t,rootEl:l,name:"filter",targetEl:s,toEl:n,fromEl:n}),G("filter",t,{evt:e}),void(a&&e.cancelable&&e.preventDefault())}else if(c&&(c=c.split(",").some(function(i){if(i=_(l,i.trim(),n,!1))return V({sortable:t,rootEl:i,name:"filter",targetEl:s,fromEl:n,toEl:n}),G("filter",t,{evt:e}),!0})))return void(a&&e.cancelable&&e.preventDefault());i.handle&&!_(l,i.handle,n,!1)||this._prepareDragStart(e,o,s)}}},_prepareDragStart:function(e,t,n){var i,a=this,r=a.el,o=a.options,s=r.ownerDocument;if(n&&!z&&n.parentNode===r){var l=k(n);if(K=r,Z=(z=n).parentNode,Q=z.nextSibling,$=n,oe=o.group,We.dragged=z,le={target:z,clientX:(t||e).clientX,clientY:(t||e).clientY},pe=le.clientX-l.left,fe=le.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,z.style["will-change"]="all",i=function(){G("delayEnded",a,{evt:e}),We.eventCanceled?a._onDrop():(a._disableDelayedDragEvents(),!u&&a.nativeDraggable&&(z.draggable=!0),a._triggerDragStart(e,t),V({sortable:a,name:"choose",originalEvent:e}),E(z,o.chosenClass,!0))},o.ignore.split(",").forEach(function(e){T(z,e.trim(),He)}),v(s,"dragover",Ie),v(s,"mousemove",Ie),v(s,"touchmove",Ie),v(s,"mouseup",a._onDrop),v(s,"touchend",a._onDrop),v(s,"touchcancel",a._onDrop),u&&this.nativeDraggable&&(this.options.touchStartThreshold=4,z.draggable=!0),G("delayStart",this,{evt:e}),!o.delay||o.delayOnTouchOnly&&!t||this.nativeDraggable&&(d||c))i();else{if(We.eventCanceled)return void this._onDrop();v(s,"mouseup",a._disableDelayedDrag),v(s,"touchend",a._disableDelayedDrag),v(s,"touchcancel",a._disableDelayedDrag),v(s,"mousemove",a._delayedDragTouchMoveHandler),v(s,"touchmove",a._delayedDragTouchMoveHandler),o.supportPointer&&v(s,"pointermove",a._delayedDragTouchMoveHandler),a._dragStartTimer=setTimeout(i,o.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){z&&He(z),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;g(e,"mouseup",this._disableDelayedDrag),g(e,"touchend",this._disableDelayedDrag),g(e,"touchcancel",this._disableDelayedDrag),g(e,"mousemove",this._delayedDragTouchMoveHandler),g(e,"touchmove",this._delayedDragTouchMoveHandler),g(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?v(document,"pointermove",this._onTouchMove):v(document,t?"touchmove":"mousemove",this._onTouchMove):(v(z,"dragend",this),v(K,"dragstart",this._onDragStart));try{document.selection?Ue(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(e,t){if(be=!1,K&&z){G("dragStarted",this,{evt:t}),this.nativeDraggable&&v(document,"dragover",qe);var n=this.options;!e&&E(z,n.dragClass,!1),E(z,n.ghostClass,!0),We.active=this,e&&this._appendGhost(),V({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(ce){this._lastX=ce.clientX,this._lastY=ce.clientY,Pe();for(var e=document.elementFromPoint(ce.clientX,ce.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(ce.clientX,ce.clientY))!==t;)t=e;if(z.parentNode[H]._isOutsideThisEl(e),t)do{if(t[H]){if(t[H]._onDragOver({clientX:ce.clientX,clientY:ce.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);Re()}},_onTouchMove:function(e){if(le){var t=this.options,n=t.fallbackTolerance,i=t.fallbackOffset,a=e.touches?e.touches[0]:e,r=J&&O(J,!0),o=J&&r&&r.a,s=J&&r&&r.d,l=Le&&ye&&P(ye),c=(a.clientX-le.clientX+i.x)/(o||1)+(l?l[0]-Ee[0]:0)/(o||1),d=(a.clientY-le.clientY+i.y)/(s||1)+(l?l[1]-Ee[1]:0)/(s||1);if(!We.active&&!be){if(n&&Math.max(Math.abs(a.clientX-this._lastX),Math.abs(a.clientY-this._lastY))<n)return;this._onDragStart(e,!0)}if(J){r?(r.e+=c-(de||0),r.f+=d-(ue||0)):r={a:1,b:0,c:0,d:1,e:c,f:d};var u="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");C(J,"webkitTransform",u),C(J,"mozTransform",u),C(J,"msTransform",u),C(J,"transform",u),de=c,ue=d,ce=a}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!J){var e=this.options.fallbackOnBody?document.body:K,t=k(z,!0,Le,!0,e),n=this.options;if(Le){for(ye=e;"static"===C(ye,"position")&&"none"===C(ye,"transform")&&ye!==document;)ye=ye.parentNode;ye!==document.body&&ye!==document.documentElement?(ye===document&&(ye=L()),t.top+=ye.scrollTop,t.left+=ye.scrollLeft):ye=L(),Ee=P(ye)}E(J=z.cloneNode(!0),n.ghostClass,!1),E(J,n.fallbackClass,!0),E(J,n.dragClass,!0),C(J,"transition",""),C(J,"transform",""),C(J,"box-sizing","border-box"),C(J,"margin",0),C(J,"top",t.top),C(J,"left",t.left),C(J,"width",t.width),C(J,"height",t.height),C(J,"opacity","0.8"),C(J,"position",Le?"absolute":"fixed"),C(J,"zIndex","100000"),C(J,"pointerEvents","none"),We.ghost=J,e.appendChild(J),C(J,"transform-origin",pe/parseInt(J.style.width)*100+"% "+fe/parseInt(J.style.height)*100+"%")}},_onDragStart:function(e,t){var n=this,i=e.dataTransfer,a=n.options;G("dragStart",this,{evt:e}),We.eventCanceled?this._onDrop():(G("setupClone",this),We.eventCanceled||((ee=j(z)).draggable=!1,ee.style["will-change"]="",this._hideClone(),E(ee,this.options.chosenClass,!1),We.clone=ee),n.cloneId=Ue(function(){G("clone",n),We.eventCanceled||(n.options.removeCloneOnHide||K.insertBefore(ee,z),n._hideClone(),V({sortable:n,name:"clone"}))}),!t&&E(z,a.dragClass,!0),t?(_e=!0,n._loopId=setInterval(n._emulateDragOver,50)):(g(document,"mouseup",n._onDrop),g(document,"touchend",n._onDrop),g(document,"touchcancel",n._onDrop),i&&(i.effectAllowed="move",a.setData&&a.setData.call(n,i,z)),v(document,"drop",n),C(z,"transform","translateZ(0)")),be=!0,n._dragStartId=Ue(n._dragStarted.bind(n,t,e)),v(document,"selectstart",n),me=!0,p&&C(document.body,"user-select","none"))},_onDragOver:function(e){var t,n,i,a,r=this.el,s=e.target,l=this.options,c=l.group,d=We.active,u=oe===c,p=l.sort,f=se||d,m=this,h=!1;if(!Ce){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),s=_(s,l.draggable,r,!0),I("dragOver"),We.eventCanceled)return h;if(z.contains(e.target)||s.animated&&s.animatingX&&s.animatingY||m._ignoreWhileAnimating===s)return j(!1);if(_e=!1,d&&!l.disabled&&(u?p||(i=!K.contains(z)):se===this||(this.lastPutMode=oe.checkPull(this,d,z,e))&&c.checkPut(this,d,z,e))){if(a="vertical"===this._getDirection(e,s),t=k(z),I("dragOverValid"),We.eventCanceled)return h;if(i)return Z=K,q(),this._hideClone(),I("revert"),We.eventCanceled||(Q?K.insertBefore(z,Q):K.appendChild(z)),j(!0);var v=N(r,l.draggable);if(!v||function(e,t,n){var i=k(N(n.el,n.options.draggable));return t?e.clientX>i.right+10||e.clientX<=i.right&&e.clientY>i.bottom&&e.clientX>=i.left:e.clientX>i.right&&e.clientY>i.top||e.clientX<=i.right&&e.clientY>i.bottom+10}(e,a,this)&&!v.animated){if(v===z)return j(!1);if(v&&r===e.target&&(s=v),s&&(n=k(s)),!1!==je(K,r,z,t,s,n,e,!!s))return q(),r.appendChild(z),Z=r,F(),j(!0)}else if(s.parentNode===r){n=k(s);var g,y,b,w=z.parentNode!==r,S=!function(e,t,n){var i=n?e.left:e.top,a=n?e.right:e.bottom,r=n?e.width:e.height,o=n?t.left:t.top,s=n?t.right:t.bottom,l=n?t.width:t.height;return i===o||a===s||i+r/2===o+l/2}(z.animated&&z.toRect||t,s.animated&&s.toRect||n,a),M=a?"top":"left",O=x(s,"top","top")||x(z,"top","top"),T=O?O.scrollTop:void 0;if(he!==s&&(y=n[M],Se=!1,Me=!S&&l.invertSwap||w),0!==(g=function(e,t,n,i,a,r,o,s){var l=i?e.clientY:e.clientX,c=i?n.height:n.width,d=i?n.top:n.left,u=i?n.bottom:n.right,p=!1;if(!o)if(s&&ge<c*a){if(!Se&&(1===ve?l>d+c*r/2:l<u-c*r/2)&&(Se=!0),Se)p=!0;else if(1===ve?l<d+ge:l>u-ge)return-ve}else if(l>d+c*(1-a)/2&&l<u-c*(1-a)/2)return function(e){return A(z)<A(e)?1:-1}(t);if((p=p||o)&&(l<d+c*r/2||l>u-c*r/2))return l>d+c/2?1:-1;return 0}(e,s,n,a,S?1:l.swapThreshold,null==l.invertedSwapThreshold?l.swapThreshold:l.invertedSwapThreshold,Me,he===s))){var L=A(z);do{L-=g,b=Z.children[L]}while(b&&("none"===C(b,"display")||b===J))}if(0===g||b===s)return j(!1);he=s,ve=g;var D=s.nextElementSibling,P=!1,R=je(K,r,z,t,s,n,e,P=1===g);if(!1!==R)return 1!==R&&-1!==R||(P=1===R),Ce=!0,setTimeout(Fe,30),q(),P&&!D?r.appendChild(z):s.parentNode.insertBefore(z,P?D:s),O&&W(O,0,T-O.scrollTop),Z=z.parentNode,void 0===y||Me||(ge=Math.abs(y-k(s)[M])),F(),j(!0)}if(r.contains(z))return j(!1)}return!1}function I(l,c){G(l,m,o({evt:e,isOwner:u,axis:a?"vertical":"horizontal",revert:i,dragRect:t,targetRect:n,canSort:p,fromSortable:f,target:s,completed:j,onMove:function(n,i){return je(K,r,z,t,n,k(n),e,i)},changed:F},c))}function q(){I("dragOverAnimationCapture"),m.captureAnimationState(),m!==f&&f.captureAnimationState()}function j(t){return I("dragOverCompleted",{insertion:t}),t&&(u?d._hideClone():d._showClone(m),m!==f&&(E(z,se?se.options.ghostClass:d.options.ghostClass,!1),E(z,l.ghostClass,!0)),se!==m&&m!==We.active?se=m:m===We.active&&se&&(se=null),f===m&&(m._ignoreWhileAnimating=s),m.animateAll(function(){I("dragOverAnimationComplete"),m._ignoreWhileAnimating=null}),m!==f&&(f.animateAll(),f._ignoreWhileAnimating=null)),(s===z&&!z.animated||s===r&&!s.animated)&&(he=null),l.dragoverBubble||e.rootEl||s===document||(z.parentNode[H]._isOutsideThisEl(e.target),!t&&Ie(e)),!l.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),h=!0}function F(){ie=A(z),re=A(z,l.draggable),V({sortable:m,name:"change",toEl:r,newIndex:ie,newDraggableIndex:re,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){g(document,"mousemove",this._onTouchMove),g(document,"touchmove",this._onTouchMove),g(document,"pointermove",this._onTouchMove),g(document,"dragover",Ie),g(document,"mousemove",Ie),g(document,"touchmove",Ie)},_offUpEvents:function(){var e=this.el.ownerDocument;g(e,"mouseup",this._onDrop),g(e,"touchend",this._onDrop),g(e,"pointerup",this._onDrop),g(e,"touchcancel",this._onDrop),g(document,"selectstart",this)},_onDrop:function(e){var t=this.el,n=this.options;ie=A(z),re=A(z,n.draggable),G("drop",this,{evt:e}),Z=z&&z.parentNode,ie=A(z),re=A(z,n.draggable),We.eventCanceled?this._nulling():(be=!1,Me=!1,Se=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Ye(this.cloneId),Ye(this._dragStartId),this.nativeDraggable&&(g(document,"drop",this),g(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),p&&C(document.body,"user-select",""),C(z,"transform",""),e&&(me&&(e.cancelable&&e.preventDefault(),!n.dropBubble&&e.stopPropagation()),J&&J.parentNode&&J.parentNode.removeChild(J),(K===Z||se&&"clone"!==se.lastPutMode)&&ee&&ee.parentNode&&ee.parentNode.removeChild(ee),z&&(this.nativeDraggable&&g(z,"dragend",this),He(z),z.style["will-change"]="",me&&!be&&E(z,se?se.options.ghostClass:this.options.ghostClass,!1),E(z,this.options.chosenClass,!1),V({sortable:this,name:"unchoose",toEl:Z,newIndex:null,newDraggableIndex:null,originalEvent:e}),K!==Z?(ie>=0&&(V({rootEl:Z,name:"add",toEl:Z,fromEl:K,originalEvent:e}),V({sortable:this,name:"remove",toEl:Z,originalEvent:e}),V({rootEl:Z,name:"sort",toEl:Z,fromEl:K,originalEvent:e}),V({sortable:this,name:"sort",toEl:Z,originalEvent:e})),se&&se.save()):ie!==ne&&ie>=0&&(V({sortable:this,name:"update",toEl:Z,originalEvent:e}),V({sortable:this,name:"sort",toEl:Z,originalEvent:e})),We.active&&(null!=ie&&-1!==ie||(ie=ne,re=ae),V({sortable:this,name:"end",toEl:Z,originalEvent:e}),this.save()))),this._nulling())},_nulling:function(){G("nulling",this),K=z=Z=J=Q=ee=$=te=le=ce=me=ie=re=ne=ae=he=ve=se=oe=We.dragged=We.ghost=We.clone=We.active=null,Oe.forEach(function(e){e.checked=!0}),Oe.length=de=ue=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":z&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],n=this.el.children,i=0,a=n.length,r=this.options;i<a;i++)_(e=n[i],r.draggable,this.el,!1)&&t.push(e.getAttribute(r.dataIdAttr)||Be(e));return t},sort:function(e){var t={},n=this.el;this.toArray().forEach(function(e,i){var a=n.children[i];_(a,this.options.draggable,n,!1)&&(t[e]=a)},this),e.forEach(function(e){t[e]&&(n.removeChild(t[e]),n.appendChild(t[e]))})},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return _(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var n=this.options;if(void 0===t)return n[e];var i=Y.modifyOption(this,e,t);n[e]=void 0!==i?i:t,"group"===e&&Ae(n)},destroy:function(){G("destroy",this);var e=this.el;e[H]=null,g(e,"mousedown",this._onTapStart),g(e,"touchstart",this._onTapStart),g(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(g(e,"dragover",this),g(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),we.splice(we.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!te){if(G("hideClone",this),We.eventCanceled)return;C(ee,"display","none"),this.options.removeCloneOnHide&&ee.parentNode&&ee.parentNode.removeChild(ee),te=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(te){if(G("showClone",this),We.eventCanceled)return;K.contains(z)&&!this.options.group.revertClone?K.insertBefore(ee,z):Q?K.insertBefore(ee,Q):K.appendChild(ee),this.options.group.revertClone&&this.animate(z,ee),C(ee,"display",""),te=!1}}else this._hideClone()}},Te&&v(document,"touchmove",function(e){(We.active||be)&&e.cancelable&&e.preventDefault()}),We.utils={on:v,off:g,css:C,find:T,is:function(e,t){return!!_(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},throttle:q,closest:_,toggleClass:E,clone:j,index:A,nextTick:Ue,cancelNextTick:Ye,detectDirection:Ne,getChild:D},We.get=function(e){return e[H]},We.mount=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0].constructor===Array&&(t=t[0]),t.forEach(function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(We.utils=o({},We.utils,e.utils)),Y.mount(e)})},We.create=function(e,t){return new We(e,t)},We.version="1.10.2";var Xe,Ge,Ve,ze,Ze,Je,Ke=[],Qe=!1;function $e(){Ke.forEach(function(e){clearInterval(e.pid)}),Ke=[]}function et(){clearInterval(Je)}var tt=q(function(e,t,n,i){if(t.scroll){var a,r=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,s=t.scrollSensitivity,l=t.scrollSpeed,c=L(),d=!1;Ge!==n&&(Ge=n,$e(),Xe=t.scroll,a=t.scrollFn,!0===Xe&&(Xe=R(n,!0)));var u=0,p=Xe;do{var f=p,m=k(f),h=m.top,v=m.bottom,g=m.left,y=m.right,b=m.width,_=m.height,w=void 0,S=void 0,M=f.scrollWidth,E=f.scrollHeight,O=C(f),T=f.scrollLeft,x=f.scrollTop;f===c?(w=b<M&&("auto"===O.overflowX||"scroll"===O.overflowX||"visible"===O.overflowX),S=_<E&&("auto"===O.overflowY||"scroll"===O.overflowY||"visible"===O.overflowY)):(w=b<M&&("auto"===O.overflowX||"scroll"===O.overflowX),S=_<E&&("auto"===O.overflowY||"scroll"===O.overflowY));var D=w&&(Math.abs(y-r)<=s&&T+b<M)-(Math.abs(g-r)<=s&&!!T),N=S&&(Math.abs(v-o)<=s&&x+_<E)-(Math.abs(h-o)<=s&&!!x);if(!Ke[u])for(var A=0;A<=u;A++)Ke[A]||(Ke[A]={});Ke[u].vx==D&&Ke[u].vy==N&&Ke[u].el===f||(Ke[u].el=f,Ke[u].vx=D,Ke[u].vy=N,clearInterval(Ke[u].pid),0==D&&0==N||(d=!0,Ke[u].pid=setInterval(function(){i&&0===this.layer&&We.active._onTouchMove(Ze);var t=Ke[this.layer].vy?Ke[this.layer].vy*l:0,n=Ke[this.layer].vx?Ke[this.layer].vx*l:0;"function"==typeof a&&"continue"!==a.call(We.dragged.parentNode[H],n,t,e,Ze,Ke[this.layer].el)||W(Ke[this.layer].el,n,t)}.bind({layer:u}),24))),u++}while(t.bubbleScroll&&p!==c&&(p=R(p,!1)));Qe=d}},30),nt=function(e){var t=e.originalEvent,n=e.putSortable,i=e.dragEl,a=e.activeSortable,r=e.dispatchSortableEvent,o=e.hideGhostForTarget,s=e.unhideGhostForTarget;if(t){var l=n||a;o();var c=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,d=document.elementFromPoint(c.clientX,c.clientY);s(),l&&!l.el.contains(d)&&(r("spill"),this.onSpill({dragEl:i,putSortable:n}))}};function it(){}function at(){}it.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,n=e.putSortable;this.sortable.captureAnimationState(),n&&n.captureAnimationState();var i=D(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(t,i):this.sortable.el.appendChild(t),this.sortable.animateAll(),n&&n.animateAll()},drop:nt},r(it,{pluginName:"revertOnSpill"}),at.prototype={onSpill:function(e){var t=e.dragEl,n=e.putSortable||this.sortable;n.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),n.animateAll()},drop:nt},r(at,{pluginName:"removeOnSpill"});We.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?v(document,"dragover",this._handleAutoScroll):this.options.supportPointer?v(document,"pointermove",this._handleFallbackAutoScroll):t.touches?v(document,"touchmove",this._handleFallbackAutoScroll):v(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?g(document,"dragover",this._handleAutoScroll):(g(document,"pointermove",this._handleFallbackAutoScroll),g(document,"touchmove",this._handleFallbackAutoScroll),g(document,"mousemove",this._handleFallbackAutoScroll)),et(),$e(),clearTimeout(w),w=void 0},nulling:function(){Ze=Ge=Xe=Qe=Je=Ve=ze=null,Ke.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var n=this,i=(e.touches?e.touches[0]:e).clientX,a=(e.touches?e.touches[0]:e).clientY,r=document.elementFromPoint(i,a);if(Ze=e,t||d||c||p){tt(e,this.options,r,t);var o=R(r,!0);!Qe||Je&&i===Ve&&a===ze||(Je&&et(),Je=setInterval(function(){var r=R(document.elementFromPoint(i,a),!0);r!==o&&(o=r,$e()),tt(e,n.options,r,t)},10),Ve=i,ze=a)}else{if(!this.options.bubbleScroll||R(r,!0)===L())return void $e();tt(e,this.options,R(r,!1),!1)}}},r(e,{pluginName:"scroll",initializeByDefault:!0})}),We.mount(at,it);var rt=We;function ot(e){return(ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function st(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function lt(e,t){return!t||"object"!==ot(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ct(e,t,n){return(ct="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=dt(e)););return e}(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function dt(e){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ut(e,t){return(ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var pt=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),lt(this,dt(t).apply(this,arguments))}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ut(e,t)}(t,M.impl.Control),n=t,(i=[{key:"addTo",value:function(e,n){this.facadeMap_=e,this.facadeControl_=void 0,ct(dt(t.prototype),"addTo",this).call(this,e,n)}},{key:"registerEvents",value:function(){var e=this;if(!M.utils.isNullOrEmpty(this.facadeMap_)){var t=this.facadeMap_.getMapImpl();this.registerViewEvents_(t.getView()),this.registerLayersEvents_(t.getLayers()),t.on("change:view",function(){return e.onViewChange_.bind(e)})}}},{key:"unregisterEvents",value:function(){var e=this;if(!M.utils.isNullOrEmpty(this.facadeMap_)){var t=this.facadeMap_.getMapImpl();this.unregisterViewEvents_(t.getView()),this.unregisterLayersEvents_(t.getLayers()),t.un("change:view",function(){return e.onViewChange_.bind(e)})}}},{key:"registerViewEvents_",value:function(e){var t=this;e.on("change:resolution",function(){return t.facadeControl_.render()})}},{key:"registerLayersEvents_",value:function(e){var t=this;e.forEach(this.registerLayerEvents_.bind(this)),e.on("remove",function(){return t.facadeControl_.render()}),e.on("add",function(){return t.onAddLayer_.bind(t)})}},{key:"registerLayerEvents_",value:function(e){var t=this;e.on("change:visible",function(){return t.facadeControl_.render()}),e.on("change:extent",function(){return t.facadeControl_.render()})}},{key:"unregisterViewEvents_",value:function(e){var t=this;e.un("change:resolution",function(){return t.facadeControl_.render()})}},{key:"unregisterLayersEvents_",value:function(e){var t=this;e.forEach(this.unregisterLayerEvents_.bind(this)),e.un("remove",function(){return t.facadeControl_.render()}),e.un("add",function(){return t.onAddLayer_.bind(t)})}},{key:"unregisterLayerEvents_",value:function(e){var t=this;e.un("change:visible",function(){return t.facadeControl_.render()}),e.un("change:extent",function(){return t.facadeControl_.render()})}},{key:"onViewChange_",value:function(e){this.unregisterViewEvents_(e.oldValue);var t=this.facadeMap_.getMapImpl();this.registerViewEvents_(t.getView())}},{key:"onAddLayer_",value:function(e){this.registerLayerEvents_(e.element),this.facadeControl_.render()}},{key:"getGeoJSONExtent",value:function(e){return e.getImpl().getOL3Layer().getSource().getExtent()}}])&&st(n.prototype,i),a&&st(n,a),t}(),ft=n(0),mt=n.n(ft),ht=n(1),vt=n.n(ht),gt=n(2),yt=n.n(gt),bt=n(3),_t=n.n(bt),wt=n(4),St=n.n(wt),Mt={en:n(5),es:n(6)},Et=function(){var e="es";return"function"==typeof M.language.getLang&&(e=M.language.getLang()),e},Ct=function(e){return Mt[e]},Ot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Et(),n=Ct(t),i="";return M.utils.isNullOrEmpty(n)?console.warn("The translation '".concat(t,"' has not been defined.")):i=e.split(".").reduce(function(e,t){return e[t]},n),i};function Tt(e){return(Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function kt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function xt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Dt(e,t,n){return(Dt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Nt(e)););return e}(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function Nt(e){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function At(e,t){return(At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pt=function(e){function t(e,n,i,a){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(pt)&&M.exception(Ot("exception.impl"));var o,s,l=new pt;return o=this,r=!(s=Nt(t).call(this,l,"FullTOC"))||"object"!==Tt(s)&&"function"!=typeof s?xt(o):s,l.facadeControl=xt(r),r.map_=void 0,r.template_=void 0,r.http=e,r.https=n,r.precharged=i,r.codsi=a,r.stateSelectAll=!1,r.filterName=void 0,r}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(t,M.Control),n=t,(i=[{key:"createView",value:function(e){var t=this;return this.map_=e,new Promise(function(n,i){t.getTemplateVariables(e).then(function(e){var i=M.template.compileSync(mt.a,{vars:e});t.template_=i,n(i),t.template_.addEventListener("click",t.clickLayer.bind(t),!1),t.template_.addEventListener("input",t.inputLayer.bind(t),!1),t.getImpl().registerEvents(),t.render(),t.afterRender()})})}},{key:"afterRender",value:function(){var e=this;setTimeout(function(){e.template_.querySelector(".m-fulltoc-container .m-title .span-title").click()},700)}},{key:"inputLayer",value:function(e){var t=e||window.event;if(!M.utils.isNullOrEmpty(t.target)){var n=t.target.getAttribute("data-layer-name");if(!M.utils.isNullOrEmpty(n)){t.stopPropagation();var i=this.map_.getLayers().filter(function(e){return e.name===n})[0];if(t.target.classList.contains("m-check")){if(!0===i.transparent||!i.isVisible()){var a=t.target.parentElement.parentElement.parentElement.parentElement.querySelector("div.tools > input");M.utils.isNullOrEmpty(a)||i.setOpacity(a.value),i.setVisible(!i.isVisible())}}else t.target.classList.contains("m-fulltoc-transparency")&&i.setOpacity(t.target.value)}}}},{key:"clickLayer",value:function(e){var t,n=this,i=e||window.event,a=!1;if(!M.utils.isNullOrEmpty(i.target)){null!==document.querySelector(".m-panel.m-plugin-fulltoc.opened ul.m-layers")&&(t=document.querySelector(".m-panel.m-plugin-fulltoc.opened ul.m-layers").scrollTop);var r=i.target.getAttribute("data-layer-name"),o=i.target.getAttribute("data-layer-url");if(M.utils.isNullOrEmpty(r)||null===o){if(i.target.classList.contains("m-fulltoc-addservice")){var s=this.precharged,l=void 0!==s.groups&&s.groups.length>0||void 0!==s.services&&s.services.length>0,c=this.codsi,d=M.template.compileSync(_t.a,{jsonp:!0,parseToHtml:!1,vars:{precharged:s,hasPrecharged:l,codsiActive:c,translations:{url_service:Ot("url_service"),query:Ot("query"),loaded_services:Ot("loaded_services"),clean:Ot("clean"),availables:Ot("availables"),codsi_services:Ot("codsi_services"),filter_results:Ot("filter_results"),clean_filter:Ot("clean_filter"),filter_text:Ot("filter_text")}}});M.dialog.info(d,Ot("load_ext_services")),setTimeout(function(){null!==document.querySelector("#m-fulltoc-addservices-list-btn")&&document.querySelector("#m-fulltoc-addservices-list-btn").addEventListener("click",function(e){return n.showSuggestions(e)}),null!==document.querySelector("#m-fulltoc-addservices-codsi-btn")&&(document.querySelector("#m-fulltoc-addservices-codsi-btn").addEventListener("click",function(e){return n.showCODSI(e)}),document.querySelector("#m-fulltoc-addservices-codsi-filter-btn").addEventListener("click",function(e){n.loadCODSIResults(1)}),document.querySelector("#m-fulltoc-addservices-codsi-search-input").addEventListener("keypress",function(e){13===e.keyCode&&n.loadCODSIResults(1)}),document.querySelector("#m-fulltoc-addservices-codsi-clean-btn").addEventListener("click",function(e){document.querySelector("#m-fulltoc-addservices-codsi-search-input").value="",n.loadCODSIResults(1)})),document.querySelector("#m-fulltoc-addservices-search-btn").addEventListener("click",function(e){n.filterName=void 0,n.readCapabilities(e)}),document.querySelector("#m-fulltoc-addservices-search-input").addEventListener("keypress",function(e){13===e.keyCode&&(n.filterName=void 0,n.readCapabilities(e))}),document.querySelector("div.m-mapea-container div.m-dialog div.m-title").style.backgroundColor="#71a7d3";var e=document.querySelector("div.m-dialog.info div.m-button > button");e.innerHTML=Ot("close"),e.style.width="75px",e.style.backgroundColor="#71a7d3",e.addEventListener("click",function(){n.afterRender()}),document.querySelector("div.m-dialog #m-fulltoc-addservices-search-input").addEventListener("keyup",function(e){var t=document.querySelector("div.m-dialog #m-fulltoc-addservices-search-input").value.trim();document.querySelector("div.m-dialog #m-fulltoc-addservices-search-input").value=t}),document.querySelectorAll(".m-fulltoc-suggestion-caret").forEach(function(e){e.addEventListener("click",function(){e.parentElement.querySelector(".m-fulltoc-suggestion-group").classList.toggle("active"),e.classList.toggle("m-fulltoc-suggestion-caret-close")})}),document.querySelectorAll("#m-fulltoc-addservices-suggestions .m-fulltoc-suggestion").forEach(function(e){e.addEventListener("click",function(e){return n.loadSuggestion(e)})})},10)}}else{i.stopPropagation();var u=this.map_.getLayers().filter(function(e){return e.name===r&&e.url===o})[0];if(i.target.classList.contains("m-check")){if(!0===u.transparent||!u.isVisible()){var p=i.target.parentElement.parentElement.parentElement.querySelector("div.tools > input");M.utils.isNullOrEmpty(p)||u.setOpacity(p.value),u.setVisible(!u.isVisible())}}else if(i.target.classList.contains("m-fulltoc-transparency"))u.setOpacity(i.target.value);else if(i.target.classList.contains("m-fulltoc-remove"))this.map_.removeLayers(u);else if(i.target.classList.contains("m-fulltoc-zoom"))if("WMS"===u.type||"WMTS"===u.type||"WFS"===u.type){var f=u.getMaxExtent();this.map_.setBbox(f)}else if("KML"===u.type){var m=u.getImpl().getExtent();this.map_.setBbox(m)}else if("GeoJSON"===u.type){var h=this.getImpl().getGeoJSONExtent(u);this.map_.setBbox(h)}else M.dialog.info(Ot("exception.extent"),Ot("info"));else if(i.target.classList.contains("m-fulltoc-legend")){var v=i.target.parentElement.parentElement.parentElement.querySelector(".m-legend");"block"===v.style.display?v.style.display="none":v.style.display="block",a=!0}else if(i.target.classList.contains("m-fulltoc-config")){var g=M.template.compileSync(vt.a,{jsonp:!0,parseToHtml:!1,vars:{styles:u.capabilitiesMetadata.style,translations:{select_style:Ot("select_style"),change:Ot("change")}}});M.dialog.info(g,Ot("configure_layer")),setTimeout(function(){document.querySelector("div.m-mapea-container div.m-dialog #m-fulltoc-change-config button").addEventListener("click",n.changeLayerConfig.bind(n,u)),document.querySelector("div.m-mapea-container div.m-dialog div.m-title").style.backgroundColor="#71a7d3";var e=document.querySelector("div.m-dialog.info div.m-button > button");e.innerHTML=Ot("close"),e.style.width="75px",e.style.backgroundColor="#71a7d3"},10)}else if(i.target.classList.contains("m-fulltoc-info")){var y={name:u.name,title:u.legend,abstract:u.capabilitiesMetadata.abstract,translations:{title:Ot("title"),name:Ot("name"),abstract:Ot("abstract"),provider:Ot("provider"),query_metadata:Ot("query_metadata"),download_center:Ot("download_center"),see_more:Ot("see_more"),metadata_abstract:Ot("metadata_abstract"),responsible:Ot("responsible"),access_constraints:Ot("access_constraints"),use_constraints:Ot("use_constraints"),online_resources:Ot("online_resources")}};if("WMS"===u.type){var b=u.capabilitiesMetadata.metadataURL;y.metadata=M.utils.isNullOrEmpty(b)?"":b[0].OnlineResource,M.utils.isNullOrEmpty(u.capabilitiesMetadata.attribution)||(y.provider="".concat(u.capabilitiesMetadata.attribution.Title),void 0!==u.capabilitiesMetadata.attribution.OnlineResource&&(y.provider+='<p><a class="m-fulltoc-provider-link" href="'.concat(u.capabilitiesMetadata.attribution.OnlineResource,'" target="_blank">').concat(u.capabilitiesMetadata.attribution.OnlineResource,"</a></p>")))}else if("WMTS"===u.type&&!M.utils.isNullOrEmpty(u.capabilitiesMetadata.attribution)){y.provider="".concat(u.capabilitiesMetadata.attribution.ProviderName)+'<p><a class="m-fulltoc-provider-link" href="'.concat(u.capabilitiesMetadata.attribution.ProviderSite,'" target="_blank">').concat(u.capabilitiesMetadata.attribution.ProviderSite,"</a></p>");var _=u.capabilitiesMetadata.attribution.ServiceContact;if(!M.utils.isNullOrEmpty(_)&&!M.utils.isNullOrEmpty(_.ContactInfo)){var w=_.ContactInfo.Address.ElectronicMailAddress;y.provider+='<p><a class="m-fulltoc-provider-link" href="mailto:'.concat(w,'">').concat(w,"</a></p>")}}!M.utils.isNullOrEmpty(y.metadata)&&M.utils.isUrl(y.metadata)?M.remote.get(y.metadata).then(function(e){var t=e.text,i=t.split("<gmd:MD_DigitalTransferOptions>")[1].split("<gmd:URL>").filter(function(e){return e.indexOf("centrodedescargas")>-1&&-1===e.indexOf("atom")});if(i.length>0){var a=i[0].split("</gmd:URL>")[0].trim();y.downloadCenter=a}var r,o,s,l,c,d,u=t.split("<gmd:MD_DigitalTransferOptions>")[1].split("<gmd:onLine>"),p=t.split("<gmd:MD_DataIdentification>")[1],f=t.split("<gmd:MD_LegalConstraints>")[1];try{r=p.split("<gmd:CI_Citation>")[1].split("</gmd:CI_Citation>")[0].split("CharacterString>")[1].split("</gco")[0].trim()}catch(e){r=""}try{o=p.split("<gmd:abstract>")[1].split("</gmd:abstract>")[0].split("CharacterString>")[1].split("</gco")[0].trim()}catch(e){o=""}try{var m=p.split("<gmd:pointOfContact>")[1];if(s=m.split("<gmd:organisationName>")[1].split("</gmd:organisationName>")[0].split("CharacterString>")[1].split("</gco")[0].trim(),m.indexOf("<gmd:CI_OnlineResource>")>-1){var h=m.split("<gmd:CI_OnlineResource>")[1].split("<gmd:URL>")[1].split("</gmd:URL>")[0].trim();s='<a href="'.concat(h,'" target="_blank">').concat(s,"</a>")}}catch(e){s=""}try{l=f.split("<gmd:accessConstraints>")[1].split("<gmd:MD_RestrictionCode")[1].split(">")[1].split("<")[0].trim()}catch(e){l=""}try{c=f.split("<gmd:useConstraints>")[1].split("<gmd:MD_RestrictionCode")[1].split(">")[1].split("<")[0].trim()}catch(e){c=""}try{u.length>0&&(d=[],u.forEach(function(e){if(e.indexOf("<gmd:name>")>-1&&e.indexOf("<gmd:URL>")){var t={name:e.split("<gmd:name>")[1].split("</gmd:name>")[0].split("CharacterString>")[1].split("</gco")[0].trim(),url:e.split("<gmd:URL>")[1].split("</gmd:URL>")[0].trim()};d.push(t)}}))}catch(e){d=""}M.utils.isNullOrEmpty(r)||(y.metadataService=r,y.extended=!0),M.utils.isNullOrEmpty(o)||(y.metadataAbstract=o,y.extended=!0),M.utils.isNullOrEmpty(s)||(y.responsible=s,y.extended=!0),M.utils.isNullOrEmpty(l)||(y.accessConstraint=l,y.extended=!0),M.utils.isNullOrEmpty(c)||(y.useConstraint=c,y.extended=!0),M.utils.isNullOrEmpty(d)||(y.onlineResources=d,y.extended=!0),n.renderInfo(y)}).catch(function(e){n.renderInfo(y)}):this.renderInfo(y)}}}a||this.render(t)}},{key:"renderInfo",value:function(e){var t=M.template.compileSync(yt.a,{jsonp:!0,parseToHtml:!1,vars:e});M.dialog.info(t,Ot("info")),setTimeout(function(){document.querySelector("div.m-mapea-container div.m-dialog div.m-title").style.backgroundColor="#71a7d3";var e=document.querySelector("div.m-dialog.info div.m-button > button");e.innerHTML=Ot("close"),e.style.width="75px",e.style.backgroundColor="#71a7d3";var t=document.querySelector("#m-fulltoc-information .show-more-metadata");null!==t&&t.addEventListener("click",function(){var e=document.querySelector("#m-fulltoc-information .more-metadata");"block"!==e.style.display?(e.style.display="block",t.innerHTML='<span class="icon-colapsar"></span>&nbsp;'.concat(Ot("see_less"))):(e.style.display="none",t.innerHTML='<span class="icon-desplegar"></span>&nbsp;'.concat(Ot("see_more")))})},10)}},{key:"showSuggestions",value:function(){null!==document.querySelector("#m-fulltoc-addservices-codsi")&&(document.querySelector("#m-fulltoc-addservices-codsi").style.display="none"),document.querySelector("#m-fulltoc-addservices-results").innerHTML="",document.querySelector("#m-fulltoc-addservices-suggestions").style.display="block"}},{key:"showCODSI",value:function(){document.querySelector("#m-fulltoc-addservices-results").innerHTML="",document.querySelector("#m-fulltoc-addservices-codsi").style.display="block",document.querySelector("#m-fulltoc-addservices-suggestions").style.display="none",this.loadCODSIResults(1)}},{key:"loadCODSIResults",value:function(e){var t=this;document.querySelector("#m-fulltoc-addservices-codsi-results").innerHTML='<p class="m-fulltoc-loading"><span class="icon-spinner" /></p>';var n=document.querySelector("#m-fulltoc-addservices-codsi-search-input").value.trim(),i=1+9*(e-1),a=9*e,r="http://www.idee.es/csw-codsi-idee/srv/spa/q?_content_type=json&bucket=s101&facet.q=type%2Fservice&fast=index&from=*1&serviceType=view&resultType=details&sortBy=title&sortOrder=asc&to=*2".split("*1").join("".concat(i)).split("*2").join("".concat(a));""!==n&&(r+="&any=*".concat(encodeURIComponent(n),"*")),M.remote.get(r).then(function(n){var i=JSON.parse(n.text),a=i.summary["@count"],r=[];void 0!==i.metadata&&i.metadata.forEach(function(e){var t=[];if(Array.isArray(e.link))e.link.forEach(function(e){var n=[];e.indexOf("||")>-1?n=e.split("||").filter(function(e){return e.indexOf("http://")>-1||e.indexOf("https://")>-1}):e.indexOf("|")>-1&&(n=e.split("|").filter(function(e){return e.indexOf("http://")>-1||e.indexOf("https://")>-1})),t=t.concat(n)});else{var n=[];e.link.indexOf("||")>-1?n=e.link.split("||").filter(function(e){return e.indexOf("http://")>-1||e.indexOf("https://")>-1}):e.link.indexOf("|")>-1&&(n=e.link.split("|").filter(function(e){return e.indexOf("http://")>-1||e.indexOf("https://")>-1})),t=t.concat(n)}t.length>0&&r.push({title:e.title||e.defaultTitle,url:t[0].split("?")[0]})}),t.renderCODSIResults(r),t.renderCODSIPagination(e,a)}).catch(function(e){M.dialog.error(Ot("exception.codsi"))})}},{key:"renderCODSIResults",value:function(e){var t=this;if(document.querySelector("#m-fulltoc-addservices-codsi-results").innerHTML="",e.length>0){var n="<table><tbody>";e.forEach(function(e){n+='<tr><td><span class="m-fulltoc-codsi-result" data-link="'.concat(e.url,'">').concat(e.title,"</span></td></tr>")}),n+="</tbody></table>",document.querySelector("#m-fulltoc-addservices-codsi-results").innerHTML=n,document.querySelectorAll("#m-fulltoc-addservices-codsi-results .m-fulltoc-codsi-result").forEach(function(e){e.addEventListener("click",function(n){var i=e.getAttribute("data-link");document.querySelector("div.m-dialog #m-fulltoc-addservices-search-input").value=i,t.filterName=void 0,t.readCapabilities(n)})})}else document.querySelector("#m-fulltoc-addservices-codsi-results").innerHTML='<div class="codsi-no-results">'.concat(Ot("exception.codsi_no_results"),"</div>")}},{key:"renderCODSIPagination",value:function(e,t){var n=this;if(document.querySelector("#m-fulltoc-addservices-codsi-pagination").innerHTML="",t>0){for(var i=Math.ceil(t/9),a="",r=1;r<=i;r+=1)a+=r===e?'<button class="m-fulltoc-addservices-pagination-btn" disabled>'.concat(r,"</button>"):'<button class="m-fulltoc-addservices-pagination-btn">'.concat(r,"</button>");document.querySelector("#m-fulltoc-addservices-codsi-pagination").innerHTML=a,document.querySelectorAll("#m-fulltoc-addservices-codsi-pagination button").forEach(function(e,t){e.addEventListener("click",function(){n.loadCODSIResults(t+1)})})}}},{key:"loadSuggestion",value:function(e){var t=e.target.getAttribute("data-link");try{var n=e.target.parentElement.parentElement.parentElement,i=n.querySelector("span.m-fulltoc-suggestion-caret").innerText;this.filterName=i,"tbody"===n.localName&&(this.filterName="none")}catch(e){}var a=e.target.getAttribute("data-service-type");document.querySelector("div.m-dialog #m-fulltoc-addservices-search-input").value=t,"WMTS"===a?(document.getElementById("m-fulltoc-addservices-wmts").checked=!0,document.getElementById("m-fulltoc-addservices-wms").checked=!1):(document.getElementById("m-fulltoc-addservices-wms").checked=!0,document.getElementById("m-fulltoc-addservices-wmts").checked=!1),this.readCapabilities(e)}},{key:"changeLayerConfig",value:function(e){var t=document.querySelector(".m-panel.m-plugin-fulltoc.opened ul.m-layers").scrollTop,n=document.querySelector("#m-fulltoc-change-config #m-fulltoc-style-select").value;if(""!==n){e.getImpl().getOL3Layer().getSource().updateParams({STYLES:n}),document.querySelector("div.m-mapea-container div.m-dialog").remove();var i=e.capabilitiesMetadata;if(!M.utils.isNullOrEmpty(i)&&!M.utils.isNullOrEmpty(i.style)){var a=e.capabilitiesMetadata.style.filter(function(e){return e.Name===n});if(a.length>0&&a[0].LegendURL.length>0){var r=a[0].LegendURL[0].OnlineResource;e.setLegendURL(r),this.render(t)}}}}},{key:"getTemplateVariables",value:function(e){var t=this;return new Promise(function(n,i){if(!M.utils.isNullOrEmpty(e)){var a=e.getRootLayers().filter(function(e){var t=!0===e.transparent,n=!0===e.displayInLayerSwitcher,i=["wms","wmts"].indexOf(e.type.toLowerCase())>-1,a=!(e.type===M.layer.type.WMS&&M.utils.isNullOrEmpty(e.name));return t&&n&&i&&a}).reverse();Promise.all(a.map(t.parseLayerForTemplate_)).then(function(e){return n({layers:a,overlayLayers:e,translations:{layers:Ot("layers"),add_service:Ot("add_service"),show_hide:Ot("show_hide"),zoom:Ot("zoom"),info_metadata:Ot("info_metadata"),change_style:Ot("change_style"),remove_layer:Ot("remove_layer"),drag_drop:Ot("drag_drop")}})})}})}},{key:"render",value:function(e){var t=this;this.getTemplateVariables(this.map_).then(function(n){var i=M.template.compileSync(mt.a,{vars:n});t.registerImgErrorEvents_(i),t.template_.innerHTML=i.innerHTML;var a=t.template_.querySelector(".m-fulltoc-container .m-layers"),r=n.layers;null!==a&&(rt.create(a,{animation:150,ghostClass:"m-fulltoc-gray-shadow",filter:".m-opacity-container",preventOnFilter:!1,onEnd:function(e){var t=e.from,n=Math.max.apply(Math,Lt(r.map(function(e){return e.getZIndex()})));t.querySelectorAll("li.m-layer div.m-visible-control span").forEach(function(e){var t=e.getAttribute("data-layer-name"),i=e.getAttribute("data-layer-url"),a=r.filter(function(e){return e.name===t&&e.url===i});a.length>0&&(a[0].setZIndex(n),n-=1)})}}),void 0!==e&&(document.querySelector(".m-panel.m-plugin-fulltoc.opened ul.m-layers").scrollTop=e))})}},{key:"registerImgErrorEvents_",value:function(e){var t=this,n=e.querySelectorAll("img");Array.prototype.forEach.call(n,function(e){e.addEventListener("error",function(e){var n=e.target.getAttribute("data-layer-name"),i=e.target.getAttribute("data-layer-url"),a=M.utils.concatUrlPaths([M.config.THEME_URL,M.layer.WMS.LEGEND_ERROR]),r=t.map_.getLayers().filter(function(e){return e.name===n&&e.url===i})[0];M.utils.isNullOrEmpty(r)||r.setLegendURL(a)})})}},{key:"activate",value:function(){Dt(Nt(t.prototype),"activate",this).call(this)}},{key:"deactivate",value:function(){Dt(Nt(t.prototype),"deactivate",this).call(this)}},{key:"getActivationButton",value:function(e){return e.querySelector(".m-fulltoc button")}},{key:"equals",value:function(e){return e instanceof t}},{key:"parseLayerForTemplate_",value:function(e){var t=e.legend||e.name,n=!M.utils.isNullOrEmpty(e.capabilitiesMetadata)&&!M.utils.isNullOrEmpty(e.capabilitiesMetadata.abstract);return new Promise(function(i,a){var r={visible:!0===e.isVisible(),id:e.name,title:t,outOfRange:!e.inRange(),opacity:e.getOpacity(),metadata:n,type:e.type,hasStyles:n&&e.capabilitiesMetadata.style.length>1,url:e.url},o=e.getLegendURL();o instanceof Promise?o.then(function(e){r.legend=e,i(r)}):(r.legend="KML"!==e.type?o:null,i(r))})}},{key:"readCapabilities",value:function(e){var t=this;null!==document.querySelector("#m-fulltoc-addservices-codsi")&&(document.querySelector("#m-fulltoc-addservices-codsi").style.display="none"),e.preventDefault();var n=!1,i=!1;document.querySelector("#m-fulltoc-addservices-suggestions").style.display="none";var a=document.querySelector("div.m-dialog #m-fulltoc-addservices-search-input").value.trim().split("?")[0],r=document.getElementById("m-fulltoc-addservices-wmts").checked||a.indexOf("wmts")>-1?"WMTS":"WMS";if(M.utils.isNullOrEmpty(a))M.dialog.error(Ot("exception.empty"));else if(M.utils.isUrl(a)){if(this.http&&!this.https){n=/^(http:)/.test(a)}else if(this.https&&!this.http){i=/^(https:)/.test(a)}else this.http&&this.https&&(n=!0,i=!0);var o;if(!0===n||!0===i)if("WMTS"===r)new Promise(function(e,t){var n=setTimeout(function(){return t()},15e3);M.remote.get(M.utils.getWMTSGetCapabilitiesUrl(a)).then(function(t){clearTimeout(n),e(t)})}).then(function(e){try{var n=(new M.impl.format.WMTSCapabilities).read(e.xml);t.serviceCapabilities=n.capabilities||{};var i=M.impl.util.wmtscapabilities.getLayers(n.capabilities,a,t.map_.getProjection().code);t.capabilities=t.filterResults(i),t.showResults()}catch(e){M.dialog.error(Ot("exception.capabilities"))}}).catch(function(e){M.dialog.error(Ot("exception.capabilities"))});else new Promise(function(e,t){var n=setTimeout(function(){return t()},15e3);M.remote.get(M.utils.getWMSGetCapabilitiesUrl(a,"1.3.0")).then(function(t){clearTimeout(n),e(t)})}).then(function(e){try{var n=(new M.impl.format.WMSCapabilities).read(e.xml);t.serviceCapabilities=n.Service||{};var i=new M.impl.GetCapabilities(n,a,t.map_.getProjection().code);t.capabilities=t.filterResults(i.getLayers()),t.capabilities.forEach(function(e){try{t.getParents(n,e)}catch(e){}}),t.showResults()}catch(e){M.dialog.error(Ot("exception.capabilities"))}}).catch(function(e){new Promise(function(e,t){var n=setTimeout(function(){return t()},15e3);M.remote.get(M.utils.getWMTSGetCapabilitiesUrl(a)).then(function(t){clearTimeout(n),e(t)})}).then(function(e){try{var n=(new M.impl.format.WMTSCapabilities).read(e.xml);t.serviceCapabilities=n.capabilities||{};var i=M.impl.util.wmtscapabilities.getLayers(n.capabilities,a,t.map_.getProjection().code);t.capabilities=t.filterResults(i),t.showResults()}catch(e){M.dialog.error(Ot("exception.capabilities"))}}).catch(function(e){M.dialog.error(Ot("exception.capabilities"))})});else this.http?o=Ot("exception.only_http"):this.https?o=Ot("exception.only_https"):this.http||this.https||(o=Ot("exception.no_http_https")),M.dialog.error(o)}else M.dialog.error(Ot("exception.valid_url"))}},{key:"filterResults",value:function(e){var t=this,n=[],i=[],a=[];return void 0===this.filterName?(void 0!==this.precharged.services&&this.precharged.services.length>0&&(a=a.concat(this.precharged.services)),void 0!==this.precharged.groups&&this.precharged.groups.length>0&&this.precharged.groups.forEach(function(e){void 0!==e.services&&e.services.length>0&&(a=a.concat(e.services))}),e.forEach(function(e){n.push(e),i.push(e.name)})):"none"===this.filterName?(void 0!==this.precharged.services&&this.precharged.services.length>0&&(a=a.concat(this.precharged.services)),void 0!==this.precharged.groups&&this.precharged.groups.length>0&&this.precharged.groups.forEach(function(e){void 0!==e.services&&e.services.length>0&&(a=a.concat(e.services))}),e.forEach(function(e){var t=!1;a.forEach(function(a){a.type===e.type&&a.url===e.url&&(void 0!==a.white_list&&a.white_list.length>0&&a.white_list.indexOf(e.name)>-1&&-1===i.indexOf(e.name)?(n.push(e),i.push(e.name)):void 0===a.white_list&&-1===i.indexOf(e.name)&&(n.push(e),i.push(e.name)),t=!0)}),t||(n.push(e),i.push(e.name))})):void 0!==this.precharged.groups&&this.precharged.groups.length>0&&this.precharged.groups.forEach(function(a){void 0!==a.services&&a.services.length>0&&a.name===t.filterName&&e.forEach(function(e){var t=!1;a.services.forEach(function(a){a.type===e.type&&a.url===e.url&&(void 0!==a.white_list&&a.white_list.length>0&&a.white_list.indexOf(e.name)>-1&&-1===i.indexOf(e.name)?(n.push(e),i.push(e.name)):void 0===a.white_list&&-1===i.indexOf(e.name)&&(n.push(e),i.push(e.name)),t=!0)}),t||(n.push(e),i.push(e.name))})}),n}},{key:"getParents",value:function(e,t){var n,i=t.name;e.Capability.Layer.Layer.forEach(function(e){if(e.Name!==i&&void 0!==e.Layer&&e.Layer.length>0)if(e.Layer.filter(function(e){return e.Name===i}).length>0)n=e.Title;else if(M.utils.isObject(e.Layer.Layer)&&e.Layer.Layer.Name===i)n="".concat(e.Title," - ").concat(e.Layer.Layer.Title);else if(M.utils.isArray(e.Layer)&&e.Layer.length>0){if(e.Layer.filter(function(e){return e.Name===i}).length>0)n="".concat(e.Title," - ").concat(e.Layer.Title);else{var t=e.Layer.filter(function(e){var t=!1;return void 0!==e.Layer&&e.Layer.length>0&&(t=e.Layer.filter(function(e){return e.Name===i}).length>0),t});t.length>0&&(n="".concat(e.Title," - ").concat(t[0].Title))}}}),void 0!==n&&(t.legend="".concat(n," - ").concat(t.legend))}},{key:"showResults",value:function(){var e=this,t=[],n="WMS";this.capabilities.forEach(function(e){var i=e.getImpl();i.abstract=e.capabilitiesMetadata.abstract.trim(),n=e.type,t.push(i)});var i=document.querySelector("#m-fulltoc-addservices-results");if(t.length>0){var a={};if("WMTS"===n){var r=this.serviceCapabilities.ServiceIdentification,o=this.serviceCapabilities.ServiceProvider;if(void 0!==r&&void 0!==r.Title&&(a.title=r.Title.trim()),void 0!==r&&void 0!==r.Abstract&&(a.abstract=r.Abstract.trim()),void 0!==r&&void 0!==r.AccessConstraints&&(a.accessConstraints=r.AccessConstraints.trim()),void 0!==o){var s="".concat(o.ProviderName,'<p><a class="m-fulltoc-provider-link" href="').concat(o.ProviderSite,'" target="_blank">').concat(o.ProviderSite,"</a></p>"),l=o.ServiceContact.ContactInfo;if(!M.utils.isNullOrEmpty(o.ServiceContact)&&!M.utils.isNullOrEmpty(l)){var c=l.Address.ElectronicMailAddress;s+='<p><a class="m-fulltoc-provider-link" href="mailto:'.concat(c,'">').concat(c,"</a></p>")}a.contact=s}}else{var d=this.serviceCapabilities.ContactInformation;void 0!==this.serviceCapabilities.Title&&(a.title=this.serviceCapabilities.Title.trim()),void 0!==this.serviceCapabilities.Abstract&&(a.abstract=this.serviceCapabilities.Abstract.trim()),void 0!==this.serviceCapabilities.AccessConstraints&&(a.accessConstraints=this.serviceCapabilities.AccessConstraints.trim()),void 0!==d&&void 0!==d.ContactPersonPrimary&&void 0!==d.ContactPersonPrimary.ContactOrganization&&(a.contact=d.ContactPersonPrimary.ContactOrganization.trim())}var u=M.template.compileSync(St.a,{vars:{result:t,serviceCapabilities:a,translations:{layers:Ot("layers"),add:Ot("add"),title:Ot("title"),abstract:Ot("abstract"),responsible:Ot("responsible"),access_constraints:Ot("access_constraints"),show_service_info:Ot("show_service_info")}}});i.innerHTML=u.innerHTML,M.utils.enableTouchScroll(i);for(var p=i.querySelectorAll("span.m-check-fulltoc-addservices"),f=0;f<p.length;f+=1)p[f].addEventListener("click",function(t){return e.registerCheck(t)});for(var m=i.querySelectorAll(".table-results .table-container table tbody tr td.table-layer-name"),h=0;h<m.length;h+=1)m[h].addEventListener("click",function(t){return e.registerCheckFromName(t)});i.querySelector("#m-fulltoc-addservices-selectall").addEventListener("click",function(t){return e.registerCheck(t)}),i.querySelector(".m-fulltoc-addservices-add").addEventListener("click",function(t){return e.addLayers(t)});var v=i.querySelector(".m-fulltoc-show-capabilities");v.addEventListener("click",function(){var e=i.querySelector(".m-fulltoc-capabilities-container");"block"!==e.style.display?(e.style.display="block",v.innerHTML='<span class="icon-colapsar"></span>&nbsp;'.concat(Ot("hide_service_info"))):(e.style.display="none",v.innerHTML='<span class="icon-desplegar"></span>&nbsp;'.concat(Ot("show_service_info")))})}else i.innerHTML='<p class="m-fulltoc-noresults">'.concat(Ot("exception.no_results"),"</p>")}},{key:"registerCheck",value:function(e){var t=e||window.event;if(!M.utils.isNullOrEmpty(t.target)&&t.target.classList.contains("m-check-fulltoc-addservices")){var n=document.querySelector("#m-fulltoc-addservices-results").querySelectorAll(".m-check-fulltoc-addservices.icon-check").length;n+=t.target.classList.contains("icon-check")?-1:1,t.stopPropagation(),t.target.classList.toggle("icon-check"),t.target.classList.toggle("icon-check-seleccionado"),n>0?(this.stateSelectAll=!1,document.querySelector("#m-fulltoc-addservices-selectall").classList.remove("icon-check-seleccionado"),document.querySelector("#m-fulltoc-addservices-selectall").classList.add("icon-check")):0===n&&(this.stateSelectAll=!0,document.querySelector("#m-fulltoc-addservices-selectall").classList.remove("icon-check"),document.querySelector("#m-fulltoc-addservices-selectall").classList.add("icon-check-seleccionado"))}else M.utils.isNullOrEmpty(t.target)||"m-fulltoc-addservices-selectall"!==t.target.id||(this.stateSelectAll?(t.target.classList.remove("icon-check-seleccionado"),t.target.classList.add("icon-check"),this.unSelect(),this.stateSelectAll=!1):(t.target.classList.remove("icon-check"),t.target.classList.add("icon-check-seleccionado"),this.select(),this.stateSelectAll=!0))}},{key:"registerCheckFromName",value:function(e){(e||window.event).target.parentElement.querySelector("span.m-check-fulltoc-addservices").click()}},{key:"unSelect",value:function(){for(var e=document.querySelectorAll("#m-fulltoc-addservices-results .icon-check-seleccionado"),t=0;t<e.length;t+=1)e[t].classList.remove("icon-check-seleccionado"),e[t].classList.add("icon-check")}},{key:"select",value:function(){for(var e=document.querySelectorAll("#m-fulltoc-addservices-results .icon-check"),t=0;t<e.length;t+=1)e[t].classList.remove("icon-check"),e[t].classList.add("icon-check-seleccionado")}},{key:"addLayers",value:function(e){e.preventDefault();var t=[],n=document.querySelectorAll("#m-fulltoc-addservices-results .icon-check-seleccionado");if(0===n.length)M.dialog.error(Ot("exception.select_layer"));else{for(var i=0;i<n.length;i+=1)for(var a=0;a<this.capabilities.length;a+=1){var r=this.capabilities[a].name;if(n[i].id===r||n[i].name===r){var o=parseInt(this.serviceCapabilities.MaxWidth,10),s=!Number.isNaN(o)&&o<4096,l=void 0!==this.serviceCapabilities.Title&&this.serviceCapabilities.Title.toLowerCase().indexOf("idecanarias")>-1;(this.capabilities[a].url.indexOf("//ovc.catastro.meh.es/Cartografia/WMS/ServidorWMS.aspx")>-1||l)&&(this.capabilities[a].version="1.1.1"),this.capabilities[a].tiled="WMTS"===this.capabilities[a].type||s||l,this.capabilities[a].options.origen=this.capabilities[a].type;var c=this.capabilities[a].getLegendURL(),d=this.capabilities[a].capabilitiesMetadata;if((c.indexOf("GetLegendGraphic")>-1||c.indexOf("assets/img/legend-default.png")>-1)&&void 0!==d&&d.style.length>0&&void 0!==d.style[0].LegendURL&&d.style[0].LegendURL.length>0){var u=d.style[0].LegendURL[0].OnlineResource;null!=u&&this.capabilities[a].setLegendURL(u)}t.push(this.capabilities[a])}}t.reverse(),this.map_.addLayers(t),t.forEach(function(e){e.setZIndex(e.getZIndex()+8)}),this.afterRender()}}},{key:"removeContains",value:function(e){e.preventDefault(),null!==document.querySelector("#m-fulltoc-addservices-codsi")&&(document.querySelector("#m-fulltoc-addservices-codsi").style.display="none"),document.querySelector("#m-fulltoc-addservices-results").innerHTML="",document.querySelector("#m-fulltoc-addservices-suggestions").style.display="none",document.querySelector("div.m-dialog #m-fulltoc-addservices-search-input").value=""}}])&&kt(n.prototype,i),a&&kt(n,a),t}(),Rt=n(7);function It(e){return(It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Wt(e,t){return!t||"object"!==It(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function jt(e){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ht(e,t){return(Ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ft={groups:[{name:"IGN",services:[{name:"Unidades administrativas",type:"WMS",url:"https://www.ign.es/wms-inspire/unidades-administrativas?",white_list:["AU.AdministrativeBoundary","AU.AdministrativeUnit"]},{name:"Nombres geográficos",type:"WMS",url:"https://www.ign.es/wms-inspire/ngbe?"},{name:"Redes geodésicas",type:"WMS",url:"https://www.ign.es/wms-inspire/redes-geodesicas?"},{name:"Cuadrículas cartográficas",type:"WMS",url:"https://www.ign.es/wms-inspire/cuadriculas?",white_list:["Grid-REGCAN95-lonlat-50k","Grid-ETRS89-lonlat-50k","Grid-ETRS89-lonlat-25k","Grid-REGCAN95-lonlat-25k","Grid-25k-extendida"]},{name:"Información sísmica y volcánica",type:"WMS",url:"https://www.ign.es/wms-inspire/geofisica?"},{name:"Fototeca",type:"WMS",url:"https://fototeca.cnig.es/wms/fototeca.dll?"},{name:"Camino de Santiago",type:"WMS",url:"https://www.ign.es/wms-inspire/camino-santiago?"}]},{name:"IGN. Cartografía histórica",services:[{name:"Planos de Madrid (1622 - 1960)",type:"WMS",url:"https://www.ign.es/wms/planos?"},{name:"Hojas kilométricas (Madrid - 1860)",type:"WMS",url:"https://www.ign.es/wms/hojas-kilometricas?"},{name:"Planimetrías",type:"WMS",url:"https://www.ign.es/wms/minutas-cartograficas?"},{name:"Primera edición de los Mapas Topográficos Nacionales",type:"WMS",url:"https://www.ign.es/wms/primera-edicion-mtn?"}]},{name:"Sistema Cartográfico Nacional",services:[{name:"PNOA. Ortofotos máxima actualidad",type:"WMS",url:"https://www.ign.es/wms-inspire/pnoa-ma?"},{name:"PNOA. Ortofotos históricas y PNOA anual",type:"WMS",url:"https://www.ign.es/wms/pnoa-historico?"},{name:"Ocupación del suelo",type:"WMS",url:"https://servicios.idee.es/wms-inspire/ocupacion-suelo?"},{name:"Ocupación del suelo. Histórico",type:"WMS",url:"https://servicios.idee.es/wms-inspire/ocupacion-suelo-historico?"},{name:"Información Geográfica de Referencia. Transportes",type:"WMS",url:"https://servicios.idee.es/wms-inspire/transportes?"},{name:"Información Geográfica de Referencia. Hidrografía",type:"WMS",url:"https://servicios.idee.es/wms-inspire/hidrografia?"},{name:"Direcciones y códigos postales",type:"WMS",url:"https://www.cartociudad.es/wms-inspire/direcciones-ccpp?"},{name:"Modelos digitales del terreno",type:"WMS",url:"https://servicios.idee.es/wms-inspire/mdt?"},{name:"Copernicus Land Monitoring Service",type:"WMS",url:"https://servicios.idee.es/wms/copernicus-landservice-spain?"}]},{name:"Capas de fondo",services:[{name:"Mapa",type:"WMTS",url:"https://www.ign.es/wmts/mapa-raster?"},{name:"Imagen",type:"WMTS",url:"https://www.ign.es/wmts/pnoa-ma?"},{name:"Callejero",type:"WMTS",url:"https://www.ign.es/wmts/ign-base?"},{name:"Relieve",type:"WMTS",url:"https://wmts-mapa-lidar.idee.es/lidar?"},{name:"Ocupación del suelo",type:"WMTS",url:"https://servicios.idee.es/wmts/ocupacion-suelo?"},{name:"Mapas Históricos",type:"WMTS",url:"https://www.ign.es/wmts/primera-edicion-mtn"}]}],services:[{name:"Catastro",type:"WMS",url:"http://ovc.catastro.meh.es/Cartografia/WMS/ServidorWMS.aspx?"}]},Bt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Wt(this,jt(t).call(this))).map_=null,e.controls_=[],e.position_=n.position||"TR",e.collapsed_=void 0===n.collapsed||n.collapsed,e.name_="fulltoc",e.metadata_=Rt.metadata,e.http=!0,void 0===n.http||!1!==n.http&&"false"!==n.http||(e.http=!1),e.https=!0,void 0===n.https||!1!==n.https&&"false"!==n.https||(e.https=!1),e.codsi=n.codsi||!1,e.precharged=n.precharged||Ft,e}var n,i,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ht(e,t)}(t,M.Plugin),n=t,(i=[{key:"addTo",value:function(e){var t=this;this.map_=e,this.control_=new Pt(this.http,this.https,this.precharged,this.codsi),this.panel_=new M.ui.Panel("panelFullTOC",{className:"m-plugin-fulltoc",collapsed:this.collapsed_,collapsible:!0,position:M.ui.position[this.position_],collapsedButtonClass:"icon-capas",tooltip:Ot("tooltip")}),this.controls_.push(this.control_),this.control_.on(M.evt.ADDED_TO_MAP,function(){t.fire(M.evt.ADDED_TO_MAP)}),this.map_.on(M.evt.COMPLETED,function(){null!==t.map_&&(null!==t.control_&&t.control_.render(),t.map_.on(M.evt.ADDED_LAYER,function(){null!==t.control_&&t.control_.render()}),t.map_.on(M.evt.REMOVED_LAYER,function(){null!==t.control_&&t.control_.render()}))}),this.panel_.addControls(this.controls_),this.map_.addPanels(this.panel_)}},{key:"getAPIRest",value:function(){return"".concat(this.name,"=").concat(this.position,"*").concat(this.collapsed)}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"destroy",value:function(){this.map_.removeControls([this.control_]);var e=[null,null,null];this.control_=e[0],this.controls_=e[1],this.panel_=e[2]}},{key:"position",get:function(){return this.position_}},{key:"name",get:function(){return this.name_}},{key:"collapsed",get:function(){return this.panel_.isCollapsed()}}])&&qt(n.prototype,i),a&&qt(n,a),t}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.plugin.FullTOC=Bt,window.M.control.FullTOCControl=Pt}]);
//# sourceMappingURL=fulltoc.ol.min.js.map