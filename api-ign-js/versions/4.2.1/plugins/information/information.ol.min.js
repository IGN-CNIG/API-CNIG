!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t){t.exports={url:{name:"information",separator:"*"},constructor:"M.plugin.Information",parameters:[{type:"object",properties:[{type:"simple",name:"position",position:0,possibleValues:["TL","TR","BR","BL"]},{type:"simple",name:"tooltip",position:1},{type:"simple",name:"format",position:2},{type:"Number",name:"featureCount",position:3},{type:"Number",name:"buffer",position:4},{type:"simple",name:"opened",position:5}]}],files:{ol:{scripts:["information.ol.min.js"],styles:["information.ol.min.css"]}},metadata:{name:"Information",description:"Shows getfeatureinfo onclick when active",text:"On click in a queryable layer shows getfeatureinfo",version:"1.0.0",date:"09/12/2019",author:"Guadaltel",org:"CNIG",tags:"mapea,plugin",icon:"./facade/assets/icons/icon.svg"}}},function(t,e){t.exports='<div class="m-information-content">\n   {{{info}}}\n</div>\n'},function(t,e){t.exports="  {{#each layers}}\n      <div class='m-information-content-info'>\n          <div class='m-information-content-info-header'>\n              <div class=\"m-arrow-right\"></div>\n              <div>\n                  <p> {{../info_of}} <strong>{{layerName}}</strong></p>\n              </div>\n          </div>\n          <div class='m-information-content-info-body m-content-collapsed'>\n              {{{formatedInfo}}}\n          </div>\n      </div>\n  {{/each}}\n"},function(t){t.exports={exception:{impl:"The implementation used cannot create InformationControl."},tooltip:"Consult layers",title:"Information",not_queryable:"There are no queryable layers",querying:"Getting information...",unsupported_format:"Unsupported format",no_info:"No associated info",info_of:"Information about"}},function(t){t.exports={exception:{impl:"La implementación usada no puede crear controles InformationControl."},tooltip:"Consultar capas",title:"Información",not_queryable:"No existen capas consultables",querying:"Obteniendo información...",unsupported_format:"Formato no soportado",no_info:"No existe información asociada",info_of:"Información de"}},function(t,e){t.exports='<div class="m-control m-container m-information-container">\n  <button id=\'m-information-btn\' class="m-information-btn g-cartografia-info" title="{{translations.tooltip}}"></button>\n</div>\n'},function(t,e,n){},function(t,e,n){"use strict";n.r(e);n(6);var o=n(0),r=n(1),i=n.n(r),a=n(2),l=n.n(a),c={en:n(3),es:n(4)},u=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e="es","function"==typeof M.language.getLang&&(e=M.language.getLang()),e),o=function(t){return c[t]}(n),r="";return M.utils.isNullOrEmpty(o)?console.warn("The translation '".concat(n,"' has not been defined.")):r=t.split(".").reduce(function(t,e){return t[e]},o),r};function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function p(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function m(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function d(t,e,n){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=y(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var b={gsResponse:/^results[\w\s\S]*'http:/i,msNewFeature:/feature(\s*)(\w+)(\s*):/i,gsNewFeature:/#newfeature#/,gsGeometry:/geom$/i,msGeometry:/boundedby$/i,msUnsupportedFormat:/error(.*)unsupported(.*)info_format/i},v=u("title"),g=function(t){function e(t,n,o,r){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=m(this,y(e).call(this,{}))).format_=t,"plain"===M.utils.normalize(i.format_)||"text/plain"===M.utils.normalize(i.format_)?i.format_="text/plain":"gml"===M.utils.normalize(i.format_)||"application/vnd.ogc.gml"===M.utils.normalize(i.format_)?i.format_="application/vnd.ogc.gml":i.format_="text/html",i.featureCount_=n,i.buffer_=o,i.opened_=r,i.facadeMap_=null,i}var n,o,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(e,M.impl.Control),n=e,r=[{key:"insert",value:function(t,e){var n=!1;switch(e){case"text/html":var o=document.createElement("div");o.innerHTML=t;var r="";Array.prototype.forEach.call(o.querySelectorAll("body"),function(t){r+=t.innerHTML.trim()}),Array.prototype.forEach.call(o.querySelectorAll("div"),function(t){r+=t.innerHTML.trim()}),Array.prototype.forEach.call(o.querySelectorAll("table"),function(t){r+=t.innerHTML.trim()}),Array.prototype.forEach.call(o.querySelectorAll("b"),function(t){r+=t.innerHTML.trim()}),Array.prototype.forEach.call(o.querySelectorAll("span"),function(t){r+=t.innerHTML.trim()}),Array.prototype.forEach.call(o.querySelectorAll("input"),function(t){r+=t.innerHTML.trim()}),Array.prototype.forEach.call(o.querySelectorAll("a"),function(t){r+=t.innerHTML.trim()}),Array.prototype.forEach.call(o.querySelectorAll("img"),function(t){r+=t.innerHTML.trim()}),Array.prototype.forEach.call(o.querySelectorAll("p"),function(t){r+=t.innerHTML.trim()}),Array.prototype.forEach.call(o.querySelectorAll("ul"),function(t){r+=t.innerHTML.trim()}),Array.prototype.forEach.call(o.querySelectorAll("li"),function(t){r+=t.innerHTML.trim()}),r.length>0&&!/WMS\s+server\s+error/i.test(t)&&(n=!0);break;case"application/vnd.ogc.gml":n=(new ol.format.WFS).readFeatures(t).length>0;break;case"text/plain":/returned\s+no\s+results/i.test(t)||/features\s+were\s+found/i.test(t)||/:$/i.test(t)||(n=!0)}return n}},{key:"unsupportedFormat",value:function(t,e){var n=!1;return"text/html"===e&&(n=b.msUnsupportedFormat.test(t)),n}}],(o=[{key:"addTo",value:function(t,n){d(y(e.prototype),"addTo",this).call(this,t,n),this.facadeMap_=t,t.getMapImpl().addControl(this)}},{key:"activate",value:function(){this.addOnClickEvent_()}},{key:"deactivate",value:function(){this.deleteOnClickEvent_()}},{key:"destroy",value:function(){this.deactivate(),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null}},{key:"deleteOnClickEvent_",value:function(){ol.Observable.unByKey(this.clickEventKey_),document.querySelector(".m-control.m-container.m-information-container").classList.remove("activated")}},{key:"addOnClickEvent_",value:function(){var t=this,e=this.facadeMap_.getMapImpl();this.clickEventKey_=e.on("singleclick",function(e){return t.buildUrl_(M.dialog,e)}),document.querySelector(".m-control.m-container.m-information-container").classList.add("activated")}},{key:"buildUrl_",value:function(t,e){this.evt=e;var n=this.facadeMap_.getMapImpl(),o=this.buildWMSInfoURL(this.facadeMap_.getWMS()),r=this.buildWMTSInfoURL(this.facadeMap_.getWMTS()),i=[].concat(f(r),f(o)).filter(function(t){return!M.utils.isNullOrEmpty(t)});i.length>0?this.showInfoFromURL_(i,e.coordinate,n):t.info(u("not_queryable"))}},{key:"buildWMSInfoURL",value:function(t){var e=this,n=this.facadeMap_.getMapImpl().getView().getResolution(),o=this.facadeMap_.getProjection().code;return t.map(function(t){var r,i=t.getImpl().getOL3Layer();if(t.isVisible()&&t.isQueryable()&&!M.utils.isNullOrEmpty(i)){r={};var a={INFO_FORMAT:e.format_,FEATURE_COUNT:e.featureCount_},l=i.getSource(),c=e.evt.coordinate;/buffer/i.test(t.url)||(a.BUFFER=e.buffer_);var u=l.getFeatureInfoUrl(c,n,o,a);r={layer:t.legend||t.name,url:u}}return r})}},{key:"buildWMTSInfoURL",value:function(t){var e=this;return t.map(function(t){var n;if(t.isVisible()&&t.isQueryable()&&!M.utils.isNullOrEmpty(t)){n={};var o=e.format_,r=e.evt.coordinate,i=t.getFeatureInfoUrl(r,e.facadeMap_.getZoom(),o).replace("row=-","row=");n={layer:t.legend||t.name,url:i}}return n})}},{key:"formatInfo",value:function(t,e,n){var o=null;switch(e){case"text/html":o=t;break;case"application/vnd.ogc.gml":var r=(new ol.format.WFS).readFeatures(t);o="",r.forEach(function(t){var e=t.getKeys();o+="<div class='divinfo'>",o+="<table class='mapea-table'><tbody><tr><td class='header' colspan='3'>' ".concat(M.utils.beautifyAttribute(n)," '</td></tr>'");for(var r=0,i=e.length;r<i;r+=1){var a=e[r],l=t.get(a);o+='<tr><td class="key"><b>',o+=M.utils.beautifyAttribute(a),o+='</b></td><td class="value">',o+=l,o+="</td></tr>"}o+="</tbody></table></div>"});break;case"text/plain":o=b.gsResponse.test(t)?this.txtToHtmlGeoserver(t,n):this.txtToHtmlMapserver(t,n)}return o}},{key:"txtToHtmlGeoserver",value:function(t,e){var n=t,o=(n=(n=n.replace(/[\w\s\S]*':/i,"")).replace(/---(-*)(n+)---(-*)/g,"#newfeature#")).split("\n"),r="<div class='divinfo'>";r+="<table class='mapea-table'><tbody><tr><td class='header' colspan='3'>".concat(M.utils.beautifyAttribute(e),"</td></tr>");for(var i=0,a=o.length;i<a;i+=1){var l=o[i].trim();if(-1!==l.indexOf("=")){var c=l.split("="),u=c[0].trim(),s="-";c.length>1&&(0!==(s=c[1].trim()).length&&"null"!==s||(s="-")),!1===b.gsGeometry.test(u)&&(r+='<tr><td class="key"><b>',r+=M.utils.beautifyAttribute(u),r+='</b></td><td class="value">',r+=s,r+="</td></tr>")}else b.gsNewFeature.test(l)&&(r+='<tr><td class="header" colspan="3">'.concat(M.utils.beautifyAttribute(e),"</td></tr>"))}return r+="</tbody></table></div>"}},{key:"txtToHtmlMapserver",value:function(t){for(var e=t,n=(e=e.replace(/[\w\s\S]*(layer)/i,"$1")).replace(/layer(\s*)'(\w+)'[\w\s\S]*/i,"$2"),o=(e=(e=(e=(e=e.replace(/layer(\s*)'(\w+)'([\w\s\S]*)/i,"$3")).replace(/feature(\s*)(\w*)(\s*)(:)([\w\s\S]*)/i,"$5")).replace(/'/g,"")).replace(/=/g,";")).split("\n"),r="",i="<table class='mapea-table'><tbody><tr><td class='header' colspan='3'>".concat(M.utils.beautifyAttribute(n),"</td></tr>"),a=0,l=o.length;a<l;a+=1){var c=o[a].trim(),u=o[a]?o[a].trim():"",s=c.split(";"),f=s[0].trim(),p="-";s.length>1&&0===(p=s[1].trim()).length&&(p="-"),f.length>0&&(b.msNewFeature.test(f)?u.length>0&&!b.msNewFeature.test(u)&&(r+="<tr><td class='header' colspan='3'>".concat(M.utils.beautifyAttribute(n),"</td><td></td></tr>")):(r+='<tr><td class="key"><b>',r+=M.utils.beautifyAttribute(f),r+='</b></td><td class="value">',r+=p,r+="</td></tr>"))}return r.length>0&&(r="".concat(i+r,"</tbody></table>")),r}},{key:"showInfoFromURL_",value:function(t,n,o){var r=this,a=M.template.compileSync(i.a,{vars:{info:u("querying")},parseToHtml:!1}),c=[],s=String(this.format_),f=0,p={icon:"g-cartografia-info",title:v,content:a},m=this.facadeMap_.getPopup();M.utils.isNullOrEmpty(m)?((m=new M.Popup).addTab(p),this.facadeMap_.addPopup(m,n)):m.getTabs().some(function(t){return t.title!==v})?m.addTab(p):(this.facadeMap_.removePopup(),(m=new M.Popup).addTab(p),this.facadeMap_.addPopup(m,n));t.forEach(function(n){var o=n.url.replace("row=-","row=").replace("col=-","col="),i=n.layer;M.proxy(!0),M.remote.get(o).then(function(n){if(m=r.facadeMap_.getPopup(),200===n.code&&!1===n.error){var o=n.text;if(!0===e.insert(o,s)){var a=r.formatInfo(o,s,i);c.push({formatedInfo:a,layerName:i})}else e.unsupportedFormat(o,s)&&c.push({formatedInfo:u("unsupported_format"),layerName:i})}if(f+=1,t.length===f&&!M.utils.isNullOrEmpty(m))if(m.removeTab(p),0===c.length)m.addTab({icon:"g-cartografia-info",title:v,content:u("no_info")});else{var d=M.template.compileSync(l.a,{vars:{layers:c,info_of:u("info_of")},parseToHtml:!1});m.addTab({icon:"g-cartografia-info",title:v,content:d,listeners:[{selector:".m-information-content-info div.m-arrow-right",all:!0,type:"click",callback:function(t){return r.toogleSection(t)}},{selector:".m-information-content-info div:nth-child(2) p",all:!0,type:"click",callback:function(t){return r.toogleSection(t)}}]}),"all"===r.opened_?setTimeout(function(){document.querySelectorAll("div.m-arrow-right").forEach(function(t){t.click()})},100):"one"===r.opened_&&1===t.length&&setTimeout(function(){document.querySelector("div.m-arrow-right").click()},100)}})}),this.popup_=m}},{key:"toogleSection",value:function(t){var e=t.target,n=e.parentElement.parentElement;n.classList.contains("m-information-content-info")||(e=(n=n.classList.contains("m-information-content-info-header")?n.parentElement:n.parentElement.parentElement).querySelector(".m-information-content-info-header div:nth-child(1)"));var o=n.querySelector(".m-information-content-info-body");if(o.classList.contains("m-content-collapsed")){o.classList.remove("m-content-collapsed"),e.classList.remove("m-arrow-right"),e.classList.add("m-arrow-down");var r=this.popup_.getCoordinate();this.popup_.getImpl().panIntoView(r)}else o.classList.add("m-content-collapsed"),e.classList.add("m-arrow-right"),e.classList.remove("m-arrow-down")}},{key:"getElement",value:function(){return this.element}}])&&p(n.prototype,o),r&&p(n,r),e}(),_=n(5),w=n.n(_);function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function S(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function O(t,e){return!e||"object"!==k(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function E(t){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function T(t,e){return(T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var A=function(t){function e(t,n,o,r,i){var a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),M.utils.isUndefined(g)&&M.exception("");var l=new g(t,n,o,i);return(a=O(this,E(e).call(this,l,"Information"))).tooltip=r,a}var n,o,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&T(t,e)}(e,M.Control),n=e,(o=[{key:"createView",value:function(t){var e=this;return new Promise(function(t,n){t(M.template.compileSync(w.a,{vars:{translations:{tooltip:e.tooltip||u("tooltip")}}}))})}},{key:"activate",value:function(){this.invokeEscKey(),this.getImpl().activate(),document.body.style.cursor="url('https://i.ibb.co/HBtH3Qs/click-info.png') 1 7, auto",document.addEventListener("keyup",this.checkEscKey.bind(this))}},{key:"deactivate",value:function(){this.getImpl().deactivate(),document.body.style.cursor="default",document.removeEventListener("keyup",this.checkEscKey.bind(this))}},{key:"checkEscKey",value:function(t){var e=document.querySelector(".m-control.m-container.m-information-container").classList.contains("activated");"Escape"===t.key&&e&&(document.removeEventListener("keyup",this.checkEscKey.bind(this)),document.querySelector("#m-information-btn").click())}},{key:"invokeEscKey",value:function(){try{document.dispatchEvent(new window.KeyboardEvent("keyup",{key:"Escape",keyCode:27,code:"",which:69,shiftKey:!1,ctrlKey:!1,metaKey:!1}))}catch(t){console.error(t)}}},{key:"getActivationButton",value:function(t){return t.querySelector("#m-information-btn")}},{key:"equals",value:function(t){return t instanceof e}}])&&S(n.prototype,o),r&&S(n,r),e}();function I(t){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function j(t,e){return!e||"object"!==I(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function x(t){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function P(t,e){return(P=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var C=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=j(this,x(e).call(this))).map_=null,n.controls_=[],n.position_=t.position||"TR",n.tooltip_=t.tooltip||u("tooltip"),n.format_=t.format||"text/html",n.featureCount_=t.featureCount||10,n.buffer_=t.buffer||10,n.opened_=t.opened||"closed",n.name_="information",n.metadata_=o.metadata,n}var n,r,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&P(t,e)}(e,M.Plugin),n=e,(r=[{key:"addTo",value:function(t){var e=this.featureCount_;this.ctrl=new A(this.format_,e,this.buffer_,this.tooltip_,this.opened_),this.controls_.push(this.ctrl),this.map_=t,this.panel_=new M.ui.Panel("panelInformation",{className:"m-plugin-information",position:M.ui.position[this.position_],tooltip:this.tooltip_,collapsedButtonClass:"g-cartografia-info"}),this.panel_.addControls(this.controls_),t.addPanels(this.panel_)}},{key:"getAPIRest",value:function(){var t="".concat(this.name_,"=").concat(this.position_,"*").concat(this.tooltip_,"*").concat(this.format_,"*").concat(this.featureCount_);return void 0===this.buffer_||null===this.buffer_||""===this.buffer_?t+="*":t+="*".concat(this.buffer_),void 0===this.opened_||null===this.opened_||""===this.opened_?t+="*":t+="*".concat(this.opened_),t}},{key:"equals",value:function(t){return t instanceof e}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"destroy",value:function(){this.ctrl.deactivate(),this.map_.removeControls(this.controls_);var t=[null,null,null];this.map_=t[0],this.controls_=t[1],this.panel_=t[2]}},{key:"name",get:function(){return"information"}},{key:"position",get:function(){return this.position_}}])&&L(n.prototype,r),i&&L(n,i),e}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.Information=C,window.M.control.InformationControl=A,window.M.impl.control.InformationControl=g}]);
//# sourceMappingURL=information.ol.min.js.map