!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=6)}([function(e,t){e.exports='<div id="div-contenedor" class="m-control m-container m-ignsearch" title="">\n    <div class="search-panel">\n        <input type="text" id="m-ignsearch-search-input" class="m-input-search" title="{{translations.tooltip_input}}" placeholder="{{translations.direccion}}" />\n        <button id="m-ignsearch-locate-button" title="{{translations.obtener}}">\n            <span class="icon-locate" />\n        </button>\n        <button id="m-ignsearch-clear-button" class="m-button-limpiar" title="{{translations.deleteresults}}">\n            <span class="icon-remove" />\n        </button>\n    </div>\n    <div id="m-ignsearch-results">\n        \x3c!-- Here goes the list of search results --\x3e\n    </div>\n</div>\n'},function(e,t){e.exports='<ul id="m-ignsearch-results-list">\n    {{#each places}}\n        {{#if this.address}}\n            {{#printType this.type this.address this.id this.municipality this.cps}}\n            {{/printType}}\n        {{else}}\n            {{#printType this.type this.title this.id this.municipality this.cps}}\n            {{/printType}}\n        {{/if}}\n    {{/each}}\n</ul>\n'},function(e){e.exports={exception:{exists:"There is no associated address for this location.",results:"No results found"},searchresult:"searchresult",tooltip:"Search places",tooltip_input:"Place name, address or postal code",deleteresults:"Delete search results",obtener:"Get direction at a point on the map",direccion:"Place name, address or postal code",aprox:"Approximate address",exact:"Exact address"}},function(e){e.exports={exception:{exists:"No existe dirección asociada para esta ubicación.",results:"No se han encontrado resultados"},searchresult:"searchresult",tooltip:"Búsqueda de lugares",tooltip_input:"Topónimo, dirección o código postal",deleteresults:"Borrar resultados de la búsqueda",obtener:"Obtener dirección en un punto del mapa",direccion:"Topónimo, dirección o código postal",aprox:"Dirección aproximada",exact:"Dirección exacta"}},function(e,t,o){},function(e,t,o){},function(e,t,o){"use strict";o.r(t);o(4),o(5);function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e,t,o){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=a(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(o):r.value}})(e,t,o||e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l,u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,a(t).apply(this,arguments))}var o,n,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,M.impl.Control),o=t,(n=[{key:"addTo",value:function(e,o){s(a(t.prototype),"addTo",this).call(this,e,o)}},{key:"setScale",value:function(e){var t=[559082264.0287178,279541132.0143589,139770566.0071794,69885283.00358972,34942641.50179486,17471320.75089743,8735660.375448715,4367830.187724357,2183915.093862179,1091957.546931089,545978.7734655447,272989.3867327723,136494.6933663862,68247.34668319309,34123.67334159654,17061.83667079827,8530.918335399136,4265.459167699568,2132.729583849784],o=t.reduce(function(t,o){return Math.abs(o-e)<Math.abs(t-e)?o:t}),n=this.facadeMap_.getMapImpl().getView(),r=n.getMaxResolution()/Math.pow(2,t.indexOf(o));n.setResolution(r)}},{key:"reproject",value:function(e,t,o){return ol.proj.getTransform(t,o)(e)}}])&&r(o.prototype,n),l&&r(o,l),t}(),p=o(0),d=o.n(p),h=o(1),y=o.n(h),f=function(){Handlebars.registerHelper("toUpperCase",function(e){return e.toUpperCase()}),Handlebars.registerHelper("ifCond",function(e,t,o,n){switch(t){case"===":return e===o?n.fn(void 0):n.inverse(void 0);case"!==":return e!==o?n.fn(void 0):n.inverse(void 0);case"<":return e<o?n.fn(void 0):n.inverse(void 0);case"<=":return e<=o?n.fn(void 0):n.inverse(void 0);case">":return e>o?n.fn(void 0):n.inverse(void 0);case">=":return e>=o?n.fn(void 0):n.inverse(void 0);case"&&":return e&&o?n.fn(void 0):n.inverse(void 0);case"||":return e||o?n.fn(void 0):n.inverse(void 0);default:return n.inverse(void 0)}}),Handlebars.registerHelper("printType",function(e,t,o,n,r){var i="<li id=".concat(o,'><span id="info">').concat(t,"</span>");return"Municipio"!==e&&"provincia"!==e&&"comunidad autonoma"!==e&&!0!==r||(i+=" (".concat(e,")")),void 0!==n&&(i+=" en ".concat(n)),i})},m={en:o(2),es:o(3)},v=function(e){var t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t="es","function"==typeof M.language.getLang&&(t=M.language.getLang()),t),n=function(e){return m[e]}(o),r="";return M.utils.isNullOrEmpty(n)?console.warn("The translation '".concat(o,"' has not been defined.")):r=e.split(".").reduce(function(e,t){return e[t]},n),r};function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function S(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var x=function(e){function t(e,o,n,r,i,s,a,c,l,p,d,h,y,m,v,g,b,w,x){var k;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(u)&&M.exception("La implementación usada no puede crear controles IGNSearchControl");var L=new u;return(k=S(this,P(t).call(this,L,"IGNSearch"))).servicesToSearch=e,k.maxResults=o,k.noProcess=n,k.countryCode=r,k.urlCandidates=i,k.urlFind=s,k.urlReverse=a,k.urlPrefix=c,k.urlAssistant=l,k.urlDispatcher=p,k.resultVisibility_=d,k.nomenclatorSearchType=x,k.searchPosition=b,k.reverse=h,k.reverseActivated=!1,k.locationID=y,k.requestStreet=m,k.geocoderCoords=v,k.zoom=g,k.urlParse=null,k.pointStyle=w,f(),k}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,M.Control),o=t,(n=[{key:"createView",value:function(e){var t=this;return this.map=e,this.destroyMapLayers(),new Promise(function(o){var n=M.template.compileSync(d.a,{vars:{translations:{deleteresults:v("deleteresults"),obtener:v("obtener"),direccion:v("direccion"),tooltip_input:v("tooltip_input")}}});t.html=n,t.resultsBox=n.querySelector("#m-ignsearch-results"),t.searchInput=t.html.querySelector("#m-ignsearch-search-input"),n.querySelector("#m-ignsearch-clear-button").addEventListener("click",t.clearResultsAndGeometry.bind(t)),n.querySelector("#m-ignsearch-search-input").addEventListener("keyup",function(e){return t.createTimeout(e)}),n.querySelector("#m-ignsearch-search-input").addEventListener("keydown",function(){clearTimeout(l)}),n.querySelector("#m-ignsearch-search-input").addEventListener("keydown",function(){clearTimeout(l)}),n.querySelector("#m-ignsearch-locate-button").addEventListener("click",t.activateDeactivateReverse.bind(t)),document.querySelector(".ign-search-panel>.m-panel-btn").addEventListener("click",t.clearResults.bind(t)),t.clickReverseEvent=t.map.on(M.evt.CLICK,function(e){return t.showReversePopUp(e)}),t.changePlaceholder(),t.reverse||(n.querySelector("#m-ignsearch-locate-button").style.display="none"),t.on(M.evt.ADDED_TO_MAP,function(){if(t.locationID&&t.locationID.length>0&&(t.point=new M.style.Point({radius:5,icon:{form:"none",class:"g-cartografia-pin",radius:12,rotation:0,rotate:!1,offset:[0,-12],color:"#f00",opacity:1}}),t.simple=new M.style.Polygon({fill:{color:"black",opacity:0}}),t.drawNomenclatorResult(t.locationID,!1)),t.requestStreet&&t.requestStreet.length>0&&(M.proxy(!1),M.remote.get(t.requestStreet).then(function(e){var o=e.text.substring(9,e.text.length-1);t.map.removeLayers(t.clickedElementLayer);var n=JSON.parse(o);if(n.geometry.coordinates=t.fixCoordinatesPath(n),t.coordinates="".concat(n.properties.lat,", ").concat(n.properties.lng),t.clickedElementLayer=new M.layer.GeoJSON({name:v("searchresult"),source:{type:"FeatureCollection",features:[n]}}),t.clickedElementLayer.displayInLayerSwitcher=!1,t.createGeometryStyles(),"Point"===n.geometry.type&&t.clickedElementLayer.setStyle(t.point),t.clickedElementLayer.setZIndex(1e19),t.resultVisibility_||t.clickedElementLayer.setStyle(t.simple),t.map.addLayers(t.clickedElementLayer),"callejero"===n.properties.type||"portal"===n.properties.type){var r=t.createFullAddress(n.properties),i=[n.properties.lat,n.properties.lng],s=n.properties.state;t.showSearchPopUp(r,i,s,{fake:!0})}M.proxy(!0)}).catch(function(e){M.proxy(!0)})),t.geocoderCoords&&2===t.geocoderCoords.length){t.activateDeactivateReverse();var o=t.getImpl().reproject(t.geocoderCoords,"EPSG:4326",e.getProjection().code);t.showReversePopUp({coord:o,fake:!0})}}),o(n)})}},{key:"destroyMapLayers",value:function(){for(var e=0;e<this.map.getLayers().length;e+=1)this.map.getLayers()[e].name===v("searchresult")&&(this.map.removeLayers(this.map.getLayers()[e]),this.map.removePopup())}},{key:"activateDeactivateReverse",value:function(){this.reverseActivated?(this.reverseActivated=!1,document.querySelector("#m-ignsearch-locate-button span").style.color="#7A7A73"):(this.reverseActivated=!0,document.querySelector("#m-ignsearch-locate-button span").style.color="#71a7d3")}},{key:"showReversePopUp",value:function(e){var t=this;if(this.reverseActivated){var o=this.map.getProjection().code,n=this.getImpl().reproject([e.coord[0],e.coord[1]],o,"EPSG:4258"),r="lon=".concat(n[0],"&lat=").concat(n[1]),i="".concat(this.urlReverse,"?").concat(r),s=e.coord;this.geocoderCoords=n;var a=[n[1],n[0]],c="";M.proxy(!1),M.remote.get(i).then(function(o){if(null!==o.text){var n=JSON.parse(o.text);c=t.createFullAddress(n)}else c=v("exception.exists");t.showPopUp(c,s,a,null,!0,e)}),M.proxy(!0)}}},{key:"createTimeout",value:function(e){var t=this;clearTimeout(l),l=setTimeout(function(){return t.searchInputValue(e)},500)}},{key:"getActivationButton",value:function(e){return e.querySelector(".m-ignsearch button")}},{key:"equals",value:function(e){return e instanceof t}},{key:"searchInputValue",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.target.value.replace(","," ");if(this.searchValue=n,n.length<=2)this.resultsBox.innerHTML="";else{this.resultsBox.innerHTML="",this.resultsBox.classList.add("g-cartografia-spinner"),this.resultsBox.style.fontSize="24px",this.nomenclatorCandidates=[],this.geocoderCandidates=[];/[+-]?\d+\.\d+(\s|,|(,\s))[+-]?\d+\.\d+/.test(n)?this.searchCoordinates(n):(this.nomenclatorFinished=!1,this.candidatesFinished=!1,this.getNomenclatorData(n,this.nomenclatorCandidates).then(function(){t.nomenclatorFinished=!0,t.showCandidatesResults(o)}),this.getCandidatesData(n,this.geocoderCandidates).then(function(){t.candidatesFinished=!0,t.showCandidatesResults(o)}))}}},{key:"showCandidatesResults",value:function(e){var t=this;this.allCandidates=[];for(var o=0;o<this.searchPosition.split(",").length;o+=1){if("nomenclator"===this.searchPosition.split(",")[o])for(var n=0;n<this.nomenclatorCandidates.length;n+=1)this.allCandidates.push(this.nomenclatorCandidates[n]);if("geocoder"===this.searchPosition.split(",")[o])for(var r=0;r<this.geocoderCandidates.length;r+=1)this.allCandidates.push(this.geocoderCandidates[r])}if(0===this.allCandidates.length&&this.nomenclatorFinished&&this.candidatesFinished){this.resultsBox.innerHTML="",this.resultsBox.classList.remove("g-cartografia-spinner"),this.resultsBox.style.fontSize="1em";var i=document.createElement("p"),s=document.createTextNode(v("exception.results"));i.classList.add("m-ignsearch-noresults"),i.appendChild(s),this.resultsBox.appendChild(i)}else if(this.allCandidates.length>0){this.resultsBox.innerHTML="",this.resultsBox.classList.remove("g-cartografia-spinner"),this.resultsBox.style.fontSize="1em";var a=M.template.compileSync(y.a,{vars:{places:this.allCandidates}}),c=a.querySelectorAll("li");c.forEach(function(e){e.addEventListener("click",function(){t.goToLocation(e)})}),!0===e&&c.length>0&&c.item(0).click(),this.resultsBox.appendChild(a)}}},{key:"drawGeocoderResultProv",value:function(e){var t=this;this.map.removeLayers(this.clickedElementLayer),M.proxy(!1),M.remote.get(this.urlParse).then(function(o){var n,r=o.text.substring(9,o.text.length-1),i=e;if(r.includes("MULTIPOLYGON (((")){if(i.includes('"type":"MultiPolygon"')){n=r.split("(((")[1].split("), ("),i.includes("]]]")&&(i=i.replace("]]]","]]]]"));for(var s=0;s<n.length;s+=1){var a=n[s].substring(0,9).replace("(","");e.includes("[[[".concat(a))?i=i.replace("[[[".concat(a),"[[[[".concat(a)):e.includes("]],[[".concat(a))?i=i.replace("]],[[".concat(a),"]]],[[[".concat(a)):e.includes("],[".concat(a))&&(i=i.replace("],[".concat(a),"]],[[".concat(a)))}}}else if(r.includes("POLYGON (("))if(i.includes('"type":"Polygon"')){n=r.split("((")[1].split("), ("),i.includes("]]")&&(i=i.replace("]]","]]]")),i=i.replace("Polygon","MultiPolygon");for(var c=0;c<n.length;c+=1){var l=n[c].split(" "),u=n[c].substring(0,l[0].length).replace("(","");e.includes("[[[".concat(u))?i=i.replace("[[[".concat(u),"[[[[".concat(u)):e.includes("],[".concat(u))&&(i=i.replace("],[".concat(u),"]],[[".concat(u)))}}else i.includes('"type":"MultiPolygon"')&&(i=(i=i.replace("]]],[[","]],[[")).replace('"type":"MultiPolygon"','"type":"Polygon"'));i.includes("MultiMultiPolygon")&&(i=i.replace("MultiMultiPolygon","MultiPolygon"));var p=JSON.parse(i);if(t.coordinates="".concat(p.properties.lat,", ").concat(p.properties.lng),t.clickedElementLayer=new M.layer.GeoJSON({name:v("searchresult"),source:{type:"FeatureCollection",features:[p]}}),t.clickedElementLayer.displayInLayerSwitcher=!1,"Point"===p.geometry.type&&t.clickedElementLayer.setStyle(t.point),p.geometry.type.indexOf("Polygon")>-1&&t.clickedElementLayer.setStyle(new M.style.Polygon({fill:{color:"#3399CC",opacity:0},stroke:{color:"#3399CC",width:2},radius:5})),t.clickedElementLayer.setZIndex(1e19),t.resultVisibility_||t.clickedElementLayer.setStyle(t.simple),t.map.addLayers(t.clickedElementLayer),t.zoomInLocation("g",p.geometry.type,t.zoom),"callejero"===p.properties.type||"portal"===p.properties.type){var d=t.createFullAddress(p.properties),h=[p.properties.lat,p.properties.lng],y=p.properties.state;t.showSearchPopUp(d,h,y)}}),M.proxy(!0)}},{key:"drawGeocoderResult",value:function(e){this.map.removeLayers(this.clickedElementLayer);var t=JSON.parse(e);if(t.geometry.coordinates=this.fixCoordinatesPath(t),this.coordinates="".concat(t.properties.lat,", ").concat(t.properties.lng),this.clickedElementLayer=new M.layer.GeoJSON({name:v("searchresult"),source:{type:"FeatureCollection",features:[t]}}),this.clickedElementLayer.displayInLayerSwitcher=!1,"Point"===t.geometry.type&&this.clickedElementLayer.setStyle(this.point),this.clickedElementLayer.setZIndex(1e19),this.resultVisibility_||this.clickedElementLayer.setStyle(this.simple),this.map.addLayers(this.clickedElementLayer),this.zoomInLocation("g",t.geometry.type,this.zoom),"callejero"===t.properties.type||"portal"===t.properties.type){var o=this.createFullAddress(t.properties),n=[t.properties.lat,t.properties.lng],r=t.properties.state;this.showSearchPopUp(o,n,r)}else void 0!==this.popup&&this.map.removePopup(this.popup)}},{key:"createFullAddress",value:function(e){var t=null===e.tip_via||void 0===e.tip_via?"":e.tip_via,o=null===e.address||void 0===e.address?"":e.address,n=null===e.portalNumber||void 0===e.portalNumber||0===e.portalNumber?"":e.portalNumber,r=null===e.muni||void 0===e.muni?"":e.muni;return"".concat(t," ").concat(o," ").concat(n,", ").concat(r.toUpperCase())}},{key:"drawNomenclatorResult",value:function(e){var t=this,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.requestStreet="",this.requestPlace=M.utils.addParameters(this.urlDispatcher,{request:"OpenQuerySource",query:'<ogc:Filter><ogc:FeatureId fid="'.concat(e,'"/></ogc:Filter>'),sourcename:"".concat(this.urlPrefix,"communicationsPoolServlet/sourceAccessWFS-INSPIRE-NGBE.rdf"),outputformat:"application/json"}),this.locationID=e,M.proxy(!0),M.remote.get(this.requestPlace).then(function(e){var n=JSON.parse(e.text).results[0].location,r=JSON.parse(e.text).results[0].title,i=n.split(" "),s=parseFloat(i[0]),a=parseFloat(i[1]);t.map.removeLayers(t.clickedElementLayer);var c={name:v("searchresult"),source:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[a,s]},properties:{name:r}}]}};t.clickedElementLayer=new M.layer.GeoJSON(c),t.clickedElementLayer.displayInLayerSwitcher=!1,t.clickedElementLayer.setStyle(t.point),t.clickedElementLayer.setZIndex(1e19),t.resultVisibility_||t.clickedElementLayer.setStyle(t.simple),t.map.addLayers(t.clickedElementLayer),!0===o&&t.zoomInLocation("n","Point",t.zoom)})}},{key:"getCandidatesData",value:function(e,t){var o=this,n=window.encodeURIComponent(e);return new Promise(function(e){if("n"!==o.servicesToSearch){var r="q=".concat(n,"&limit=").concat(o.maxResults+5,"&no_process=").concat(o.noProcess);r+="&countrycode=".concat(o.countryCode,"&autocancel=true");var i="".concat(o.urlCandidates,"?").concat(r);M.proxy(!1),M.remote.get(i).then(function(o){for(var n=JSON.parse(o.text.substring(9,o.text.length-1)),r=0;r<n.length;r+=1)t.push(n[r]);e()}),M.proxy(!0)}else e()})}},{key:"getNomenclatorData",value:function(e,t){var o=this,n=window.encodeURIComponent(e);return new Promise(function(e){if("g"!==o.servicesToSearch){var r="maxresults=".concat(o.maxResults-5,"&name_equals=").concat(n),i="".concat(o.urlAssistant,"?").concat(r);M.proxy(!0),M.remote.get(i).then(function(n){for(var r=(""!==n.text&&null!==n.text?JSON.parse(n.text):{results:[]}).results,i=0;i<r.length;i+=1)o.nomenclatorSearchType.indexOf(r[i].type)>=0&&t.push(r[i]);for(var s=0;s<t.length;s+=1)if("Núcleos de población"===t[s].type){var a=t.splice(s,1);t.splice(0,0,a)}t.forEach(function(e){e.cps=!0}),e()})}else e()})}},{key:"getFindData",value:function(e,t){var o=this;return new Promise(function(n){var r,i,s,a,c;if(t.forEach(function(t){e.getAttribute("id")===t.id&&(r="&id=".concat(t.id),i="&type=".concat(t.type),s=0!==t.portalNumber&&void 0!==t.portalNumber?"&portal=".concat(t.portalNumber):"",a=""!==t.tip_via?"&tip_via=".concat(t.tip_via):"")}),c=e.innerHTML,e.innerHTML.includes("(")){var l=e.innerHTML.indexOf("(");c=e.innerHTML.substring(0,l)}var u="".concat(i).concat(a).concat(r).concat(s,"&outputformat=geojson"),p="".concat(o.urlFind,"?q=").concat(c).concat(u);o.urlParse=p.replace("&outputformat=geojson",""),o.requestStreet=p,o.locationID="",M.proxy(!1),M.remote.get(p).then(function(e){var t=e.text.substring(9,e.text.length-1);n(t)}),M.proxy(!0)})}},{key:"goToLocation",value:function(e){var t=this;this.currentElement=e;var o=this.findClickedItem(e,this.allCandidates);this.createGeometryStyles(),Object.prototype.hasOwnProperty.call(o,"address")?this.getFindData(e,this.allCandidates).then(function(e){e.includes('"tip_via":null')&&(e.includes('"type":"Municipio"')||e.includes('"type":"municipio"')||e.includes('"type":"Provincia"')||e.includes('"type":"provincia"')||e.includes('"type":"comunidad autonoma"'))?(t.drawGeocoderResultProv(e),t.map.removePopup()):t.drawGeocoderResult(e)}):this.drawNomenclatorResult(o.id),this.resultsBox.innerHTML=""}},{key:"zoomInLocation",value:function(e,t,o){var n=this;this.resultsList=document.getElementById("m-ignsearch-results-list"),this.clickedElementLayer instanceof M.layer.Vector&&this.clickedElementLayer.calculateMaxExtent().then(function(r){n.map.setBbox(r),"n"!==e&&"Point"!==t||n.setScale(17061),"Point"===t&&n.map.setZoom(o),n.fire("ignsearch:entityFound",[r])})}},{key:"findClickedItem",value:function(e,t){return t.filter(function(t){return t.id===e.getAttribute("id")})[0]}},{key:"fixCoordinatesPath",value:function(e){return"Point"===e.geometry.type?e.geometry.coordinates[0][0]:"MultiPolygon"===e.geometry.type?[e.geometry.coordinates]:"LineString"===e.geometry.type?e.geometry.coordinates[0]:e.geometry.coordinates}},{key:"searchCoordinates",value:function(e){return new Promise(function(e){e()})}},{key:"clearResults",value:function(){this.searchInput.value="",this.resultsBox.innerHTML="",this.searchValue=""}},{key:"clearResultsAndGeometry",value:function(){this.clearResults(),void 0!==this.clickedElementLayer&&this.clickedElementLayer.setStyle(this.simple),this.map.removePopup(this.popup,[this.lng,this.lat])}},{key:"setResultVisibility",value:function(e){this.resultVisibility_=e}},{key:"changePlaceholder",value:function(){"g"===this.servicesToSearch?this.searchInput.placeholder=v("direccion"):"n"===this.servicesToSearch&&(this.searchInput.placeholder="Topónimo")}},{key:"createGeometryStyles",value:function(){"pinBlanco"===this.pointStyle?this.point=new M.style.Point({radius:5,icon:{form:"none",class:"g-cartografia-pin",radius:12,rotation:0,rotate:!1,offset:[0,-12],color:"#f00",border:"5px solid green",opacity:1}}):"pinRojo"===this.pointStyle?this.point=new M.style.Point({radius:5,icon:{src:M.utils.concatUrlPaths([M.config.THEME_URL,"/img/pinign.svg"])}}):"pinMorado"===this.pointStyle&&(this.point=new M.style.Point({radius:5,icon:{src:M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24.svg"])}})),this.simple=new M.style.Polygon({fill:{color:"black",opacity:0}})}},{key:"showSearchPopUp",value:function(e,t,o){var n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=this.map.getProjection().code,s=this.getImpl().reproject([t[1],t[0]],"EPSG:4326",i);n=v(1!==o?"aprox":"exact"),this.showPopUp(e,s,t,n,!1,r)}},{key:"showPopUp",value:function(e,t,o){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},s={content:"",icon:"icon-locate"};if(null!==n&&(s.content+="<div><b>".concat(n,"</b></div>")),s.content+="<div>".concat(e,"</div>\n                <div class='ignsearch-popup'>Lat: ").concat(o[0].toFixed(6),"</div>\n                <div class='ignsearch-popup'> Lon: ").concat(o[1].toFixed(6)," </div>"),this.map.getPopup()instanceof M.Popup&&!0===r)this.popup=this.map.getPopup(),this.popup.addTab(s);else{var a=new M.Popup({panMapIfOutOfView:!i.fake});a.addTab(s),this.map.addPopup(a,[t[0],t[1]]),this.popup=a}this.lat=t[1],this.lng=t[0]}},{key:"setScale",value:function(e){this.getImpl().setScale(e)}}])&&b(o.prototype,n),r&&b(o,r),t}(),k=["Estado","Isla administrativa","Comarca administrativa","Jurisdicción","Distrito municipal","Construcción/instalación abierta","Edificación","Vértice Geodésico","Alineación montañosa","Montaña","Paso de montaña","Llanura","Depresión","Vertientes","Comarca geográfica","Paraje","Elemento puntual del paisaje","Saliente costero","Playa","Isla","Otro relieve costero","Espacio protegido restante","Instalación portuaria","Camino y vía pecuaria","Curso natural de agua","Masa de agua","Curso artificial de agua","Embalse","Hidrónimo puntual","Glaciares","Mar","Entrante costero y estrecho marítimo","Relieve submarino"];function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t){return!t||"object"!==L(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var T=function(e){function t(e){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=_(this,E(t).call(this))).map_=null,o.controls_=[],o.servicesToSearch=e.servicesToSearch||"gn",o.maxResults=e.maxResults||10,o.noProcess=e.noProcess||"poblacion",o.countryCode=e.countryCode||"es",o.urlCandidates=e.urlCandidates||"https://www.cartociudad.es/geocoder/api/geocoder/candidatesJsonp",o.urlFind=e.urlFind||"https://www.cartociudad.es/geocoder/api/geocoder/findJsonp",o.urlReverse=e.urlReverse||"https://www.cartociudad.es/geocoder/api/geocoder/reverseGeocode",o.urlPrefix=e.urlPrefix||"http://www.idee.es/",o.urlAssistant=e.urlAssistant||"https://www.idee.es/communicationsPoolServlet/SearchAssistant",o.urlDispatcher=e.urlDispatcher||"https://www.idee.es/communicationsPoolServlet/Dispatcher",o.nomenclatorSearchType=M.config.IGNSEARCH_TYPES_CONFIGURATION||k,o.resultVisibility=e.resultVisibility||!0,o.isCollapsed=e.isCollapsed||!1,o.collapsible=e.collapsible||!1,o.position=e.position||"TL",o.tooltip_=e.tooltip||v("tooltip"),o.reverse_=e.reverse||!1,o.locationID_=e.locationID&&e.locationID.replace(/\^/g,"&")||"",o.requestStreet_=e.requestStreet&&e.requestStreet.replace(/\^/g,"&")||"";var n=e.geocoderCoords;return M.utils.isString(n)&&(n=n.split(","),n=[Number.parseFloat(n[0]),Number.parseFloat(n[1])]),o.geocoderCoords_=n||[],o.zoom_=16,void 0!==e.zoom&&(o.zoom_=parseInt(e.zoom,10)),o.searchPosition=e.searchPosition||"nomenclator,geocoder",o.pointStyle=e.pointStyle||"pinBlanco",o}var o,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(t,M.Plugin),o=t,(n=[{key:"addTo",value:function(e){var t=this;this.controls_.push(new x(this.servicesToSearch,this.maxResults,this.noProcess,this.countryCode,this.urlCandidates,this.urlFind,this.urlReverse,this.urlPrefix,this.urlAssistant,this.urlDispatcher,this.resultVisibility,this.reverse_,this.locationID_,this.requestStreet_,this.geocoderCoords_,this.zoom_,this.searchPosition,this.pointStyle,this.nomenclatorSearchType)),this.controls_[0].on("ignsearch:entityFound",function(e){t.fire("ignsearch:entityFound",[e])}),this.map_=e,this.panel_=new M.ui.Panel("panelIGNSearch",{collapsible:this.collapsible,position:M.ui.position[this.position],collapsed:this.isCollapsed,className:"ign-search-panel",collapsedButtonClass:"icon-ignsearch",tooltip:this.tooltip_}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_)}},{key:"setResultVisibility",value:function(e){this.controls_[0].setResultVisibility(e)}},{key:"getAPIRest",value:function(){return"".concat(this.name,"=").concat(this.servicesToSearch,"*").concat(this.maxResults,"*").concat(this.noProcess,"*").concat(this.countryCode,"*").concat(this.resultVisibility,"*").concat(this.isCollapsed,"*").concat(this.collapsible,"*").concat(this.position,"*").concat(this.reverse,"*").concat(this.requestStreet.replace(/&/g,"^"),"*").concat(this.locationID,"*").concat(this.geocoderCoords,"*").concat(this.zoom,"*").concat(this.searchPosition,"*").concat(this.pointStyle)}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_),this.map_=null,this.control_=null,this.controls_=null,this.panel_=null}},{key:"name",get:function(){return"ignsearch"}},{key:"reverse",get:function(){return this.reverse_}},{key:"geocoderCoords",get:function(){return this.controls_[0].geocoderCoords}},{key:"requestStreet",get:function(){return this.controls_[0].requestStreet}},{key:"locationID",get:function(){return this.controls_[0].locationID}}])&&C(o.prototype,n),r&&C(o,r),t}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.IGNSearch=T,window.M.control.IGNSearchControl=x,window.M.impl.control.IGNSearchControl=u}]);
//# sourceMappingURL=ignsearch.ol.min.js.map