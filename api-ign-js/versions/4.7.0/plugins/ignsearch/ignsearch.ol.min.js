!function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=6)}([function(e){e.exports=JSON.parse('{"exception":{"exists":"There is no associated address for this location.","results":"No results found","ignsearch_obsolete":"Message to the developer: M.plugin.IGNSearch has been deprecated, please use M.plugin.Locator instead"},"searchresult":"searchresult","tooltip":"Search places","tooltip_input":"Place name, address or postal code","deleteresults":"Delete search results","obtener":"Get direction at a point on the map","direccion":"Place name, address or postal code","aprox":"Approximate address","exact":"Exact address"}')},function(e){e.exports=JSON.parse('{"exception":{"exists":"No existe dirección asociada para esta ubicación.","results":"No se han encontrado resultados","ignsearch_obsolete":"Mensaje para el desarrollador: M.plugin.IGNSearch ha quedado obsoleto, utilice en su lugar M.plugin.Locator"},"searchresult":"searchresult","tooltip":"Búsqueda de lugares","tooltip_input":"Topónimo, dirección o código postal","deleteresults":"Borrar resultados de la búsqueda","obtener":"Obtener dirección en un punto del mapa","direccion":"Topónimo, dirección o código postal","aprox":"Dirección aproximada","exact":"Dirección exacta"}')},function(e,t){e.exports='<div id="div-contenedor" class="m-control m-container m-ignsearch" title="">\n    <div class="search-panel">\n        <input type="text" id="m-ignsearch-search-input" class="m-input-search" title="{{translations.tooltip_input}}" placeholder="{{translations.direccion}}" />\n        <button id="m-ignsearch-locate-button" title="{{translations.obtener}}">\n            <span class="icon-locate" />\n        </button>\n        <button id="m-ignsearch-clear-button" class="m-button-limpiar" title="{{translations.deleteresults}}">\n            <span class="icon-remove" />\n        </button>\n    </div>\n    <div id="m-ignsearch-results">\n        \x3c!-- Here goes the list of search results --\x3e\n    </div>\n</div>\n'},function(e,t){e.exports='<ul id="m-ignsearch-results-list">\n    {{#each places}}\n        {{#if this.address}}\n            {{#printType this.type this.address this.id this.municipality this.cps}}\n            {{/printType}}\n        {{else}}\n            {{#printType this.type this.title this.id this.municipality this.cps}}\n            {{/printType}}\n        {{/if}}\n    {{/each}}\n</ul>\n'},function(e,t,o){},function(e,t,o){},function(e,t,o){"use strict";o.r(t);o(4),o(5);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(i=n.key,a=void 0,a=function(e,t){if("object"!==r(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,t||"default");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===r(a)?a:String(a)),n)}var i,a}function a(){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,o){var r=s(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(arguments.length<3?e:o):n.value}}).apply(this,arguments)}function s(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=p(e);if(t){var n=p(this).constructor;o=Reflect.construct(r,arguments,n)}else o=r.apply(this,arguments);return u(this,o)}}function u(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d,h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(u,M.impl.Control);var t,o,r,s=l(u);function u(){return n(this,u),s.apply(this,arguments)}return t=u,(o=[{key:"addTo",value:function(e,t){a(p(u.prototype),"addTo",this).call(this,e,t)}},{key:"setScale",value:function(e){var t=[559082264.0287178,279541132.0143589,139770566.0071794,69885283.00358972,34942641.50179486,17471320.75089743,8735660.375448715,4367830.187724357,2183915.093862179,1091957.546931089,545978.7734655447,272989.3867327723,136494.6933663862,68247.34668319309,34123.67334159654,17061.83667079827,8530.918335399136,4265.459167699568,2132.729583849784],o=t.reduce((function(t,o){return Math.abs(o-e)<Math.abs(t-e)?o:t})),r=this.facadeMap_.getMapImpl().getView(),n=r.getMaxResolution()/Math.pow(2,t.indexOf(o));r.setResolution(n)}},{key:"reproject",value:function(e,t,o){return ol.proj.getTransform(t,o)(e)}}])&&i(t.prototype,o),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),u}(),y=o(2),f=o.n(y),m=o(3),v=o.n(m),g=o(0),b=o(1),P={en:g,es:b},S=function(){var e="es";return"function"==typeof M.language.getLang&&(e=M.language.getLang()),e},w=function(e){return"es"===e||"en"===e?P[e]:M.language.getTranslation(e).ignsearch},x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S(),o=w(t),r="";return M.utils.isNullOrEmpty(o)?console.warn("The translation '".concat(t,"' has not been defined.")):r=e.split(".").reduce((function(e,t){return e[t]}),o),r};function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(n=r.key,i=void 0,i=function(e,t){if("object"!==L(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!==L(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(n,"string"),"symbol"===L(i)?i:String(i)),r)}var n,i}function C(e,t){return(C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=E(e);if(t){var n=E(this).constructor;o=Reflect.construct(r,arguments,n)}else o=r.apply(this,arguments);return O(this,o)}}function O(e,t){if(t&&("object"===L(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&C(e,t)}(i,M.Control);var t,o,r,n=_(i);function i(e,t,o,r,a,s,c,l,u,p,d,y,f,m,v,g,b,P,S){var w;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),M.utils.isUndefined(h)&&M.exception("La implementación usada no puede crear controles IGNSearchControl");var x=new h;return(w=n.call(this,x,"IGNSearch")).servicesToSearch=e,w.maxResults=t,w.noProcess=o,w.countryCode=r,w.urlCandidates=a,w.urlFind=s,w.urlReverse=c,w.urlPrefix=l,w.urlAssistant=u,w.urlDispatcher=p,w.resultVisibility_=d,w.nomenclatorSearchType=S,w.searchPosition=b,w.reverse=y,w.reverseActivated=!1,w.locationID=f,w.requestStreet=m,w.geocoderCoords=v,w.zoom=g,w.urlParse=null,w.pointStyle=P,w}return t=i,(o=[{key:"createView",value:function(e){var t=this;return console.warn(x("exception.ignsearch_obsolete")),this.map=e,this.destroyMapLayers(),new Promise((function(o){var r=M.template.compileSync(f.a,{vars:{translations:{deleteresults:x("deleteresults"),obtener:x("obtener"),direccion:x("direccion"),tooltip_input:x("tooltip_input")}}});t.html=r,t.resultsBox=r.querySelector("#m-ignsearch-results"),t.searchInput=t.html.querySelector("#m-ignsearch-search-input"),r.querySelector("#m-ignsearch-clear-button").addEventListener("click",t.clearResultsAndGeometry.bind(t)),r.querySelector("#m-ignsearch-search-input").addEventListener("keyup",(function(e){return t.createTimeout(e)})),r.querySelector("#m-ignsearch-search-input").addEventListener("keydown",(function(){clearTimeout(d)})),r.querySelector("#m-ignsearch-search-input").addEventListener("keydown",(function(){clearTimeout(d)})),r.querySelector("#m-ignsearch-locate-button").addEventListener("click",t.activateDeactivateReverse.bind(t)),document.querySelector(".ign-search-panel>.m-panel-btn").addEventListener("click",t.clearResults.bind(t)),t.clickReverseEvent=t.map.on(M.evt.CLICK,(function(e){return t.showReversePopUp(e)})),t.changePlaceholder(),t.reverse||(r.querySelector("#m-ignsearch-locate-button").style.display="none"),t.on(M.evt.ADDED_TO_MAP,(function(){if(t.locationID&&t.locationID.length>0&&(t.point=new M.style.Point({radius:5,icon:{form:"none",class:"g-cartografia-pin",radius:12,rotation:0,rotate:!1,offset:[0,-12],color:"#f00",opacity:1}}),t.simple=new M.style.Polygon({fill:{color:"black",opacity:0}}),t.drawNomenclatorResult(t.locationID,!1)),t.requestStreet&&t.requestStreet.length>0&&(M.proxy(!1),M.remote.get(t.requestStreet).then((function(e){var o=e.text.substring(9,e.text.length-1);t.map.removeLayers(t.clickedElementLayer);var r=JSON.parse(o);if(r.geometry.coordinates=t.fixCoordinatesPath(r),t.coordinates="".concat(r.properties.lat,", ").concat(r.properties.lng),t.clickedElementLayer=new M.layer.GeoJSON({name:x("searchresult"),source:{type:"FeatureCollection",features:[r]}},{displayInLayerSwitcher:!1}),t.clickedElementLayer.displayInLayerSwitcher=!1,t.createGeometryStyles(),"Point"===r.geometry.type&&t.clickedElementLayer.setStyle(t.point),t.clickedElementLayer.setZIndex(1e19),t.resultVisibility_||t.clickedElementLayer.setStyle(t.simple),t.map.addLayers(t.clickedElementLayer),"callejero"===r.properties.type||"portal"===r.properties.type){var n=t.createFullAddress(r.properties),i=[r.properties.lat,r.properties.lng],a=r.properties.state;t.showSearchPopUp(n,i,a,{fake:!0})}M.proxy(!0)})).catch((function(e){M.proxy(!0)}))),t.geocoderCoords&&2===t.geocoderCoords.length){t.activateDeactivateReverse();var o=t.getImpl().reproject(t.geocoderCoords,"EPSG:4326",e.getProjection().code);t.showReversePopUp({coord:o,fake:!0})}})),o(r)}))}},{key:"destroyMapLayers",value:function(){for(var e=0;e<this.map.getLayers().length;e+=1)this.map.getLayers()[e].name===x("searchresult")&&(this.map.removeLayers(this.map.getLayers()[e]),this.map.removePopup())}},{key:"activateDeactivateReverse",value:function(){this.reverseActivated?(this.reverseActivated=!1,document.querySelector("#m-ignsearch-locate-button span").style.color="#7A7A73"):(this.reverseActivated=!0,document.querySelector("#m-ignsearch-locate-button span").style.color="#71a7d3")}},{key:"showReversePopUp",value:function(e){var t=this;if(this.reverseActivated){var o=this.map.getProjection().code,r=this.getImpl().reproject([e.coord[0],e.coord[1]],o,"EPSG:4258"),n="lon=".concat(r[0],"&lat=").concat(r[1]),i="".concat(this.urlReverse,"?").concat(n),a=e.coord;this.geocoderCoords=r;var s=[r[1],r[0]],c="";M.proxy(!1),M.remote.get(i).then((function(o){if(null!==o.text){var r=JSON.parse(o.text);c=t.createFullAddress(r)}else c=x("exception.exists");t.showPopUp(c,a,s,null,!0,e)})),M.proxy(!0)}}},{key:"createTimeout",value:function(e){var t=this;clearTimeout(d),d=setTimeout((function(){return t.searchInputValue(e)}),500)}},{key:"getActivationButton",value:function(e){return e.querySelector(".m-ignsearch button")}},{key:"equals",value:function(e){return e instanceof i}},{key:"searchInputValue",value:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.target.value.replace(","," ");if(this.searchValue=r,r.length<=2)this.resultsBox.innerHTML="";else{this.resultsBox.innerHTML="",this.resultsBox.classList.add("g-cartografia-spinner"),this.resultsBox.style.fontSize="24px",this.nomenclatorCandidates=[],this.geocoderCandidates=[];var n=/[+-]?\d+\.\d+(\s|,|(,\s))[+-]?\d+\.\d+/;n.test(r)?this.searchCoordinates(r):(this.nomenclatorFinished=!1,this.candidatesFinished=!1,this.getNomenclatorData(r,this.nomenclatorCandidates).then((function(){t.nomenclatorFinished=!0,t.showCandidatesResults(o)})),this.getCandidatesData(r,this.geocoderCandidates).then((function(){t.candidatesFinished=!0,t.showCandidatesResults(o)})))}}},{key:"showCandidatesResults",value:function(e){var t=this;this.allCandidates=[];for(var o=0;o<this.searchPosition.split(",").length;o+=1){if("nomenclator"===this.searchPosition.split(",")[o])for(var r=0;r<this.nomenclatorCandidates.length;r+=1)this.allCandidates.push(this.nomenclatorCandidates[r]);if("geocoder"===this.searchPosition.split(",")[o])for(var n=0;n<this.geocoderCandidates.length;n+=1)this.allCandidates.push(this.geocoderCandidates[n])}if(0===this.allCandidates.length&&this.nomenclatorFinished&&this.candidatesFinished){this.resultsBox.innerHTML="",this.resultsBox.classList.remove("g-cartografia-spinner"),this.resultsBox.style.fontSize="1em";var i=document.createElement("p"),a=document.createTextNode(x("exception.results"));i.classList.add("m-ignsearch-noresults"),i.appendChild(a),this.resultsBox.appendChild(i)}else if(this.allCandidates.length>0){this.resultsBox.innerHTML="",this.resultsBox.classList.remove("g-cartografia-spinner"),this.resultsBox.style.fontSize="1em";var s=M.template.compileSync(v.a,{vars:{places:this.allCandidates}}),c=s.querySelectorAll("li");c.forEach((function(e){e.addEventListener("click",(function(){t.goToLocation(e)}))})),!0===e&&c.length>0&&c.item(0).click(),this.resultsBox.appendChild(s)}}},{key:"drawGeocoderResultProv",value:function(e){var t=this;this.map.removeLayers(this.clickedElementLayer),M.proxy(!1),M.remote.get(this.urlParse).then((function(o){var r,n=o.text.substring(9,o.text.length-1),i=e;if(n.includes("MULTIPOLYGON (((")){if(i.includes('"type":"MultiPolygon"')){r=n.split("(((")[1].split("), ("),i.includes("]]]")&&(i=i.replace("]]]","]]]]"));for(var a=0;a<r.length;a+=1){var s=r[a].substring(0,9).replace("(","");e.includes("[[[".concat(s))?i=i.replace("[[[".concat(s),"[[[[".concat(s)):e.includes("]],[[".concat(s))?i=i.replace("]],[[".concat(s),"]]],[[[".concat(s)):e.includes("],[".concat(s))&&(i=i.replace("],[".concat(s),"]],[[".concat(s)))}}}else if(n.includes("POLYGON (("))if(i.includes('"type":"Polygon"')){r=n.split("((")[1].split("), ("),i.includes("]]")&&(i=i.replace("]]","]]]")),i=i.replace("Polygon","MultiPolygon");for(var c=0;c<r.length;c+=1){var l=r[c].split(" "),u=r[c].substring(0,l[0].length).replace("(","");e.includes("[[[".concat(u))?i=i.replace("[[[".concat(u),"[[[[".concat(u)):e.includes("],[".concat(u))&&(i=i.replace("],[".concat(u),"]],[[".concat(u)))}}else i.includes('"type":"MultiPolygon"')&&(i=(i=i.replace("]]],[[","]],[[")).replace('"type":"MultiPolygon"','"type":"Polygon"'));i.includes("MultiMultiPolygon")&&(i=i.replace("MultiMultiPolygon","MultiPolygon"));var p=JSON.parse(i);if(t.coordinates="".concat(p.properties.lat,", ").concat(p.properties.lng),t.clickedElementLayer=new M.layer.GeoJSON({name:x("searchresult"),source:{type:"FeatureCollection",features:[p]}},{displayInLayerSwitcher:!1}),t.clickedElementLayer.displayInLayerSwitcher=!1,"Point"===p.geometry.type&&t.clickedElementLayer.setStyle(t.point),p.geometry.type.indexOf("Polygon")>-1&&t.clickedElementLayer.setStyle(new M.style.Polygon({fill:{color:"#3399CC",opacity:0},stroke:{color:"#3399CC",width:2},radius:5})),t.clickedElementLayer.setZIndex(1e19),t.resultVisibility_||t.clickedElementLayer.setStyle(t.simple),t.map.addLayers(t.clickedElementLayer),t.zoomInLocation("g",p.geometry.type,t.zoom),"callejero"===p.properties.type||"portal"===p.properties.type){var d=t.createFullAddress(p.properties),h=[p.properties.lat,p.properties.lng],y=p.properties.state;t.showSearchPopUp(d,h,y)}})),M.proxy(!0)}},{key:"drawGeocoderResult",value:function(e){this.map.removeLayers(this.clickedElementLayer);var t=JSON.parse(e);if(t.geometry.coordinates=this.fixCoordinatesPath(t),this.coordinates="".concat(t.properties.lat,", ").concat(t.properties.lng),this.clickedElementLayer=new M.layer.GeoJSON({name:x("searchresult"),source:{type:"FeatureCollection",features:[t]}},{displayInLayerSwitcher:!1}),this.clickedElementLayer.displayInLayerSwitcher=!1,"Point"===t.geometry.type&&this.clickedElementLayer.setStyle(this.point),this.clickedElementLayer.setZIndex(1e19),this.resultVisibility_?t.geometry.type.indexOf("Polygon")>-1&&this.clickedElementLayer.setStyle(new M.style.Polygon({fill:{color:"#3399CC",opacity:0},stroke:{color:"#3399CC",width:2},radius:5})):this.clickedElementLayer.setStyle(this.simple),this.map.addLayers(this.clickedElementLayer),this.zoomInLocation("g",t.geometry.type,this.zoom),"callejero"===t.properties.type||"portal"===t.properties.type){var o=this.createFullAddress(t.properties),r=[t.properties.lat,t.properties.lng],n=t.properties.state;this.showSearchPopUp(o,r,n)}else void 0!==this.popup&&this.map.removePopup(this.popup)}},{key:"createFullAddress",value:function(e){var t=null===e.tip_via||void 0===e.tip_via?"":e.tip_via,o=null===e.address||void 0===e.address?"":e.address,r=null===e.portalNumber||void 0===e.portalNumber||0===e.portalNumber?"":e.portalNumber,n=null===e.muni||void 0===e.muni?"":e.muni;return"".concat(t," ").concat(o," ").concat(r,", ").concat(n.toUpperCase())}},{key:"drawNomenclatorResult",value:function(e){var t=this,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.requestStreet="",this.requestPlace=M.utils.addParameters(this.urlDispatcher,{request:"OpenQuerySource",query:'<ogc:Filter><ogc:FeatureId fid="'.concat(e,'"/></ogc:Filter>'),sourcename:"".concat(this.urlPrefix,"communicationsPoolServlet/sourceAccessWFS-INSPIRE-NGBE.rdf"),outputformat:"application/json"}),this.locationID=e,M.proxy(!0),M.remote.get(this.requestPlace).then((function(e){var r=JSON.parse(e.text).results[0].location,n=JSON.parse(e.text).results[0].title,i=r.split(" "),a=parseFloat(i[0]),s=parseFloat(i[1]);t.map.removeLayers(t.clickedElementLayer);var c={name:x("searchresult"),source:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[s,a]},properties:{name:n}}]}};t.clickedElementLayer=new M.layer.GeoJSON(c,{displayInLayerSwitcher:!1}),t.clickedElementLayer.displayInLayerSwitcher=!1,t.clickedElementLayer.setStyle(t.point),t.clickedElementLayer.setZIndex(1e19),t.resultVisibility_||t.clickedElementLayer.setStyle(t.simple),t.map.addLayers(t.clickedElementLayer),!0===o&&t.zoomInLocation("n","Point",t.zoom)}))}},{key:"getCandidatesData",value:function(e,t){var o=this,r=window.encodeURIComponent(e);return new Promise((function(e){if("n"!==o.servicesToSearch){var n="q=".concat(r,"&limit=").concat(o.maxResults+5,"&no_process=").concat(o.noProcess);n+="&countrycode=".concat(o.countryCode,"&autocancel=true");var i="".concat(o.urlCandidates,"?").concat(n);M.proxy(!1),M.remote.get(i).then((function(o){for(var r=JSON.parse(o.text.substring(9,o.text.length-1)),n=0;n<r.length;n+=1)t.push(r[n]);e()})),M.proxy(!0)}else e()}))}},{key:"getNomenclatorData",value:function(e,t){var o=this,r=window.encodeURIComponent(e);return new Promise((function(e){if("g"!==o.servicesToSearch){var n="maxresults=".concat(o.maxResults-5,"&name_equals=").concat(r),i="".concat(o.urlAssistant,"?").concat(n);M.proxy(!0),M.remote.get(i).then((function(r){for(var n=(""!==r.text&&null!==r.text?JSON.parse(r.text):{results:[]}).results,i=0;i<n.length;i+=1)o.nomenclatorSearchType.indexOf(n[i].type)>=0&&t.push(n[i]);for(var a=0;a<t.length;a+=1)if("Núcleos de población"===t[a].type){var s=t.splice(a,1);t.splice(0,0,s)}t.forEach((function(e){e.cps=!0})),e()}))}else e()}))}},{key:"getFindData",value:function(e,t){var o=this;return new Promise((function(r){var n,i,a,s,c;if(t.forEach((function(t){e.getAttribute("id")===t.id&&(n="&id=".concat(t.id),i="&type=".concat(t.type),a=0!==t.portalNumber&&void 0!==t.portalNumber?"&portal=".concat(t.portalNumber):"",s=""!==t.tip_via?"&tip_via=".concat(t.tip_via):"")})),c=e.innerHTML,e.innerHTML.includes("(")){var l=e.innerHTML.indexOf("(");c=e.innerHTML.substring(0,l)}var u="".concat(i).concat(s).concat(n).concat(a,"&outputformat=geojson"),p="".concat(o.urlFind,"?q=").concat(c).concat(u);o.urlParse=p.replace("&outputformat=geojson",""),o.requestStreet=p,o.locationID="",M.proxy(!1),M.remote.get(p).then((function(e){var t=e.text.substring(9,e.text.length-1);r(t)})),M.proxy(!0)}))}},{key:"goToLocation",value:function(e){var t=this,o=e.querySelector("#info").innerHTML;this.html.querySelector("#m-ignsearch-search-input").value=o,this.currentElement=e;var r=this.findClickedItem(e,this.allCandidates);this.createGeometryStyles(),Object.prototype.hasOwnProperty.call(r,"address")?this.getFindData(e,this.allCandidates).then((function(e){e.includes('"tip_via":null')&&(e.includes('"type":"Municipio"')||e.includes('"type":"municipio"')||e.includes('"type":"Provincia"')||e.includes('"type":"provincia"')||e.includes('"type":"comunidad autonoma"'))?(t.drawGeocoderResultProv(e),t.map.removePopup()):t.drawGeocoderResult(e)})):this.drawNomenclatorResult(r.id),this.resultsBox.innerHTML=""}},{key:"zoomInLocation",value:function(e,t,o){var r=this;this.resultsList=document.getElementById("m-ignsearch-results-list"),this.clickedElementLayer instanceof M.layer.Vector&&this.clickedElementLayer.calculateMaxExtent().then((function(n){r.map.setBbox(n),"n"!==e&&"Point"!==t||r.setScale(17061),"Point"===t&&r.map.setZoom(o),r.fire("ignsearch:entityFound",[n])}))}},{key:"findClickedItem",value:function(e,t){return t.filter((function(t){return t.id===e.getAttribute("id")}))[0]}},{key:"fixCoordinatesPath",value:function(e){return"Point"===e.geometry.type?e.geometry.coordinates[0][0]:"MultiPolygon"===e.geometry.type?[e.geometry.coordinates]:"LineString"===e.geometry.type?e.geometry.coordinates[0]:e.geometry.coordinates}},{key:"searchCoordinates",value:function(e){return new Promise((function(e){e()}))}},{key:"clearResults",value:function(){this.searchInput.value="",this.resultsBox.innerHTML="",this.searchValue=""}},{key:"clearResultsAndGeometry",value:function(){this.clearResults(),void 0!==this.clickedElementLayer&&(this.clickedElementLayer.setStyle(this.simple),this.map.removeLayers(this.clickedElementLayer)),this.map.removePopup(this.popup,[this.lng,this.lat])}},{key:"setResultVisibility",value:function(e){this.resultVisibility_=e}},{key:"changePlaceholder",value:function(){"g"===this.servicesToSearch?this.searchInput.placeholder=x("direccion"):"n"===this.servicesToSearch&&(this.searchInput.placeholder="Topónimo")}},{key:"createGeometryStyles",value:function(){"pinBlanco"===this.pointStyle?this.point=new M.style.Point({radius:5,icon:{form:"none",class:"g-cartografia-pin",radius:12,rotation:0,rotate:!1,offset:[0,-12],color:"#f00",border:"5px solid green",opacity:1}}):"pinRojo"===this.pointStyle?this.point=new M.style.Point({radius:5,icon:{src:M.utils.concatUrlPaths([M.config.THEME_URL,"/img/pinign.svg"])}}):"pinMorado"===this.pointStyle&&(this.point=new M.style.Point({radius:5,icon:{src:M.utils.concatUrlPaths([M.config.THEME_URL,"/img/m-pin-24.svg"])}})),this.simple=new M.style.Polygon({fill:{color:"black",opacity:0}})}},{key:"showSearchPopUp",value:function(e,t,o){var r,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=this.map.getProjection().code,a="EPSG:4326",s=this.getImpl().reproject([t[1],t[0]],a,i);r=x(1!==o?"aprox":"exact"),this.showPopUp(e,s,t,r,!1,n)}},{key:"showPopUp",value:function(e,t,o){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},a={content:"",icon:"icon-locate"};if(null!==r&&(a.content+="<div><b>".concat(r,"</b></div>")),a.content+="<div>".concat(e,"</div>\n                <div class='ignsearch-popup'>Lat: ").concat(o[0].toFixed(6),"</div>\n                <div class='ignsearch-popup'> Lon: ").concat(o[1].toFixed(6)," </div>"),this.map.getPopup()instanceof M.Popup&&!0===n)this.popup=this.map.getPopup(),this.popup.addTab(a);else{var s=new M.Popup({panMapIfOutOfView:!i.fake});s.addTab(a),this.map.addPopup(s,[t[0],t[1]]),this.popup=s}this.lat=t[1],this.lng=t[0]}},{key:"setScale",value:function(e){this.getImpl().setScale(e)}}])&&k(t.prototype,o),r&&k(t,r),Object.defineProperty(t,"prototype",{writable:!1}),i}(),j=["Estado","Isla administrativa","Comarca administrativa","Jurisdicción","Distrito municipal","Construcción/instalación abierta","Edificación","Vértice Geodésico","Alineación montañosa","Montaña","Paso de montaña","Llanura","Depresión","Vertientes","Comarca geográfica","Paraje","Elemento puntual del paisaje","Saliente costero","Playa","Isla","Otro relieve costero","Espacio protegido restante","Instalación portuaria","Camino y vía pecuaria","Curso natural de agua","Masa de agua","Curso artificial de agua","Embalse","Hidrónimo puntual","Glaciares","Mar","Entrante costero y estrecho marítimo","Relieve submarino"];function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(n=r.key,i=void 0,i=function(e,t){if("object"!==R(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!==R(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(n,"string"),"symbol"===R(i)?i:String(i)),r)}var n,i}function N(e,t){return(N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var o,r=F(e);if(t){var n=F(this).constructor;o=Reflect.construct(r,arguments,n)}else o=r.apply(this,arguments);return q(this,o)}}function q(e,t){if(t&&("object"===R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var G=["Estado","Isla administrativa","Comarca administrativa","Jurisdicción","Vértice Geodésico","Alineación montañosa","Montaña","Paso de montaña","Llanura","Depresión","Vertientes","Comarca geográfica","Paraje","Elemento puntual del paisaje","Saliente costero","Playa","Isla","Otro relieve costero","Curso natural de agua","Masa de agua","Curso artificial de agua","Hidrónimo puntual","Glaciares","Mar","Entrante costero y estrecho marítimo","Relieve submarino"],A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&N(e,t)}(i,M.Plugin);var t,o,r,n=D(i);function i(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=n.call(this)).map_=null,t.controls_=[],t.servicesToSearch=e.servicesToSearch||"gn",t.maxResults=e.maxResults||10,t.noProcess=e.noProcess||"poblacion",t.countryCode=e.countryCode||"es",t.urlCandidates=e.urlCandidates||"https://www.cartociudad.es/geocoder/api/geocoder/candidatesJsonp",t.urlFind=e.urlFind||"https://www.cartociudad.es/geocoder/api/geocoder/findJsonp",t.urlReverse=e.urlReverse||"https://www.cartociudad.es/geocoder/api/geocoder/reverseGeocode",t.urlPrefix=e.urlPrefix||"http://www.idee.es/",t.urlAssistant=e.urlAssistant||"https://www.idee.es/communicationsPoolServlet/SearchAssistant",t.urlDispatcher=e.urlDispatcher||"https://www.idee.es/communicationsPoolServlet/Dispatcher",t.nomenclatorSearchType=G||j,t.resultVisibility=e.resultVisibility||!0,t.isCollapsed=e.isCollapsed||!1,t.collapsible=e.collapsible||!1,t.position=e.position||"TL",t.tooltip_=e.tooltip||x("tooltip"),t.reverse_=e.reverse||!1,t.locationID_=e.locationID&&e.locationID.replace(/\^/g,"&")||"",t.requestStreet_=e.requestStreet&&e.requestStreet.replace(/\^/g,"&")||"";var o=e.geocoderCoords;return M.utils.isString(o)&&(o=o.split(","),o=[Number.parseFloat(o[0]),Number.parseFloat(o[1])]),t.geocoderCoords_=o||[],t.zoom_=16,void 0!==e.zoom&&(t.zoom_=parseInt(e.zoom,10)),t.searchPosition=e.searchPosition||"nomenclator,geocoder",t.pointStyle=e.pointStyle||"pinBlanco",t}return t=i,r=[{key:"getJSONTranslations",value:function(e){return"en"===e||"es"===e?"en"===e?g:b:M.language.getTranslation(e).ignsearch}}],(o=[{key:"addTo",value:function(e){var t=this;this.controls_.push(new T(this.servicesToSearch,this.maxResults,this.noProcess,this.countryCode,this.urlCandidates,this.urlFind,this.urlReverse,this.urlPrefix,this.urlAssistant,this.urlDispatcher,this.resultVisibility,this.reverse_,this.locationID_,this.requestStreet_,this.geocoderCoords_,this.zoom_,this.searchPosition,this.pointStyle,this.nomenclatorSearchType)),this.controls_[0].on("ignsearch:entityFound",(function(e){t.fire("ignsearch:entityFound",[e])})),this.map_=e,this.panel_=new M.ui.Panel("panelIGNSearch",{collapsible:this.collapsible,position:M.ui.position[this.position],collapsed:this.isCollapsed,className:"ign-search-panel",collapsedButtonClass:"icon-ignsearch",tooltip:this.tooltip_}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_)}},{key:"setResultVisibility",value:function(e){this.controls_[0].setResultVisibility(e)}},{key:"name",get:function(){return"ignsearch"}},{key:"reverse",get:function(){return this.reverse_}},{key:"geocoderCoords",get:function(){return this.controls_[0].geocoderCoords}},{key:"requestStreet",get:function(){return this.controls_[0].requestStreet}},{key:"locationID",get:function(){return this.controls_[0].locationID}},{key:"getAPIRest",value:function(){return"".concat(this.name,"=").concat(this.servicesToSearch,"*").concat(this.maxResults,"*").concat(this.noProcess,"*").concat(this.countryCode,"*").concat(this.resultVisibility,"*").concat(this.isCollapsed,"*").concat(this.collapsible,"*").concat(this.position,"*").concat(this.reverse,"*").concat(this.requestStreet.replace(/&/g,"^"),"*").concat(this.locationID,"*").concat(this.geocoderCoords,"*").concat(this.zoom,"*").concat(this.searchPosition,"*").concat(this.pointStyle)}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_),this.map_=null,this.control_=null,this.controls_=null,this.panel_=null}}])&&I(t.prototype,o),r&&I(t,r),Object.defineProperty(t,"prototype",{writable:!1}),i}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.IGNSearch=A,window.M.control.IGNSearchControl=T,window.M.impl.control.IGNSearchControl=h}]);
//# sourceMappingURL=ignsearch.ol.min.js.map